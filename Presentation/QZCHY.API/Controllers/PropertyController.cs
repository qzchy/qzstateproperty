using QZCHY.API.Models.Properties;
using QZCHY.Core;
using QZCHY.Core.Domain.Media;
using QZCHY.Core.Domain.Properties;
using QZCHY.Services.AccountUsers;
using QZCHY.Services.Logging;
using QZCHY.Services.Media;
using QZCHY.Services.Property;
using QZCHY.Web.Api.Extensions;
using QZCHY.Web.Framework.Controllers;
using QZCHY.Web.Framework.Response;
using System;
using System.Collections.Generic;
using System.Data.Entity.Spatial;
using System.Linq;
using System.Web;
using System.Web.Http;


namespace QZCHY.API.Controllers
{
    [RoutePrefix("Properties")]
    public class PropertyController : BaseAdminApiController
    {
        private readonly IPropertyService _propertyService;
        private readonly IGovernmentService _governmentService;
        private readonly IAccountUserService _accountUserService;
        private readonly IAccountUserActivityService _accountUserActivityService;
        private readonly IWebHelper _webHelper;
        private readonly IWorkContext _workContext;
        private readonly IPropertyNewCreateService _propertyNewCreateService;
        private readonly IPropertyLendService _propertyLendService;
        private readonly IPropertyRentService _propertyRentService;
        private readonly IPropertyAllotService _propertyAllotService;
        private readonly IPropertyOffService _propertyOffService;
        private readonly IPropertyEditService _propertyEditService;
        private readonly ICopyPropertyService _copyPropertyService;
        private readonly IPictureService _pictureService;
        private readonly IFileService _fileService;

        private const string xqregion = "MULTIPOLYGON (((118.83061773800011 28.984037100000023, 118.83027875800008 28.97749847800003, 118.83019018700008 28.974613994000038, 118.8305129040001 28.972312430000045, 118.83115703500005 28.970457877000058, 118.83322749800004 28.966178772000035, 118.83465902600005 28.963238638000064, 118.83466298400003 28.963230511000063, 118.83583213100007 28.960829266000076, 118.83686879600009 28.958705528000053, 118.83732194300001 28.957777200000066, 118.83775487000003 28.956890297000029, 118.83803179300003 28.956322986000032, 118.83855440900004 28.955252340000072, 118.83884254200007 28.954662066000026, 118.84020364700007 28.951528287000031, 118.84060934700005 28.948819378000053, 118.84028735600009 28.945962245000032, 118.84021588600001 28.945591322000041, 118.84017773300002 28.945393320000051, 118.84001737400001 28.944561079000039, 118.8465220380001 28.944563016000075, 118.85055186600005 28.945061308000049, 118.85285442800011 28.946059412000068, 118.85467031100006 28.94780232200003, 118.85597205100009 28.950818167000079, 118.85607345800008 28.95135833300003, 118.85650909700007 28.95367883800003, 118.85669442000005 28.954665995000028, 118.85691678400008 28.955533511000056, 118.85699048400011 28.955821042000025, 118.85767353400001 28.958485857000028, 118.85814994500004 28.960344497000051, 118.85944800100003 28.964676319000034, 118.86021977400003 28.967979994000075, 118.86040178500002 28.969061312000065, 118.8606690360001 28.970019251000053, 118.86165747200005 28.971703474000037, 118.86217721200001 28.972589070000026, 118.8622569690001 28.972724968000023, 118.86229325900001 28.972786799000062, 118.86231377600006 28.97282175600003, 118.86233427800005 28.972856686000057, 118.86237058800009 28.972918555000035, 118.86546466900006 28.978391817000045, 118.86686591500006 28.980363157000056, 118.86924732900002 28.982537708000052, 118.87079458700009 28.983395469000072, 118.87090955700012 28.98343731500006, 118.8713690510001 28.983604557000035, 118.87058289800007 28.985239283000055, 118.86954085900004 28.987714383000025, 118.86940295200009 28.988812706000033, 118.87045117500008 28.992033157000037, 118.86934025900007 28.993799737000074, 118.86782612500008 28.995633482000073, 118.86706796600004 28.996669661000055, 118.8659381440001 28.996595283000033, 118.86269051200009 28.995498156000053, 118.86091137900007 28.994901580000032, 118.85981421800011 28.994533682000053, 118.85758987400004 28.993787819000033, 118.85758166700009 28.993785067000033, 118.85496771900011 28.992908563000071, 118.85288624200007 28.992210606000071, 118.84674147700002 28.99020600700004, 118.8438976000001 28.989421495000045, 118.83255582700008 28.987639510000065, 118.83230285500008 28.987556985000026, 118.83206241800008 28.987465254000028, 118.83130982700004 28.987073390000035, 118.83070544000009 28.986148014000037, 118.83061773800011 28.984037100000023)))";
        private const string jjqregion = "MULTIPOLYGON (((118.88477295200005 28.93451525100005, 118.88488604700001 28.934363443000052, 118.8849706530001 28.934249876000024, 118.89526449900006 28.920432414000061, 118.89964226400002 28.914173855000058, 118.89614908800002 28.914121941000076, 118.88459716000011 28.914763252000057, 118.87811260400008 28.915212586000052, 118.8689155080001 28.916345943000067, 118.86405046700008 28.916570947000025, 118.8603196470001 28.916596446000028, 118.85774818100003 28.916386991000024, 118.85646065900005 28.91583406500007, 118.8545084000001 28.91461408300006, 118.85247788900006 28.914179473000047, 118.84975451100001 28.914751369000044, 118.84643043700009 28.915550784000061, 118.83793597800002 28.918321083000023, 118.82918880700004 28.910440974000039, 118.82251836100011 28.902381993000063, 118.8166223720001 28.893678435000027, 118.83119228300006 28.885017819000041, 118.83264901900009 28.884642891000055, 118.83169354000006 28.883675702000062, 118.82972154000004 28.881192706000036, 118.82851156000004 28.879454544000055, 118.82613783000011 28.876350436000052, 118.82579559100009 28.875616738000076, 118.82261744200002 28.869601259000035, 118.82093782300001 28.866681554000024, 118.82006041000011 28.865578739000057, 118.81890619800004 28.864602149000063, 118.81644270800007 28.862711005000051, 118.81344750500011 28.86051481100003, 118.81488916400008 28.858007938000071, 118.81753764600001 28.853430360000061, 118.81936802100006 28.853287823000073, 118.82588779300011 28.853898445000027, 118.82574680100004 28.852549620000048, 118.8262279700001 28.852530349000062, 118.82701354900007 28.852590892000023, 118.82783572100004 28.852737406000074, 118.8284101480001 28.852839771000049, 118.82924157800005 28.852954405000048, 118.82998547800003 28.853042405000053, 118.83129895400009 28.853173449000053, 118.83236514400005 28.85317201600003, 118.83336401600002 28.853070862000038, 118.83409423000001 28.852991247000034, 118.83623250100004 28.852474516000029, 118.8385663470001 28.851825732000066, 118.83981456100003 28.85151223500003, 118.84206464300007 28.851288105000037, 118.84423855400007 28.851536003000035, 118.84654713300006 28.852271801000029, 118.84770273600009 28.852711391000071, 118.84992947000001 28.853606270000057, 118.85179551100009 28.854094255000064, 118.8536178170001 28.854108084000075, 118.85495069500007 28.854093052000053, 118.85829961100001 28.854053686000043, 118.85995537100007 28.854174478000061, 118.86101820600004 28.854509042000075, 118.86209465700006 28.85479852800006, 118.86350626600006 28.855343173000051, 118.86559327800001 28.85615642700003, 118.86697357900005 28.856686473000025, 118.86787435800011 28.857033839000053, 118.87233152900001 28.85840365200005, 118.87851828800001 28.859980889000042, 118.88579466500005 28.862091520000035, 118.88686066500009 28.862383313000066, 118.89060119600003 28.862611775000062, 118.89615602900005 28.862088038000024, 118.89898955300009 28.86170493700007, 118.90307622300008 28.860526374000074, 118.91125245700005 28.861311887000056, 118.92458414500004 28.862031715000057, 118.92574688600007 28.862041001000023, 118.93252711700006 28.862700177000079, 118.96360482500006 28.863183434000064, 118.97772070100007 28.864032264000059, 118.98602354000002 28.868179110000028, 118.99546799100006 28.873899941000047, 119.01293909100002 28.887597021000033, 119.02377511000009 28.89664450500004, 119.03076269900009 28.901107380000042, 119.03523771400012 28.90038620100006, 119.03603844700001 28.906670157000065, 119.03695906600001 28.915858118000074, 119.04022516600003 28.916755263000027, 119.04241171900003 28.917883046000043, 119.04613872200002 28.919855751000057, 119.04633555300006 28.920084664000058, 119.04771305100007 28.922191015000067, 119.04875691400002 28.922533181000063, 119.04856106700004 28.926977122000039, 119.04846185000008 28.929201267000053, 119.04850653700009 28.929700707000052, 119.04849886400007 28.930850627000041, 119.04846479200012 28.931445723000024, 119.04849565000006 28.932272233000049, 119.04851844600012 28.934410992000039, 119.04848005200006 28.934625046000065, 119.04824503600003 28.935153204000073, 119.04749338800002 28.936571750000041, 119.04674180900008 28.938042986000028, 119.04645245100005 28.938515296000048, 119.04527825900004 28.939623501000028, 119.04463265000004 28.940294299000072, 119.04454128400005 28.940586544000041, 119.04440196900009 28.94125563800003, 119.04391527600001 28.944016752000039, 119.04359113600003 28.947302991000072, 119.04343898500008 28.948008730000026, 119.04305500000009 28.94863618200003, 119.04201556500004 28.951196972000048, 119.03917935600009 28.957734113000072, 119.03405629500003 28.96967593100004, 119.03125893600009 28.976356517000056, 119.03019340700007 28.97877139600007, 119.02849820800009 28.979836869000053, 119.02739295900005 28.981701410000028, 119.02075232200002 28.984892539000043, 119.01914187200009 28.985560471000042, 119.01083607800001 28.987109169000064, 119.00155137900003 28.987691514000062, 118.99565164800003 28.992244729000049, 118.99263996800005 28.994073700000058, 118.99088931900008 28.994648210000037, 118.98714257600011 28.994902188000026, 118.98673299400002 28.992861515000072, 118.98098833400002 28.990968593000048, 118.97841923200008 28.987819628000068, 118.97687579000001 28.987052076000055, 118.97405571800005 28.985987238000064, 118.9767390400001 28.977687425000056, 118.95054975000005 28.971152914000072, 118.94313604200011 28.96721831900004, 118.93681254100011 28.962544109000078, 118.92142564700009 28.951580428000057, 118.9186565760001 28.950149152000051, 118.91662096800007 28.950042453000037, 118.90204695600005 28.95190875000003, 118.8963119340001 28.952802070000075, 118.88295347200005 28.954991454000037, 118.87718327100004 28.954345549000038, 118.87706656100011 28.954332484000076, 118.87633296400008 28.954250367000043, 118.87563339900009 28.95417205900003, 118.87549967000007 28.952233633000048, 118.87538319900011 28.950545378000072, 118.87532426200005 28.949550578000071, 118.87563525000007 28.948580363000076, 118.87598606000006 28.947485908000033, 118.87603547500009 28.947331746000032, 118.87651328000004 28.946162358000038, 118.87732865200007 28.944621430000041, 118.8776402530001 28.944032555000035, 118.87795462500003 28.943443307000052, 118.87842787400007 28.942556266000054, 118.87857413500001 28.942278411000075, 118.87870754700009 28.94202496500003, 118.87900794600012 28.94145429200006, 118.8791545790001 28.941225423000049, 118.87962474100004 28.940491579000025, 118.87976987700006 28.940342830000077, 118.88206792800008 28.937987584000041, 118.8823129110001 28.937685972000054, 118.88337610800011 28.936377008000079, 118.88477295200005 28.93451525100005)))";
        private const string lcqregion = "MULTIPOLYGON (((118.85129157100005 28.942509139000038, 118.85061844300003 28.940104038000072, 118.85032623200004 28.938541301000043, 118.85003437100011 28.93763840400004, 118.85003435700003 28.937638366000044, 118.85002932100008 28.937622786000077, 118.85002506500007 28.937609619000057, 118.85002411300002 28.937606674000051, 118.84985688100005 28.93708932100003, 118.84943080700009 28.935782152000058, 118.84856268900012 28.933732144000032, 118.84764124700007 28.932189544000039, 118.84709641000006 28.931313481000075, 118.84694233000005 28.931065728000078, 118.84619278300011 28.929860503000043, 118.84747168400008 28.929757272000074, 118.84837864300005 28.929685368000037, 118.84839658600004 28.929683946000068, 118.85089168800005 28.929486138000073, 118.85268269700009 28.929349140000056, 118.85276256100008 28.92934303100003, 118.85341727200012 28.929292951000036, 118.85543278300008 28.929245249000076, 118.85718178400009 28.929379603000029, 118.85981124000011 28.929729830000042, 118.85981127600007 28.929729835000046, 118.85992245500006 28.929744506000077, 118.85992951500009 28.929745437000065, 118.86245220300009 28.93007837600004, 118.86245741200003 28.93007906400004, 118.86639648300002 28.930600785000024, 118.86800453000001 28.930812682000067, 118.87010887800011 28.931089978000045, 118.87121559500008 28.931239093000045, 118.87351133400011 28.931548411000051, 118.87608641100007 28.931895367000038, 118.87775883000006 28.932110669000053, 118.87897113100007 28.932266737000077, 118.88185836300011 28.932833692000031, 118.88327375100005 28.933496490000039, 118.88477246000002 28.934514916000069, 118.88337610800011 28.936377008000079, 118.88206792800008 28.937987584000041, 118.87962474100004 28.940491579000025, 118.87900794600012 28.94145429200006, 118.87870754700009 28.94202496500003, 118.87857413500001 28.942278411000075, 118.87842787400007 28.942556266000054, 118.87795462500003 28.943443307000052, 118.8776402530001 28.944032555000035, 118.87747416100001 28.944345931000043, 118.87651946400001 28.946147223000025, 118.87603547500009 28.947331746000032, 118.87598606000006 28.947485908000033, 118.87532426200005 28.949550578000071, 118.87538319900011 28.950545378000072, 118.87563339900009 28.95417205900003, 118.87633296400008 28.954250367000043, 118.87706656100011 28.954332484000076, 118.87769184700005 28.954402477000031, 118.87784626400003 28.954419763000033, 118.87791138600005 28.954538549000063, 118.87826436400007 28.955182402000048, 118.87846270000011 28.956874709000033, 118.87859634800009 28.957607732000042, 118.87868482900001 28.958093033000068, 118.87909958700004 28.96027428900004, 118.87928841600001 28.960832141000026, 118.88097957600007 28.963953768000067, 118.88211330500008 28.96603525200004, 118.88269453800001 28.967102371000067, 118.88279407800007 28.967285124000057, 118.88315357500005 28.967945146000034, 118.88343334100011 28.968446166000035, 118.8849403480001 28.971145003000061, 118.88561635400004 28.972405041000059, 118.88608077200001 28.973270692000028, 118.88633247200005 28.974912391000032, 118.88639591300011 28.975666467000053, 118.88572615500004 28.975774041000079, 118.88543084300011 28.975836848000029, 118.88492745200006 28.975943909000023, 118.8842531680001 28.976111318000051, 118.88365198200006 28.976349447000075, 118.88304664900011 28.976611489000049, 118.88235741300002 28.977085017000036, 118.88001649400007 28.978828586000077, 118.88001594500008 28.978829182000027, 118.88001470800009 28.978830769000069, 118.88000986700001 28.978836987000079, 118.87980701900005 28.979097370000034, 118.87960308000004 28.979397173000052, 118.87925077300008 28.97997173400006, 118.87914064000006 28.980151344000035, 118.87867746800009 28.980975278000074, 118.87867744700009 28.980975346000037, 118.87852133400008 28.981475746000058, 118.87808732700012 28.983214732000079, 118.87787359400011 28.983743490000052, 118.87768552000011 28.983892320000052, 118.8755325950001 28.984252826000045, 118.87504033000005 28.984306196000034, 118.87450498400005 28.984320922000052, 118.87399022200009 28.984317507000071, 118.87348216900011 28.984253677000027, 118.87308424200012 28.984170180000035, 118.87297482000008 28.984140840000066, 118.87268272600011 28.984062519000076, 118.87260615200012 28.984035998000024, 118.87197001900006 28.983815676000063, 118.8713690510001 28.983604557000035, 118.87090955700012 28.98343731500006, 118.87079458700009 28.983395469000072, 118.86924732900002 28.982537708000052, 118.86686591500006 28.980363157000056, 118.8655810250001 28.97855551300006, 118.86546466900006 28.978391817000045, 118.86237058800009 28.972918555000035, 118.86233427700006 28.972856686000057, 118.86231377600006 28.97282175600003, 118.86229325900001 28.972786799000062, 118.8622569690001 28.972724968000023, 118.86217721200001 28.972589070000026, 118.86165747000007 28.971703475000027, 118.8612712370001 28.971045367000045, 118.8606690360001 28.970019251000053, 118.8605744460001 28.969680203000053, 118.86040178500002 28.969061312000065, 118.86028382300003 28.968360508000046, 118.86021977400003 28.967979994000075, 118.85944800100003 28.964676319000034, 118.85880764100011 28.962539335000031, 118.85814994500004 28.960344497000051, 118.85767353400001 28.958485857000028, 118.85699048400011 28.955821042000025, 118.85691678400008 28.955533511000056, 118.85681642500003 28.955141979000075, 118.85669442000005 28.954665995000028, 118.85664342500002 28.954416690000073, 118.8565602760001 28.954010175000064, 118.85650909700007 28.95367883800003, 118.85607345800008 28.95135833300003, 118.85597205100009 28.950818167000079, 118.85467031100006 28.94780232200003, 118.85285442800011 28.946059412000068, 118.85231790400007 28.945826842000031, 118.85247536500003 28.945743609000033, 118.85248796600001 28.945632649000061, 118.85226424000007 28.945022114000039, 118.85203171700005 28.944387572000039, 118.85129157100005 28.942509139000038)))";
        private const string kcegion = "MULTIPOLYGON (((118.87819645200011 28.954458963000036, 118.87836933500012 28.954478314000028, 118.87844258500002 28.954486514000052, 118.8788080700001 28.954527426000027, 118.88295347200005 28.954991454000037, 118.88478688400005 28.954690967000033, 118.88480542200011 28.954687929000045, 118.88549145000002 28.95457549200006, 118.88816914800009 28.95413663100004, 118.88817113400012 28.954137471000024, 118.8886300690001 28.95442528600006, 118.88891396000008 28.954608465000035, 118.88954297800001 28.954997806000051, 118.89449738700011 28.95810490100007, 118.89872311500005 28.96075501200005, 118.89882550700008 28.96082089600003, 118.89890360300001 28.960868203000075, 118.90028022700005 28.961731536000059, 118.90744603400003 28.966225480000048, 118.90784186400003 28.966512894000061, 118.90790751400004 28.966591626000024, 118.90795411800002 28.966628097000068, 118.90802700100005 28.966647708000039, 118.90802770100004 28.966647831000046, 118.91190408300008 28.969462484000076, 118.91275805700002 28.970082557000069, 118.91347308400009 28.971632936000049, 118.9153970640001 28.972518137000066, 118.91593541600002 28.972765826000057, 118.91657723600008 28.973365743000045, 118.9165983150001 28.97339772600003, 118.91663486200002 28.973419605000061, 118.91786738000008 28.974571654000044, 118.91807125700007 28.974864988000036, 118.91987610700005 28.977461769000058, 118.92016190000004 28.981056694000074, 118.92026096100005 28.982302759000049, 118.9214901360001 28.985062003000053, 118.91895310300004 28.986600331000034, 118.91757728400012 28.987268578000055, 118.9166103980001 28.987762534000069, 118.91614258200002 28.988001528000041, 118.91608882300011 28.988038859000028, 118.91381027900002 28.989183211000068, 118.90989769400005 28.989347495000061, 118.9070124110001 28.988305172000025, 118.90655025500007 28.988138216000038, 118.90646904200003 28.988108877000059, 118.90451241300002 28.987402035000059, 118.90116750000004 28.985421639000037, 118.90013445700004 28.984122141000057, 118.89845325900001 28.98200730800005, 118.89731639700005 28.980871121000064, 118.89487641100004 28.978432587000043, 118.89268211300009 28.97726186500006, 118.8909297240001 28.976326915000072, 118.88700682000001 28.975609745000042, 118.88668470400012 28.975639654000076, 118.88639591300011 28.975666467000053, 118.88633247200005 28.974912391000032, 118.88608077200001 28.973270692000028, 118.88561635400004 28.972405041000059, 118.88552270000002 28.972206465000056, 118.88529174900009 28.971756421000066, 118.8849403480001 28.971145003000061, 118.8841240160001 28.969683068000052, 118.88343334100011 28.968446166000035, 118.8834219690001 28.968424947000074, 118.88315357500005 28.967945146000034, 118.8828796250001 28.967441185000041, 118.88279407800007 28.967285124000057, 118.88269453800001 28.967102371000067, 118.88226054500001 28.966301737000038, 118.88219024300008 28.966174498000044, 118.88211330500008 28.96603525200004, 118.8819107060001 28.965663286000051, 118.88097957600007 28.963953768000067, 118.87928841600001 28.960832141000026, 118.87909958700004 28.96027428900004, 118.8788458360001 28.958939782000073, 118.87868482900001 28.958093033000068, 118.87865328500004 28.95791351500003, 118.87861380300001 28.957688810000036, 118.87859634800009 28.957607732000042, 118.87846270000011 28.956874709000033, 118.87830046600004 28.955490441000052, 118.87826436400007 28.955182402000048, 118.87791138600005 28.954538549000063, 118.87784626400003 28.954419763000033, 118.87819645200011 28.954458963000036)), ((118.85248796600001 28.945632649000061, 118.85247536500003 28.945743609000033, 118.85231790400007 28.945826842000031, 118.85179272100004 28.945599188000074, 118.85055186600005 28.945061308000049, 118.8501728120001 28.945014438000044, 118.8465220380001 28.944563016000075, 118.84332524500007 28.944567004000078, 118.84107075700001 28.944569816000069, 118.84009836700011 28.944561751000037, 118.84001737400001 28.944561079000039, 118.84017773300002 28.945393320000051, 118.84021588600001 28.945591322000041, 118.84028735600009 28.945962245000032, 118.84060934700005 28.948819378000053, 118.84020364700007 28.951528287000031, 118.84012827200002 28.951701830000047, 118.83884254200007 28.954662066000026, 118.83855440900004 28.955252340000072, 118.83844768800009 28.955470124000044, 118.83803179300003 28.956322986000032, 118.83781106000004 28.956775634000053, 118.83775487000003 28.956890297000029, 118.83741651900004 28.957583450000072, 118.83732194300001 28.957777200000066, 118.83716744500009 28.958099949000029, 118.83706129000007 28.958315000000027, 118.83698464300005 28.958470271000067, 118.83686879600009 28.958705528000053, 118.83583213100007 28.960829266000076, 118.83466298400003 28.963230511000063, 118.83465902600005 28.963238638000064, 118.8343470850001 28.963882446000071, 118.83346334900011 28.965695032000042, 118.83322749800004 28.966178772000035, 118.83115703500005 28.970457877000058, 118.8305129040001 28.972312430000045, 118.83019018700008 28.974613994000038, 118.83024857000009 28.976515352000035, 118.83027875800008 28.97749847800003, 118.83037999700002 28.979451281000024, 118.83061773800011 28.984037100000023, 118.83070544000009 28.986148014000037, 118.83130982700004 28.987073390000035, 118.83206241800008 28.987465254000028, 118.83230285500008 28.987556985000026, 118.83255582700008 28.987639510000065, 118.83466231300008 28.987970475000054, 118.8438976000001 28.989421495000045, 118.84674147700002 28.99020600700004, 118.85053145500001 28.991442406000033, 118.85288624200007 28.992210606000071, 118.85450256000001 28.992771366000056, 118.85468703100003 28.99283536400003, 118.85479168000006 28.992871669000067, 118.85487766500012 28.992888159000074, 118.85491410100008 28.992896416000065, 118.85496771900011 28.992908563000071, 118.85728746600012 28.99368641600006, 118.85758166700009 28.993785067000033, 118.85758987400004 28.993787819000033, 118.85981421800011 28.994533682000053, 118.85981954500005 28.994536188000041, 118.85986476100004 28.994557459000077, 118.85991032700008 28.994570785000064, 118.85996613000009 28.994587104000061, 118.86001833000012 28.994604751000054, 118.86009489100002 28.994630631000064, 118.86014473200009 28.994647479000037, 118.86017120300005 28.994657081000071, 118.86024703200007 28.99468458900003, 118.86032286900002 28.994712099000026, 118.86038127100005 28.994733289000067, 118.86039875300003 28.994739495000033, 118.86047480600007 28.994766509000044, 118.86055086700003 28.994793522000066, 118.86062692000007 28.994820535000031, 118.86070297900005 28.994847546000074, 118.86074755300001 28.994863382000062, 118.86077917300008 28.994874247000041, 118.86085557000001 28.994900504000043, 118.86089934200004 28.994915549000041, 118.86091028500005 28.994902527000079, 118.86091137900007 28.994901580000032, 118.86093152900003 28.994884139000078, 118.86098377500002 28.994908588000044, 118.86098940900001 28.994910379000032, 118.86101159900011 28.99491744200003, 118.86108873400008 28.994941999000048, 118.86116587600009 28.994966559000034, 118.86122539300004 28.994985504000056, 118.8612428240001 28.99499155500007, 118.86131912200005 28.995018039000058, 118.86139541400007 28.995044525000026, 118.86147170700008 28.995071012000039, 118.86152452900001 28.995089349000068, 118.86154800500003 28.995097498000064, 118.86162429700005 28.995123981000063, 118.86170059400001 28.995150465000052, 118.86171025700003 28.995153823000066, 118.86177673100008 28.995177306000073, 118.86185284700002 28.995204194000053, 118.86192896600005 28.995231084000068, 118.86200404900001 28.995257608000031, 118.86200508700006 28.995257966000054, 118.86208105800006 28.995284149000042, 118.86215742500008 28.995310471000039, 118.86223379300009 28.995336793000035, 118.86231015800001 28.995363114000043, 118.8623865290001 28.995389438000075, 118.86240044100009 28.99539423300007, 118.86246289600001 28.995415760000071, 118.86246814000003 28.995417565000025, 118.86253879200001 28.995443170000044, 118.86261465200005 28.995470662000059, 118.86269051200009 28.995498156000053, 118.8659381440001 28.996595283000033, 118.86706796600004 28.996669661000055, 118.86782612500008 28.995633482000073, 118.86861374700004 28.994679604000055, 118.86934025900007 28.993799737000074, 118.87045117500008 28.992033157000037, 118.86966073000008 28.989604679000024, 118.86940295200009 28.988812706000033, 118.86954085900004 28.987714383000025, 118.87029973100005 28.985911877000035, 118.87058289800007 28.985239283000055, 118.8713690510001 28.983604557000035, 118.87197001900006 28.983815676000063, 118.87260615200012 28.984035998000024, 118.87268272600011 28.984062519000076, 118.87308424200012 28.984170180000035, 118.87348216900011 28.984253677000027, 118.87399022200009 28.984317507000071, 118.87450498400005 28.984320922000052, 118.87504033000005 28.984306196000034, 118.8755325950001 28.984252826000045, 118.87768552000011 28.983892320000052, 118.87787359400011 28.983743490000052, 118.87808732700012 28.983214732000079, 118.87852133400008 28.981475746000058, 118.87867744700009 28.980975346000037, 118.8786778110001 28.980975466000075, 118.88051501400003 28.98198489400005, 118.87935205100007 28.98566293600004, 118.8789655170001 28.989032773000076, 118.88136568400012 28.990003714000068, 118.88195313600011 28.991941906000079, 118.87943270300002 28.995287181000037, 118.87612512800001 28.996816239000054, 118.87588590700011 28.998339814000076, 118.8756989420001 29.000518272000079, 118.87360671200008 29.001606577000075, 118.87089367200008 29.002066882000065, 118.8710298310001 29.002335238000057, 118.87166068600004 29.003578590000075, 118.87440410500005 29.004672931000073, 118.87500688900002 29.004913381000051, 118.87532992800004 29.005042240000023, 118.87544346900006 29.005231932000072, 118.87626597000008 29.006606086000033, 118.87679194900011 29.007484838000039, 118.87591615000008 29.009299536000071, 118.87573779600007 29.00966909300007, 118.8740727280001 29.009585772000037, 118.87332030700009 29.009548120000034, 118.87347438900008 29.010046213000066, 118.87355561400011 29.010308788000032, 118.87415307300012 29.012240167000073, 118.87335715600011 29.014783843000032, 118.87351606900006 29.01488316800004, 118.87427848300001 29.015359699000044, 118.87498119300005 29.015798913000026, 118.87573925200002 29.016521970000042, 118.87758669100003 29.018284106000067, 118.87759617100005 29.018499053000028, 118.87769735100005 29.020793156000025, 118.87817704800011 29.02104448700004, 118.88193196700001 29.023011824000037, 118.88276956100003 29.023450670000045, 118.88365524500011 29.023652132000052, 118.88384853900004 29.023696100000052, 118.88583703800009 29.024148413000034, 118.88931696100008 29.024939974000063, 118.88975634500002 29.025039918000061, 118.89051047600003 29.025211456000079, 118.89116056100011 29.025359328000036, 118.89170912800012 29.025697222000076, 118.89315655200005 29.02658877500005, 118.89315395200003 29.026597872000025, 118.89320143100008 29.026617828000042, 118.89321566500007 29.026625187000036, 118.89366495400009 29.026901930000065, 118.8947333210001 29.026509745000055, 118.89535743600004 29.026718666000079, 118.89794987900007 29.027586480000025, 118.8964952230001 29.029880624000043, 118.89634161000004 29.030122886000072, 118.89573748800001 29.031075650000048, 118.89511772700007 29.031052011000043, 118.89427914100008 29.031020025000032, 118.89427136800009 29.031021784000075, 118.89421918400001 29.031017739000049, 118.89363361100004 29.031232205000038, 118.8920147340001 29.031825117000039, 118.88904344700006 29.033146802000033, 118.88855155600004 29.032565566000073, 118.88827044700008 29.032233398000074, 118.88771907500006 29.031582829000058, 118.88743372100009 29.03124613600005, 118.88634296200007 29.029959137000048, 118.88637888200003 29.030765245000055, 118.88639668000008 29.031164664000073, 118.88640745400005 29.031406471000025, 118.88643472600006 29.03201849900006, 118.88587997700006 29.03255686600005, 118.88465969300012 29.033741119000069, 118.88435271200001 29.033855018000054, 118.88362319600003 29.034125692000032, 118.88273467200008 29.034455363000063, 118.88243494200003 29.034489638000025, 118.88049914200008 29.034711001000062, 118.88059137200003 29.034969700000033, 118.88065512900005 29.035148534000029, 118.88105882900004 29.036280882000028, 118.88135424200004 29.037109495000038, 118.88121763200002 29.037352822000059, 118.88114529200004 29.037481675000038, 118.88101920400004 29.037706259000061, 118.88074510600006 29.038194479000026, 118.88030150900011 29.038984609000067, 118.87984677300005 29.039794579000045, 118.87985867900011 29.039873299000078, 118.88009989000011 29.04146810900005, 118.88032813900008 29.042664426000044, 118.88050369200005 29.043584550000048, 118.88064569500011 29.044328824000047, 118.88193002500009 29.044867747000069, 118.88309841500006 29.045358020000037, 118.88310746700006 29.045438142000023, 118.88321302500003 29.046372403000078, 118.88339810800005 29.048010525000052, 118.88343944000007 29.048376340000061, 118.88333044400008 29.048538854000071, 118.88304741800005 29.048960846000057, 118.88026052700002 29.053116107000051, 118.88031781000007 29.05323749400003, 118.88051043400003 29.053645676000031, 118.88073394600008 29.054119312000068, 118.88110180600006 29.05489883000007, 118.88150140000005 29.055745595000076, 118.88338749900004 29.056990880000058, 118.88505909700007 29.058094544000028, 118.88527775800003 29.059496142000057, 118.88533294300009 29.059849869000061, 118.88538237000012 29.060166694000031, 118.88219532100004 29.062653113000067, 118.88226598000006 29.062723122000079, 118.88287250600001 29.063324068000043, 118.8834850500001 29.06393097800003, 118.88402938200011 29.064470302000075, 118.88570157600009 29.06612711300005, 118.88538835600002 29.066420615000027, 118.88510222400009 29.066688734000024, 118.88381715700007 29.06789290100005, 118.88337598300006 29.068306302000053, 118.88292927400005 29.068288709000058, 118.88275762600006 29.06827966700007, 118.88270772800001 29.068283149000024, 118.88270421400011 29.06828517100007, 118.87957582400009 29.068186765000064, 118.8798893930001 29.070359857000028, 118.8794292770001 29.070682371000032, 118.87784355100007 29.071793868000043, 118.87745451100011 29.072066562000032, 118.87733220400003 29.072152291000066, 118.8769354750001 29.072430374000078, 118.87676352000005 29.073313945000052, 118.87670500400009 29.073614624000072, 118.8764964720001 29.074686138000061, 118.87723031200005 29.075449331000073, 118.87773062000008 29.075969651000037, 118.87747315000001 29.076235302000043, 118.87718078000012 29.076536961000045, 118.87585818200012 29.077901583000028, 118.87566058200002 29.078105463000043, 118.87534557000004 29.078430484000023, 118.87419554100006 29.078729232000057, 118.87367331600001 29.078864894000048, 118.8722598060001 29.079232088000026, 118.86994309600004 29.080927200000076, 118.86837364600001 29.08207555000007, 118.86942751300001 29.080694756000071, 118.86951808000003 29.080576094000037, 118.87014214900012 29.079758428000048, 118.87058580200005 29.079177146000063, 118.87202741800002 29.077288317000068, 118.87056252500008 29.078514437000024, 118.87033962700002 29.078701003000049, 118.86940440400008 29.079483788000061, 118.86881703800009 29.079975415000035, 118.86762078900006 29.08097667800007, 118.86729608700011 29.081248454000047, 118.86506996200001 29.083111728000063, 118.86478036700009 29.082477691000065, 118.86459902000001 29.082080654000038, 118.86378317500009 29.080294456000047, 118.86306518000004 29.081854003000046, 118.86273834600001 29.082563911000079, 118.86245173500004 29.083186457000068, 118.85851739200007 29.084792893000042, 118.85833057100001 29.085693625000033, 118.85762491700007 29.089095842000063, 118.85749750500008 29.089710144000037, 118.85716035700011 29.090258153000036, 118.85646725800007 29.091384738000045, 118.85574761300006 29.09255446800006, 118.85545775800006 29.093025607000072, 118.85459340800003 29.094430546000069, 118.85448846200006 29.094501416000071, 118.85436554600005 29.094564108000043, 118.85436080000011 29.094566081000039, 118.85364860600009 29.094981057000041, 118.85289532800005 29.095419972000059, 118.8516111350001 29.096168237000029, 118.84988632900001 29.097173235000071, 118.8493615750001 29.100103822000051, 118.84900046600001 29.102120504000027, 118.84880978900003 29.103185372000041, 118.8484968250001 29.104933177000078, 118.84833111800003 29.105858600000033, 118.84823969600006 29.106369168000072, 118.84813082200003 29.106977194000024, 118.84807586900001 29.107530644000065, 118.84784194700001 29.109886536000033, 118.84778769400009 29.110432939000077, 118.84773734400005 29.110940021000033, 118.84755350500006 29.112791528000059, 118.8472087670001 29.116263489000062, 118.84602036500007 29.117679850000059, 118.84578551000004 29.117959755000072, 118.84336718700001 29.120841962000043, 118.84283000100004 29.121482191000041, 118.84119917100008 29.123547114000075, 118.84080274900009 29.124049055000057, 118.84056206900004 29.124353800000051, 118.84028893600009 29.124699634000024, 118.83937591600011 29.125855681000075, 118.83877903400003 29.126611443000058, 118.83463572500011 29.131857614000069, 118.83473677200004 29.132079438000062, 118.83603379400006 29.134926733000043, 118.8380450840001 29.139342029000034, 118.83877994300008 29.140955234000046, 118.83933604400011 29.142176017000054, 118.83940688000007 29.142949883000028, 118.83946061500001 29.143536916000073, 118.83950219000008 29.143991104000065, 118.83996679100005 29.149066747000063, 118.83836477600005 29.147877767000068, 118.83742906300006 29.14718330200003, 118.83137052900008 29.142686795000031, 118.8305941750001 29.142632783000067, 118.82736776100012 29.142408315000068, 118.8256297690001 29.142287400000043, 118.8252627170001 29.142971043000045, 118.82490076400006 29.143645191000076, 118.82423672100003 29.144881988000066, 118.82336316100009 29.146509018000074, 118.82336282800009 29.146569735000071, 118.82336249600007 29.146630454000046, 118.8233693410001 29.14664573400006, 118.82350766800005 29.149705462000043, 118.82380914600003 29.15637406500008, 118.82392605700011 29.158960079000053, 118.82483355400007 29.16103933900007, 118.82519512300007 29.161867766000057, 118.8266039770001 29.165095735000079, 118.82480279000004 29.167102344000057, 118.82221304200004 29.16998744600005, 118.82343624000009 29.172527111000079, 118.8258746140001 29.177589789000024, 118.82621970300011 29.178306279000026, 118.82676529200012 29.179702826000039, 118.82752474500001 29.181646809000028, 118.82326683700001 29.182013823000034, 118.82304486800001 29.181946314000072, 118.82271273900005 29.181845301000067, 118.81883624600005 29.180666313000074, 118.81805737000002 29.180429428000025, 118.81633803600005 29.179906514000038, 118.81468493900002 29.180878712000037, 118.81255872600002 29.182129151000026, 118.81059974700008 29.181624046000024, 118.80819560700002 29.181004159000054, 118.80594320400007 29.180912599000067, 118.80481461700003 29.180866722000076, 118.80328623200012 29.180804593000062, 118.80267351800001 29.179258463000053, 118.80185950400005 29.177204368000048, 118.80095450300007 29.178590642000074, 118.80048820100001 29.17930491900006, 118.79980080900009 29.180357861000061, 118.79927303600005 29.18116629900004, 118.79926643700003 29.181245755000077, 118.79905147800002 29.183833746000062, 118.79899133000004 29.184557893000033, 118.79872213800002 29.18473102400003, 118.79729552800006 29.18564854300007, 118.7946232920001 29.187367183000049, 118.79322783600003 29.188264666000066, 118.79123206700001 29.187549922000073, 118.7862047320001 29.185749482000062, 118.78470616300001 29.185212800000045, 118.78369722500008 29.185421950000034, 118.78357722600003 29.185502700000029, 118.78327042400008 29.185567720000051, 118.7830181810001 29.185574056000064, 118.7829822110001 29.185570171000052, 118.77979720600001 29.186230413000033, 118.77972552500012 29.186275701000056, 118.77950801000009 29.186351907000073, 118.77876607400003 29.186506250000036, 118.77831014300011 29.186538678000034, 118.77178065700002 29.187892222000073, 118.76625574200011 29.192580185000054, 118.76021240300008 29.19283994400007, 118.75878884500003 29.193003065000028, 118.75878352700011 29.193003677000036, 118.75878048400011 29.192994420000048, 118.75869683100007 29.192936497000062, 118.75853551200009 29.192824797000071, 118.75847632700004 29.192752411000072, 118.75847514000009 29.192629243000056, 118.75854596300007 29.192427396000028, 118.75858067900003 29.192328453000073, 118.75857384400001 29.192247096000074, 118.75838662800004 29.192102250000062, 118.75799950800001 29.191802739000025, 118.75764985500007 29.191479267000034, 118.75761752500011 29.191337485000076, 118.7576287710001 29.191127294000069, 118.75763754000002 29.190963427000042, 118.75760661400011 29.190833206000036, 118.75755344700008 29.190731103000076, 118.7571518530001 29.190434138000057, 118.75697687500008 29.190339470000026, 118.75661433700009 29.190143325000065, 118.75627810500009 29.189784515000042, 118.75611911300007 29.18961484600004, 118.75586211100006 29.18934058800005, 118.75468546100001 29.188167143000044, 118.75165364800012 29.185143590000052, 118.75180266300003 29.184754793000025, 118.75243371100009 29.183108316000073, 118.75277592000009 29.182215453000026, 118.7529963830001 29.181640237000067, 118.7542081580001 29.178086380000025, 118.75408475200004 29.176189068000042, 118.75398626100002 29.174674799000059, 118.75383853700009 29.172403579000047, 118.75215311700003 29.171565361000034, 118.75009517000001 29.170541873000047, 118.74971581400007 29.170353206000073, 118.7494965730001 29.170244170000046, 118.74283008800001 29.166039092000062, 118.74262527500002 29.165909901000077, 118.74188651000009 29.165443903000039, 118.73953213800007 29.163958815000058, 118.73954412400008 29.163888886000052, 118.74024377600006 29.159806701000036, 118.74039523700003 29.158922991000054, 118.74038894600005 29.158888371000046, 118.73994691300004 29.156455516000051, 118.73927142800005 29.152737804000026, 118.7387859800001 29.15251747700006, 118.73826810100002 29.15228243200005, 118.73364442200011 29.15018391600006, 118.73338030800005 29.146763552000039, 118.73328691500001 29.145554082000046, 118.73295933400004 29.141311816000041, 118.73376201700012 29.138407869000048, 118.73557462300005 29.131850223000072, 118.73517274000005 29.130561578000027, 118.73301214300011 29.123633583000071, 118.73288356700004 29.123221302000047, 118.72866408100003 29.121242302000041, 118.72824947800007 29.121047846000067, 118.72268862900012 29.118439727000066, 118.72138380100012 29.114879008000059, 118.72105353500001 29.11397775100005, 118.71988457200007 29.110787789000028, 118.71961886300005 29.110062698000036, 118.71939330200007 29.109447171000056, 118.71865264300004 29.109272080000039, 118.71770898900002 29.109049002000063, 118.7131626470001 29.107974253000066, 118.71149214200011 29.107579348000058, 118.71092514100008 29.106974523000076, 118.71044443500011 29.106461750000051, 118.70462315700001 29.100252144000024, 118.7043771430001 29.099989718000074, 118.70381885900008 29.099394192000034, 118.70367828400003 29.097662152000055, 118.7031200560001 29.094347761000051, 118.7029895500001 29.093572902000062, 118.70291469500012 29.093128461000049, 118.70363575100009 29.091893151000079, 118.7040504680001 29.091182658000037, 118.70353626300005 29.089137002000029, 118.7032797280001 29.088116432000049, 118.70313728600001 29.087549757000033, 118.70311729800005 29.087470235000069, 118.70256040200002 29.085254744000054, 118.70241854900007 29.080490013000031, 118.70241314400005 29.08030844600006, 118.70034525600011 29.074982262000049, 118.69922837200011 29.074203404000059, 118.69757137500005 29.073047897000038, 118.69604512700005 29.070860829000026, 118.69419922100008 29.068215701000042, 118.69394377200001 29.067849651000074, 118.69577170600007 29.064500071000055, 118.69581713500008 29.064399746000049, 118.69585799900005 29.064229816000079, 118.69587914700003 29.064100379000024, 118.6958825050001 29.064053857000033, 118.69587739100007 29.064019614000074, 118.69582869300007 29.063906531000043, 118.69580979800003 29.06385735300006, 118.69579660200009 29.063796053000033, 118.6957904520001 29.06371352900004, 118.69580531000008 29.063585743000033, 118.6958314200001 29.063470069000061, 118.69584312500001 29.063380776000031, 118.69584161100011 29.063321575000032, 118.69558739000001 29.063023813000029, 118.69483136500003 29.062138297000047, 118.69505964900009 29.061276551000049, 118.6953371080001 29.060229175000075, 118.69570436600009 29.058842818000073, 118.69586830800006 29.058223957000052, 118.69605825000008 29.057506950000061, 118.69662489700011 29.055367922000073, 118.69695504700007 29.054121644000077, 118.69591399300009 29.049690184000042, 118.69567564600004 29.048675610000032, 118.69325643100001 29.04355713700005, 118.69320583900003 29.043450094000036, 118.69300497300003 29.043025112000066, 118.69249367500004 29.041943328000059, 118.69083129300009 29.039400316000069, 118.69169543800001 29.037638328000071, 118.69226682800002 29.036473265000041, 118.6923686020001 29.03626575100003, 118.69275974000004 29.035468221000031, 118.69314862400006 29.034675289000063, 118.69388776800008 29.033168178000039, 118.69373541700008 29.030753079000078, 118.69370324100009 29.030243020000057, 118.69162723600004 29.029939343000024, 118.69023711300008 29.029735997000046, 118.69017994400008 29.029582460000029, 118.68814335400009 29.024112898000055, 118.68444636800007 29.017099140000028, 118.68381104100001 29.015726982000047, 118.6827129940001 29.013355455000067, 118.68319463800003 29.01267606600004, 118.6845803650001 29.010721413000056, 118.68542825700001 29.009525409000048, 118.68577469900004 29.009036732000027, 118.68606494300002 29.008627325000077, 118.68747338000003 29.006640639000068, 118.68759126100008 29.006474361000073, 118.68874877100006 29.004841622000072, 118.68678882100005 29.00335810100006, 118.68609736700012 29.00283472600006, 118.68611526900008 29.00280288600004, 118.68750014900002 29.000339757000063, 118.68947541700004 28.996826576000046, 118.69042145200001 28.99514397300004, 118.69166464800003 28.992932841000027, 118.69251356200004 28.991422976000024, 118.69247622900002 28.991368733000058, 118.69195304100003 28.990608588000043, 118.68981688600002 28.987504947000048, 118.68952423400003 28.987079750000078, 118.68825281600004 28.985232492000023, 118.68842606900012 28.984395695000046, 118.68875368400006 28.982813337000039, 118.68884976600009 28.982349272000079, 118.68909337500008 28.981172655000023, 118.68947318900007 28.979338183000038, 118.68991165200009 28.977220441000043, 118.69013219900012 28.976155216000052, 118.69019075800009 28.975872379000066, 118.69049760300004 28.97439034100006, 118.69557492000001 28.976341387000048, 118.70074050000005 28.971030322000047, 118.70191375800005 28.969824019000043, 118.70542521900006 28.966213660000051, 118.70666721900011 28.964936680000051, 118.71106680700007 28.962582519000023, 118.71246201100007 28.961835965000034, 118.71299014300007 28.961553368000068, 118.71346715100003 28.960968280000031, 118.72014275700008 28.952780119000067, 118.72081035000008 28.951961262000054, 118.72035766400006 28.950995025000054, 118.71766949300002 28.945257243000071, 118.71800993300008 28.945359217000032, 118.71804588400005 28.945347766000054, 118.71807302900004 28.945324420000077, 118.71834299700004 28.944484854000052, 118.71837121600004 28.943975471000044, 118.71703986700004 28.943192916000044, 118.71225512600006 28.940380489000063, 118.71180247200004 28.940114424000058, 118.71104784200008 28.939670860000035, 118.71049180600005 28.939344027000061, 118.70839089100002 28.938109128000065, 118.71893321200002 28.939928959000042, 118.71937404900007 28.935490633000029, 118.71613852900009 28.93372897200004, 118.71650987700002 28.93296097700005, 118.71354291200009 28.931009637000045, 118.71363683300001 28.930855808000047, 118.71369173300002 28.930765891000078, 118.71404530700011 28.930186789000061, 118.71415930900002 28.930000073000031, 118.71186492900006 28.928127793000044, 118.71175594700003 28.928038860000072, 118.71159773600004 28.927788312000075, 118.71105835100002 28.92693412400007, 118.7103718190001 28.927515179000068, 118.70992603600007 28.928932855000028, 118.70924429900003 28.928840678000029, 118.7092493450001 28.928432125000029, 118.70925793900005 28.927736381000045, 118.70950976200004 28.926726282000061, 118.70977476900009 28.926095201000066, 118.70992052400004 28.925748104000036, 118.71031292300006 28.925744702000031, 118.71137602700003 28.925553156000035, 118.71188268200001 28.92573711600005, 118.71182474800003 28.926773749000063, 118.71281365100003 28.92681858900005, 118.71311696800001 28.926832342000068, 118.71363074300007 28.927694804000055, 118.71369922400004 28.927809763000027, 118.7140102620001 28.928160278000064, 118.71427295900003 28.928456316000052, 118.71487615800004 28.929136073000052, 118.71539912800006 28.929479839000066, 118.71513611100011 28.928070012000035, 118.71510064200004 28.927879896000036, 118.71529332200009 28.927045795000026, 118.71469164700011 28.92703079000006, 118.71429742700002 28.926763696000023, 118.71384605800006 28.926457883000069, 118.71356756900002 28.926269199000046, 118.71290121300001 28.92576542300003, 118.71525723500008 28.924752125000055, 118.71589547200006 28.924462959000039, 118.71624456300003 28.924304795000069, 118.71629112200003 28.923248744000034, 118.71554277400003 28.92265549800004, 118.71543017600004 28.922566237000069, 118.71510584700002 28.922309128000052, 118.71484495700008 28.921545297000023, 118.71482864200004 28.921497530000067, 118.71425063400011 28.919805240000073, 118.71413173100007 28.919638339000073, 118.7134973200001 28.918747827000061, 118.71318522700005 28.917215727000041, 118.71302404200003 28.916424451000069, 118.71291488600002 28.914834736000046, 118.71245806400009 28.914453865000041, 118.7113523050001 28.913531946000035, 118.71101850600007 28.912072989000023, 118.71090551200007 28.911579115000052, 118.70930185000009 28.910718977000045, 118.70867545700003 28.910383006000075, 118.70775262400002 28.907512887000053, 118.70752321900011 28.90679940900003, 118.70442513800003 28.906483560000027, 118.70370974500008 28.906198853000035, 118.70284932100003 28.90585642800005, 118.70109283500005 28.90515739500006, 118.69751709800005 28.899671025000032, 118.69733676100009 28.899263520000034, 118.69708146500011 28.898686628000064, 118.69635860000005 28.897053174000064, 118.69625672900008 28.896822977000056, 118.69459594900002 28.895274010000037, 118.69436979200009 28.895212690000051, 118.69366079000008 28.895020450000061, 118.69300876200009 28.894981191000056, 118.69091632000004 28.894855201000041, 118.69045589100006 28.894827478000025, 118.68335717200011 28.894400053000027, 118.6816834760001 28.893730573000028, 118.68287458200007 28.891855772000042, 118.68325147400003 28.891262544000028, 118.68370901200001 28.890542378000077, 118.68746007700008 28.890102889000048, 118.6876043740001 28.89019759200005, 118.68809125400003 28.890517135000039, 118.68926664100002 28.89128855000007, 118.68931614600001 28.89126918900007, 118.69527825000011 28.888937423000073, 118.69534533400008 28.888911187000076, 118.6978062390001 28.887621080000031, 118.69860671700008 28.887201437000044, 118.69926391000001 28.886597515000062, 118.70144501800007 28.884593204000055, 118.70282158500004 28.885891752000077, 118.70530281700007 28.885281465000048, 118.70669049300011 28.883635235000042, 118.70411038300006 28.882951433000073, 118.70267472600005 28.882336541000029, 118.70226341200009 28.88150319600004, 118.70223359800002 28.88144279200003, 118.70170443300003 28.880370672000026, 118.70127104100004 28.879492595000045, 118.70150749400011 28.877905754000039, 118.70165956700009 28.876885187000028, 118.70332706200008 28.875015060000067, 118.7037827690001 28.874503976000028, 118.70423056600009 28.87400176400007, 118.70453390800003 28.873661560000073, 118.70507341700011 28.87313546300004, 118.70518337600004 28.873028238000074, 118.70597115500004 28.872190500000045, 118.70611306800004 28.872003835000044, 118.70651680900005 28.871472772000061, 118.70679898200001 28.871321949000048, 118.70684586000004 28.871308702000078, 118.70701076600005 28.871294010000042, 118.70714690400007 28.871158618000038, 118.7072391480001 28.871066881000047, 118.70755976000009 28.870748028000037, 118.70794863600008 28.870068066000044, 118.70945120300007 28.868873649000079, 118.71014664400002 28.868320831000062, 118.7104569920001 28.868074130000025, 118.71065856600001 28.867772222000042, 118.71126467400006 28.866864423000038, 118.71160582800007 28.86700670700003, 118.71202671800006 28.867182245000038, 118.7109626350001 28.867778933000068, 118.71123784800011 28.867790529000047, 118.71132647900004 28.867794264000054, 118.71142795300011 28.867798539000034, 118.71149988700006 28.86780157000004, 118.71194663200004 28.867529313000034, 118.71156561100008 28.868276601000048, 118.71154440500004 28.86831819300005, 118.71137966300012 28.868641298000057, 118.71112865400005 28.868971575000046, 118.71104920500011 28.869076115000041, 118.71005279000008 28.869347676000075, 118.71010624100006 28.869373944000074, 118.71163688400009 28.870126167000024, 118.71189488200002 28.870252958000037, 118.7120041820001 28.870184277000078, 118.71242431500002 28.869920278000052, 118.71291748200008 28.870065550000049, 118.71308018000002 28.870113476000029, 118.71357438700011 28.86961505000005, 118.71384151500001 28.869345641000052, 118.71386325500009 28.869071468000072, 118.71372020900003 28.868706342000053, 118.71446343000002 28.868173316000025, 118.71484409300001 28.867900310000039, 118.71584062600004 28.867339179000055, 118.71609759400008 28.866773544000068, 118.71749529100009 28.865232585000058, 118.71856298900002 28.864055448000045, 118.72069223900007 28.863930528000026, 118.72080684900004 28.863923804000024, 118.72105067600012 28.863640743000076, 118.72132953100004 28.863317019000078, 118.72211713700005 28.862402681000049, 118.72225518000005 28.862242426000023, 118.7227327060001 28.861688064000077, 118.72325730600005 28.861079051000047, 118.72328772500009 28.860973036000075, 118.72397906500009 28.858563622000077, 118.72610143700001 28.857273720000023, 118.72736851800005 28.854928313000073, 118.72872786400001 28.852412122000032, 118.72927357600008 28.849059021000073, 118.72940718100006 28.848238092000031, 118.73032228400007 28.846455684000034, 118.73034722900002 28.846178007000049, 118.73039403700011 28.845656943000051, 118.73044220500003 28.845120744000042, 118.73048801100003 28.844610831000068, 118.73051245200008 28.844338758000049, 118.7320617690001 28.843409797000049, 118.73251139600006 28.843140203000075, 118.73279556200009 28.842969819000075, 118.73285027000009 28.842937016000064, 118.73308654800007 28.842146512000056, 118.73321488900001 28.841717128000028, 118.73300413400011 28.841387355000052, 118.7328116760001 28.841086215000075, 118.73196601400002 28.839762994000068, 118.73281040800009 28.838201112000036, 118.73214478800003 28.836749371000053, 118.73208723500011 28.836623846000066, 118.73278792800011 28.835289767000063, 118.73279410400005 28.835248124000032, 118.73343726400003 28.835387667000077, 118.73384226600001 28.835312604000023, 118.73620808800001 28.834874125000056, 118.73661159300002 28.834882417000074, 118.73704199500003 28.834891261000053, 118.73905419100004 28.834932610000067, 118.73912473700011 28.834957921000068, 118.73944318200006 28.83507217600004, 118.73969123600011 28.835161175000053, 118.74146200600001 28.835796506000065, 118.74254381100002 28.83618464500006, 118.74298089700005 28.837454399000023, 118.74333357100011 28.838073607000069, 118.74367392600004 28.838671189000024, 118.74524665000001 28.839304009000045, 118.74615918000006 28.839671185000043, 118.74706264500003 28.840034715000058, 118.7495028510001 28.841786166000077, 118.7506038460001 28.844176520000076, 118.75029576200006 28.847833116000061, 118.75023882500011 28.849577735000025, 118.75230212200006 28.85166166700003, 118.75277978400004 28.851896894000049, 118.75447536400009 28.852731891000076, 118.75795704600012 28.854875382000046, 118.76077939800007 28.856765480000035, 118.7649268130001 28.859542958000077, 118.7670747200001 28.862112935000027, 118.76705677600012 28.862334650000037, 118.76680608800007 28.865432062000025, 118.76925656200001 28.866673071000037, 118.77134928000009 28.867315653000048, 118.77137145600011 28.867350669000075, 118.77144094100004 28.867392904000042, 118.77161583800012 28.867438654000068, 118.7720058860001 28.867517267000039, 118.77229036600011 28.868109196000034, 118.77216166900007 28.868592855000031, 118.77195874900008 28.869355451000047, 118.77190920600003 28.869541644000037, 118.77175701900001 28.87011357800003, 118.77292021400001 28.870527297000024, 118.77314116800005 28.870605885000032, 118.77326730300001 28.87065074800006, 118.77347972500002 28.871765229000061, 118.77342381200003 28.871830933000069, 118.77337239600001 28.871940824000035, 118.77337307500011 28.871957888000054, 118.77280726300012 28.872980010000049, 118.77226521300008 28.873568720000037, 118.77205456000002 28.873797505000027, 118.7715476300001 28.874348072000032, 118.77097760400011 28.874967164000054, 118.77002729300011 28.875752618000035, 118.76911207800003 28.87650906600004, 118.76809913700004 28.878707357000053, 118.7684855330001 28.879773837000073, 118.76925979400005 28.880761825000036, 118.76969115000009 28.881312254000079, 118.77147790600009 28.881755673000043, 118.77166313100008 28.881717708000053, 118.77270930900011 28.881503274000067, 118.77310586400006 28.88142199300006, 118.77316995700005 28.881778703000066, 118.7733403630001 28.882727101000057, 118.77354938200006 28.882895890000043, 118.77388250200011 28.883164896000039, 118.77415812400011 28.88338746900007, 118.77467015100001 28.883800948000044, 118.77492417000008 28.883399155000063, 118.77519838700005 28.882965416000047, 118.77544798600002 28.882570616000066, 118.77546627000004 28.882541694000054, 118.77623240700007 28.882377273000031, 118.77624456000001 28.882389326000066, 118.77629806200002 28.882420498000045, 118.77637838100009 28.882429109000043, 118.77642780000008 28.882405972000072, 118.77645087400003 28.882343271000025, 118.77644966700007 28.88233064700006, 118.77755623400003 28.88209316700005, 118.77786344100002 28.883095168000068, 118.77795188300001 28.884376063000047, 118.77803689400002 28.885607262000065, 118.7786661880001 28.887716727000054, 118.77915773200004 28.887772605000066, 118.78007037600003 28.88787635500006, 118.7810190990001 28.888319113000023, 118.78122822700004 28.888416710000058, 118.78240916900006 28.888967842000056, 118.78435154800002 28.888748357000054, 118.78599548900002 28.889768667000055, 118.78548205200002 28.890914681000027, 118.78541215500002 28.891070695000053, 118.7869606380001 28.890779143000032, 118.78821058400001 28.890543801000035, 118.78950576300008 28.891176775000076, 118.78969947600001 28.89148216600006, 118.79110625500005 28.893699967000032, 118.79377474800003 28.89524947600006, 118.7951918760001 28.895969798000067, 118.79705681900009 28.896085819000064, 118.7974566470001 28.895694730000059, 118.79824577600004 28.894922851000047, 118.79956857100001 28.896533987000055, 118.80002305500011 28.896236134000048, 118.80096404000005 28.895619446000069, 118.80135820600003 28.896443172000033, 118.80132231200002 28.896661651000045, 118.80110844300009 28.897963399000048, 118.80108228300003 28.898072692000028, 118.80104439400009 28.898200779000035, 118.80069241800004 28.899505269000031, 118.80038270700004 28.900653123000041, 118.80036294400009 28.900751353000032, 118.80027135600005 28.901065810000034, 118.80065875000003 28.902311883000039, 118.80090021800004 28.903088581000077, 118.80082552100009 28.903147697000065, 118.80070076000004 28.90318725700007, 118.80020733100002 28.903431368000042, 118.79995787900009 28.903554778000057, 118.79950459400004 28.903779029000077, 118.80075168000008 28.904106100000035, 118.80175844000007 28.90498604000004, 118.80210649600008 28.905290252000043, 118.80254356600005 28.905372722000038, 118.80318132900004 28.905493061000072, 118.80364886500001 28.905581280000035, 118.80401897500008 28.905651116000058, 118.80431509000005 28.905706990000056, 118.80689706400005 28.905157324000072, 118.80921958300007 28.905473475000065, 118.80954807000001 28.905889690000038, 118.80993528300007 28.906380313000057, 118.8101217090001 28.906616528000029, 118.81030968500011 28.907024607000039, 118.8109525000001 28.908420097000032, 118.81124579300001 28.909056810000038, 118.81146856800001 28.909540433000075, 118.81190631600009 28.909977868000055, 118.81234929000004 28.910420526000053, 118.81327915800011 28.911349732000076, 118.81455900300011 28.910439665000069, 118.81502247800006 28.910110099000065, 118.81485012600001 28.910840399000051, 118.81442012900004 28.912662401000034, 118.81484314600004 28.912962637000078, 118.81512312400002 28.913161350000053, 118.81579821100001 28.913640491000024, 118.81706085700011 28.91366374100005, 118.81728844800011 28.913667932000067, 118.81695973600006 28.914380658000027, 118.81695100000002 28.914390396000044, 118.81691407400001 28.914479664000055, 118.8170599450001 28.914647090000074, 118.81808792600009 28.915826974000026, 118.81830767000008 28.916083168000057, 118.81862575500008 28.916454017000035, 118.81916944500006 28.917087894000076, 118.81972562400006 28.917736331000071, 118.81996958500008 28.918669874000045, 118.82009585800006 28.91915307000005, 118.82044613400001 28.919381788000067, 118.82125234600005 28.919908216000067, 118.82145853300005 28.920042849000026, 118.82170054800008 28.920076585000061, 118.82290509900008 28.920244496000066, 118.82288169300011 28.920628993000037, 118.82285804600008 28.920814892000067, 118.82281955200006 28.921281534000059, 118.82510728400007 28.920821766000074, 118.82630481000001 28.920581098000071, 118.82639441200001 28.920580347000055, 118.82813032900003 28.920565812000063, 118.82958057300004 28.918943005000074, 118.82993550100002 28.918924134000065, 118.83059332800008 28.918889156000034, 118.83086916600007 28.918874490000064, 118.83087682000007 28.91909898800003, 118.83093816000007 28.920898174000058, 118.83188540300011 28.920741075000024, 118.83201246800002 28.920321189000049, 118.83203179200007 28.920157105000044, 118.8320318860001 28.920155979000072, 118.8323882410001 28.918732589000058, 118.83266005000007 28.917646905000026, 118.83345721900002 28.917217245000074, 118.83284020400004 28.916173506000064, 118.8321361620001 28.914982552000026, 118.82997749800006 28.91328823200007, 118.82990380600006 28.91323039100007, 118.82739446300002 28.91034221600006, 118.82854444300006 28.90966247800003, 118.82918880700004 28.910440974000039, 118.83793597800002 28.918321083000023, 118.84643043700009 28.915550784000061, 118.84975451100001 28.914751369000044, 118.85247788900006 28.914179473000047, 118.8545084000001 28.91461408300006, 118.85646065900005 28.91583406500007, 118.85774818100003 28.916386991000024, 118.8603196470001 28.916596446000028, 118.86405046700008 28.916570947000025, 118.8689155080001 28.916345943000067, 118.87811260400008 28.915212586000052, 118.88459716000011 28.914763252000057, 118.88548222000009 28.914714117000074, 118.89614908800002 28.914121941000076, 118.89964226400002 28.914173855000058, 118.89526449900006 28.920432414000061, 118.88544747100002 28.933609843000056, 118.8849706530001 28.934249876000024, 118.88488604700001 28.934363443000052, 118.88477246000002 28.934514916000069, 118.88327375100005 28.933496490000039, 118.88185836300011 28.932833692000031, 118.87897113100007 28.932266737000077, 118.87833824900008 28.932182617000024, 118.87807164500009 28.932147181000062, 118.87775883000006 28.932110669000053, 118.87608641100007 28.931895367000038, 118.87351133400011 28.931548409000072, 118.87121559500008 28.931239093000045, 118.87010887800011 28.931089978000045, 118.86858249400007 28.930888842000059, 118.86800453000001 28.930812682000067, 118.86783436900009 28.930789272000027, 118.86782854600006 28.930788471000028, 118.86742607700012 28.930733100000054, 118.86731040200004 28.930717184000059, 118.86696302200005 28.930672940000079, 118.86685574300009 28.930659277000075, 118.86639648300002 28.930600785000024, 118.86312226200005 28.930167120000078, 118.86248125300006 28.930082209000034, 118.86247645800006 28.930081575000031, 118.86245741200003 28.930079063000051, 118.86245220300009 28.93007837600004, 118.85992951500009 28.929745437000065, 118.85992245500006 28.929744506000077, 118.85981127600007 28.929729835000046, 118.85981124000011 28.929729830000042, 118.85805209300008 28.929495523000071, 118.85746600000004 28.929417459000035, 118.85718178400009 28.929379603000029, 118.85605149200001 28.929292777000057, 118.85543278300008 28.929245249000076, 118.85484965800003 28.929259050000041, 118.85360055900003 28.92928861300004, 118.85341727200012 28.929292951000036, 118.85276256100008 28.92934303100003, 118.85268269700009 28.929349140000056, 118.85089168800005 28.929486138000073, 118.84995411000011 28.929560468000034, 118.84839658600004 28.929683946000068, 118.84837864300005 28.929685368000037, 118.84747168400008 28.929757272000074, 118.84702934900008 28.929792338000027, 118.84701345500002 28.92979359800006, 118.84694504900006 28.929799020000075, 118.84619278300011 28.929860503000043, 118.84694233000005 28.931065728000078, 118.84699475500008 28.931170340000051, 118.84709641000006 28.931313481000075, 118.84764124700007 28.932189544000039, 118.84831522500008 28.933317861000035, 118.84856268900012 28.933732144000032, 118.84907050400011 28.934931318000054, 118.84943080700009 28.935782152000058, 118.84945601800007 28.935859496000035, 118.84985688100005 28.93708932100003, 118.85002411300002 28.937606674000051, 118.85002506500007 28.937609619000057, 118.85002932100008 28.937622786000077, 118.85003435700003 28.937638366000044, 118.85003437000012 28.93763840400004, 118.85032623200004 28.938541301000043, 118.85061844300003 28.940104038000072, 118.85066332000008 28.940264383000056, 118.85129157100005 28.942509139000038, 118.85154667100005 28.943156561000023, 118.85203171700005 28.944387572000039, 118.85226424000007 28.945022114000039, 118.85248796600001 28.945632649000061)))";
        private const string qjregion = "MULTIPOLYGON (((119.02377511000009 28.89664450500004, 119.01293909100002 28.887597021000033, 119.00847593600008 28.884097974000042, 118.99546799100006 28.873899941000047, 118.98602354000002 28.868179110000028, 118.97772070100007 28.864032264000059, 118.96360482500006 28.863183434000064, 118.9580417950001 28.863096929000051, 118.93252711700006 28.862700177000079, 118.92602006900006 28.862067559000025, 118.92574688600007 28.862041001000023, 118.92458414500004 28.862031715000057, 118.92043714200008 28.861807802000044, 118.91125245700005 28.861311887000056, 118.90926393100005 28.861120844000027, 118.90385921600011 28.860601598000073, 118.90307622300008 28.860526374000074, 118.89898955300009 28.86170493700007, 118.89615602900005 28.862088038000024, 118.89475972200012 28.862219689000028, 118.89096790300005 28.862577200000032, 118.89060119600003 28.862611775000062, 118.88723431500011 28.862406135000072, 118.88686066500009 28.862383313000066, 118.88579466500005 28.862091520000035, 118.88240970300001 28.861109657000043, 118.87851828800001 28.859980889000042, 118.87233152900001 28.85840365200005, 118.86787435800011 28.857033839000053, 118.86697357900005 28.856686473000025, 118.86645284200006 28.856486506000067, 118.86559327800001 28.85615642700003, 118.86350626600006 28.855343173000051, 118.86209465700006 28.85479852800006, 118.86101820600004 28.854509042000075, 118.85995537100007 28.854174478000061, 118.85829961100001 28.854053686000043, 118.85495069500007 28.854093052000053, 118.8536178170001 28.854108084000075, 118.85179551100009 28.854094255000064, 118.84992947000001 28.853606270000057, 118.84770273600009 28.852711391000071, 118.84654713300006 28.852271801000029, 118.84423855400007 28.851536003000035, 118.84261934900007 28.851351360000024, 118.84206464300007 28.851288105000037, 118.83981456100003 28.85151223500003, 118.8385663470001 28.851825732000066, 118.83783710500006 28.852028453000059, 118.83743051500005 28.852141481000046, 118.83623250100004 28.852474516000029, 118.83409423000001 28.852991247000034, 118.83336401600002 28.853070862000038, 118.83236514400005 28.85317201600003, 118.83165097600011 28.853172976000053, 118.83129895400009 28.853173449000053, 118.82998547800003 28.853042405000053, 118.82924157800005 28.852954405000048, 118.8284101480001 28.852839771000049, 118.82783572100004 28.852737406000074, 118.82777416600004 28.852726437000058, 118.82701354900007 28.852590892000023, 118.8262279700001 28.852530349000062, 118.8259491230001 28.852541517000077, 118.82574680100004 28.852549620000048, 118.82588779300011 28.853898445000027, 118.81936802100006 28.853287823000073, 118.81753764600001 28.853430360000061, 118.81344750500011 28.86051481100003, 118.81644270800007 28.862711005000051, 118.81890619800004 28.864602149000063, 118.82006041000011 28.865578739000057, 118.82093782300001 28.866681554000024, 118.82253712800002 28.869461648000026, 118.82261744200002 28.869601259000035, 118.82350560200007 28.871282334000057, 118.82459768000001 28.873349378000057, 118.82579559100009 28.875616738000076, 118.82599713200011 28.87604880400005, 118.82613783000011 28.876350436000052, 118.82629922300009 28.87656148800005, 118.82683019000001 28.877255829000035, 118.82851156000004 28.879454544000055, 118.82972154000004 28.881192706000036, 118.83169354000006 28.883675702000062, 118.83264901900009 28.884642891000055, 118.83119228300006 28.885017819000041, 118.8166223720001 28.893678435000027, 118.82251836100011 28.902381993000063, 118.82854444300006 28.90966247800003, 118.82739446300002 28.91034221600006, 118.82990380600006 28.91323039100007, 118.8321361620001 28.914982552000026, 118.83345721900002 28.917217245000074, 118.83266005000007 28.917646905000026, 118.8320318860001 28.920155979000072, 118.83188540300011 28.920741075000024, 118.83093816000007 28.920898174000058, 118.83087682000007 28.91909898800003, 118.83086916600007 28.918874490000064, 118.83059332800008 28.918889156000034, 118.82993550100002 28.918924134000065, 118.82958057300004 28.918943005000074, 118.82813032900003 28.920565812000063, 118.82639441200001 28.920580347000055, 118.82630481000001 28.920581098000071, 118.82281955200006 28.921281534000059, 118.82285804600008 28.920814892000067, 118.82290509900008 28.920244496000066, 118.82170054800008 28.920076585000061, 118.82145853300005 28.920042849000026, 118.82125234600005 28.919908216000067, 118.82044613400001 28.919381788000067, 118.82009585800006 28.91915307000005, 118.81996958500008 28.918669874000045, 118.81972562400006 28.917736331000071, 118.81916944500006 28.917087894000076, 118.81830767000008 28.916083168000057, 118.81808792600009 28.915826974000026, 118.8170599450001 28.914647090000074, 118.81691407400001 28.914479664000055, 118.81695973600006 28.914380658000027, 118.81728844800011 28.913667932000067, 118.81706085700011 28.91366374100005, 118.81579821100001 28.913640491000024, 118.81484314600004 28.912962637000078, 118.81442012900004 28.912662401000034, 118.81485012600001 28.910840399000051, 118.81502247800006 28.910110099000065, 118.81455900300011 28.910439665000069, 118.81327915800011 28.911349732000076, 118.81234929000004 28.910420526000053, 118.81190631600009 28.909977868000055, 118.81146856800001 28.909540433000075, 118.81124579300001 28.909056810000038, 118.81030968500011 28.907024607000039, 118.8101217090001 28.906616528000029, 118.80993528300007 28.906380313000057, 118.80954807000001 28.905889690000038, 118.80921958300007 28.905473475000065, 118.80689706400005 28.905157324000072, 118.80431509000005 28.905706990000056, 118.80401897500008 28.905651116000058, 118.80364886500001 28.905581280000035, 118.80318132900004 28.905493061000072, 118.80254356600005 28.905372722000038, 118.80210649600008 28.905290252000043, 118.80075168000008 28.904106100000035, 118.79950459400004 28.903779029000077, 118.79995787900009 28.903554778000057, 118.80020733100002 28.903431368000042, 118.80070076000004 28.90318725700007, 118.80090021800004 28.903088581000077, 118.80065875000003 28.902311883000039, 118.80027135600005 28.901065810000034, 118.80038270700004 28.900653123000041, 118.80104439400009 28.898200779000035, 118.80110844300009 28.897963399000048, 118.80132231200002 28.896661651000045, 118.80135820600003 28.896443172000033, 118.80096404000005 28.895619446000069, 118.80002305500011 28.896236134000048, 118.79956857100001 28.896533987000055, 118.79824577600004 28.894922851000047, 118.7974566470001 28.895694730000059, 118.79705681900009 28.896085819000064, 118.7951918760001 28.895969798000067, 118.79377474800003 28.89524947600006, 118.79110625500005 28.893699967000032, 118.78969947600001 28.89148216600006, 118.78950576300008 28.891176775000076, 118.78821058400001 28.890543801000035, 118.7869606380001 28.890779143000032, 118.78541215500002 28.891070695000053, 118.78548205200002 28.890914681000027, 118.78599548900002 28.889768667000055, 118.78435154800002 28.888748357000054, 118.78240916900006 28.888967842000056, 118.7810190990001 28.888319113000023, 118.78007037600003 28.88787635500006, 118.77915773200004 28.887772605000066, 118.7786661880001 28.887716727000054, 118.77803689400002 28.885607262000065, 118.77795188300001 28.884376063000047, 118.77786344100002 28.883095168000068, 118.77755623400003 28.88209316700005, 118.77644966700007 28.88233064700006, 118.77623240700007 28.882377273000031, 118.77546627000004 28.882541694000054, 118.77544798600002 28.882570616000066, 118.77519838700005 28.882965416000047, 118.77492417000008 28.883399155000063, 118.77467015100001 28.883800948000044, 118.77415812400011 28.88338746900007, 118.77388250200011 28.883164896000039, 118.77354938200006 28.882895890000043, 118.7733403630001 28.882727101000057, 118.77316995700005 28.881778703000066, 118.77310586400006 28.88142199300006, 118.77270930900011 28.881503274000067, 118.77166313100008 28.881717708000053, 118.77147790600009 28.881755673000043, 118.76969115000009 28.881312254000079, 118.76925979400005 28.880761825000036, 118.7684855330001 28.879773837000073, 118.76809913700004 28.878707357000053, 118.76911207800003 28.87650906600004, 118.77002729300011 28.875752618000035, 118.77097760400011 28.874967164000054, 118.7715476300001 28.874348072000032, 118.77205456000002 28.873797505000027, 118.77226521300008 28.873568720000037, 118.77280726300012 28.872980010000049, 118.77337307500011 28.871957888000054, 118.77347972500002 28.871765229000061, 118.77326730300001 28.87065074800006, 118.77314116800005 28.870605885000032, 118.77175701900001 28.87011357800003, 118.77190920600003 28.869541644000037, 118.77195874900008 28.869355451000047, 118.77216166900007 28.868592855000031, 118.77229036600011 28.868109196000034, 118.7720058860001 28.867517267000039, 118.77134928000009 28.867315653000048, 118.76925656200001 28.866673071000037, 118.76680608800007 28.865432062000025, 118.7670747200001 28.862112935000027, 118.7649268130001 28.859542958000077, 118.75795704600012 28.854875382000046, 118.75447536400009 28.852731891000076, 118.75230212200006 28.85166166700003, 118.75023882500011 28.849577735000025, 118.75029576200006 28.847833116000061, 118.7506038460001 28.844176520000076, 118.7495028510001 28.841786166000077, 118.74706264500003 28.840034715000058, 118.74367392600004 28.838671189000024, 118.74298089700005 28.837454399000023, 118.74254381100002 28.83618464500006, 118.73969123600011 28.835161175000053, 118.73912473700011 28.834957921000068, 118.73905419100004 28.834932610000067, 118.73704199500003 28.834891261000053, 118.73620808800001 28.834874125000056, 118.73343726400003 28.835387667000077, 118.73271460800004 28.835230876000026, 118.73345505400005 28.833784199000036, 118.73365884400005 28.833386035000046, 118.73409997400006 28.832524160000048, 118.73492333800004 28.830915478000065, 118.73545933200012 28.829868257000044, 118.74066645800008 28.825497389000077, 118.74110686100005 28.824623404000079, 118.74262747200009 28.821605734000059, 118.7427631380001 28.821362653000051, 118.74383480600011 28.819442496000079, 118.74567120600011 28.816152131000024, 118.74267591900002 28.815223538000055, 118.74089020000008 28.814669933000062, 118.73956859000009 28.814260210000043, 118.73922608900011 28.814154028000075, 118.73781520200009 28.813716628000066, 118.74249217200008 28.806898516000047, 118.74457509800004 28.805294720000063, 118.74685331600006 28.803540553000062, 118.7477633960001 28.802839816000073, 118.74802605800005 28.800754317000042, 118.74845483700005 28.797349862000033, 118.75294126900008 28.796182972000054, 118.75432856800001 28.793419517000075, 118.75526021900009 28.791563696000026, 118.7594367590001 28.789837096000042, 118.7613045600001 28.78906493900007, 118.76139839600012 28.789000183000041, 118.76304658000004 28.787862770000061, 118.76539375400012 28.786242986000047, 118.76551342000005 28.786160404000043, 118.76576015900002 28.785990130000073, 118.76621971400004 28.785672991000069, 118.76246098000001 28.784306621000042, 118.76016294100009 28.783471242000076, 118.75889239900005 28.783009376000052, 118.76163575500004 28.780310503000067, 118.76241937300006 28.779539591000059, 118.76272226600008 28.779156027000056, 118.76495829200007 28.776324466000062, 118.76602232900007 28.774977038000031, 118.76681086300005 28.773978489000058, 118.76722211000003 28.772499298000071, 118.76732126100001 28.77214267200003, 118.76733675200001 28.772086949000027, 118.76752904800003 28.771395293000069, 118.76755194200007 28.771312948000059, 118.76898280400007 28.766166368000029, 118.77008095000008 28.765910809000047, 118.7740533220001 28.764986363000048, 118.77426579500002 28.764936917000057, 118.77536656900008 28.764279981000072, 118.78013992300009 28.76143126900007, 118.78104896400009 28.760888758000078, 118.78139726400002 28.760680895000064, 118.78200894000008 28.758181536000052, 118.7830032820001 28.75411857000006, 118.78309400600006 28.753747864000047, 118.78249543300001 28.747576069000047, 118.78401534600005 28.742385583000043, 118.78415634100008 28.741904085000044, 118.78306772900009 28.737636592000058, 118.78121565800006 28.730376240000055, 118.78112278300011 28.730012159000069, 118.78108060200009 28.729846805000079, 118.78023855800006 28.722959914000057, 118.78018181500011 28.72249583200005, 118.78047164200007 28.721916213000043, 118.78086404800001 28.721131448000051, 118.78236181700004 28.718136091000076, 118.7837359880001 28.71538791200004, 118.78390694500001 28.715046019000056, 118.78396130600004 28.71497990000006, 118.78454198200006 28.714273627000068, 118.78907207800012 28.708763695000073, 118.7904057500001 28.70622247700004, 118.78984410900011 28.703942945000051, 118.78958786300007 28.702902922000078, 118.78948524700002 28.702486431000068, 118.78873575000011 28.699444447000076, 118.78861069300001 28.698936880000076, 118.78738726500001 28.697369981000065, 118.78289433400005 28.691615683000066, 118.78289527700008 28.690963915000054, 118.78289848700001 28.688744759000031, 118.78291212600004 28.679318743000067, 118.78506166500006 28.672379729000056, 118.78555103000008 28.670799988000056, 118.78571412000008 28.670443995000028, 118.78614781400006 28.669497328000034, 118.78706936600008 28.667485766000027, 118.7877361940001 28.666030215000035, 118.78927934100011 28.662661838000076, 118.79047024200008 28.663442115000066, 118.79144091400008 28.664078098000061, 118.7946630130001 28.666189214000042, 118.79622128500012 28.665845084000068, 118.79669282200007 28.665740949000053, 118.79865052700006 28.665308607000043, 118.79885834200002 28.665262713000061, 118.79941327100005 28.665140162000057, 118.79939653400004 28.664835548000042, 118.79926519200001 28.662445175000073, 118.79915801900006 28.660494670000048, 118.79891730100007 28.656113688000062, 118.80649570000003 28.652110159000074, 118.80657494000002 28.652068298000074, 118.80760818400006 28.65152245400003, 118.80843508200007 28.651085619000071, 118.80880291700009 28.650912117000075, 118.81026064700006 28.650224528000024, 118.81198766900002 28.64940991900005, 118.81204277900008 28.648986604000072, 118.81371883100007 28.636112292000064, 118.81067766100011 28.63051865500006, 118.80999023800007 28.629254275000051, 118.80959751100011 28.628885418000038, 118.80915252400007 28.628467478000061, 118.80625711000005 28.625748046000069, 118.80547832700006 28.625016597000069, 118.80459314900008 28.624185220000072, 118.80069614100012 28.620525071000031, 118.8051575930001 28.619072628000026, 118.80356650100009 28.61419085600005, 118.80346058800001 28.613865897000039, 118.80305594700008 28.612624380000057, 118.8029197620001 28.612206538000066, 118.80672080000011 28.614579645000049, 118.8074273420001 28.615020761000039, 118.81004208400009 28.612632740000038, 118.80492330600009 28.609129451000058, 118.80358102300011 28.608210794000058, 118.80422936000002 28.602461670000025, 118.8043199120001 28.601658699000041, 118.80271318900009 28.599294814000075, 118.80137027900003 28.597319063000043, 118.79996775800009 28.595255609000048, 118.79867824700011 28.593358422000051, 118.79824116900011 28.592715373000033, 118.79792908700006 28.592222923000065, 118.79762879200007 28.591749072000027, 118.79469734600002 28.587123398000074, 118.79080683400002 28.585208765000061, 118.79069274700009 28.585152620000031, 118.79013738700007 28.584879311000066, 118.79010723900001 28.584748778000062, 118.78843813900005 28.57752219300005, 118.78831495000009 28.57698883200004, 118.78819273700003 28.576459693000061, 118.79335306300004 28.570437342000048, 118.79344226000001 28.570333245000029, 118.79148856500001 28.569258909000041, 118.78533162800011 28.565873213000032, 118.78513615100007 28.565765720000059, 118.79162620300008 28.564951188000066, 118.79148687700001 28.56467604900007, 118.78955945200005 28.56086977800004, 118.79500374000008 28.561988771000074, 118.79174559000012 28.558693892000065, 118.79142189700008 28.558366550000073, 118.79116282300004 28.558104557000036, 118.78955565100011 28.556479266000053, 118.79107334000003 28.553524688000039, 118.79148149900004 28.549740791000033, 118.79170401300007 28.547677941000074, 118.79210699700002 28.543942017000063, 118.79212204100008 28.543802552000045, 118.80055336000009 28.536001666000061, 118.80109735700012 28.536440661000029, 118.80440426500002 28.539109272000076, 118.80748055300012 28.543228191000026, 118.80977641900006 28.546302184000069, 118.81403672100009 28.547878098000069, 118.81449908900004 28.548049131000028, 118.81761795200009 28.551183751000053, 118.82591669100009 28.548681514000066, 118.8269889070001 28.547904927000047, 118.82761187500012 28.547453722000057, 118.83088123500011 28.545085782000058, 118.83408873700012 28.542762645000039, 118.83523922100005 28.543026916000031, 118.83723913200004 28.543486306000034, 118.83879392200004 28.543843449000065, 118.84150479800007 28.544466149000073, 118.84393547000002 28.545024486000045, 118.84614395400001 28.543702228000029, 118.84752148300004 28.542877476000058, 118.84741469900007 28.541685337000047, 118.84734369400007 28.540892639000049, 118.84725014100002 28.539848213000027, 118.8472237520001 28.539553601000023, 118.84770881000009 28.538406615000042, 118.84979606000002 28.533471027000076, 118.85125414000004 28.530023198000038, 118.85210421700003 28.532508630000052, 118.85306597900001 28.532582497000078, 118.85445933700009 28.532689512000047, 118.85537835400009 28.532760096000061, 118.85645902500005 28.532843095000032, 118.85716823100006 28.532897565000042, 118.86153154800002 28.530475769000077, 118.8614064730001 28.527612114000078, 118.86136046200011 28.526558670000043, 118.86121775100003 28.523291223000058, 118.86120369000002 28.522969286000034, 118.86490908700011 28.516590929000074, 118.86716694100005 28.518680062000044, 118.87016785800006 28.521456730000068, 118.87241818700011 28.523538900000062, 118.87346909700011 28.524511279000023, 118.8763693520001 28.53161235500005, 118.87691328100004 28.532944128000054, 118.87920026100005 28.534084042000075, 118.88069566800004 28.534829407000075, 118.88093155100012 28.53494697900004, 118.88477815700003 28.536864267000055, 118.88549257500006 28.54252752900004, 118.88576650700008 28.542711847000078, 118.88761078000005 28.543952789000059, 118.8904847230001 28.545075631000032, 118.89167432900001 28.545540407000033, 118.89258527600009 28.545896313000071, 118.89540366500012 28.546997450000049, 118.89695243000006 28.549661554000068, 118.89873246000002 28.552723469000057, 118.89946599900009 28.553985263000072, 118.90026368300005 28.556647149000071, 118.9013005490001 28.560107188000075, 118.90633707300003 28.56344408800004, 118.90907692400003 28.567778181000051, 118.90919084800009 28.569254948000037, 118.90946865100011 28.572856036000076, 118.90268806200004 28.577230209000049, 118.90215972700003 28.577571039000077, 118.90371366900001 28.578896629000042, 118.90512927500004 28.580104212000037, 118.90524071000004 28.582714840000051, 118.90538755000011 28.586154873000055, 118.90543570400007 28.587283003000039, 118.90545410700008 28.587714117000075, 118.90545862400006 28.587819944000046, 118.90555656000004 28.59011429800006, 118.90556885000001 28.590402223000069, 118.90579309200007 28.595655600000043, 118.90590037700008 28.598168993000058, 118.90602062700009 28.600986103000025, 118.90666772500003 28.60108027800004, 118.9074167330001 28.601189284000043, 118.90829630100006 28.601317292000033, 118.90958700100009 28.601505133000046, 118.90998125300007 28.601562511000054, 118.91136527300011 28.601763933000029, 118.9128933070001 28.60847334400006, 118.91127215500001 28.614992559000029, 118.91122006700004 28.615202025000031, 118.91434145800008 28.618809411000029, 118.9160512950001 28.620785468000065, 118.92182717200001 28.631110990000025, 118.92066917800003 28.633086792000029, 118.91990579900005 28.634389290000058, 118.92067574200007 28.635737200000051, 118.92317364300004 28.640110177000054, 118.92382922900003 28.640753630000063, 118.92521453500001 28.642113297000037, 118.9281005250001 28.644945872000051, 118.92858089100002 28.645180669000069, 118.93393655300008 28.647798458000068, 118.93597619600007 28.648795412000027, 118.9390806350001 28.648461849000057, 118.94269267800007 28.648073745000033, 118.94513516000006 28.648915877000036, 118.94525919600005 28.648958643000071, 118.94563026200001 28.649086581000063, 118.9461420880001 28.649263051000048, 118.95107146200007 28.650962628000059, 118.95708088200001 28.645736545000034, 118.95767089800006 28.645223439000063, 118.95815737000009 28.645824176000076, 118.96130219000008 28.649707664000061, 118.96336657400002 28.652256940000029, 118.96497741100006 28.654246138000076, 118.96704595200003 28.656800546000056, 118.96743810900011 28.657195405000039, 118.97303746900002 28.662833339000031, 118.97417260000009 28.663976290000051, 118.97450549700011 28.664311480000038, 118.97910542400007 28.66654236200003, 118.98079145800011 28.669454654000049, 118.98199019200001 28.671525233000068, 118.98460554500002 28.67604274200005, 118.98486008100008 28.676482404000069, 118.98685873800002 28.679934691000028, 118.98722859100008 28.680573539000079, 118.98864673600008 28.681514261000075, 118.98926199500011 28.681922391000057, 118.99276331200008 28.684244977000048, 118.9976568080001 28.689421075000041, 118.99858741000003 28.690405420000047, 118.99969829200006 28.691389425000068, 119.00310765500001 28.694409391000079, 119.00472304000004 28.695840276000069, 119.00481317100002 28.695931588000064, 119.01019339300001 28.701382344000024, 119.01231483700008 28.703531600000076, 119.01264168500006 28.703856214000041, 119.01435678600001 28.705559593000032, 119.01978935200009 28.710955028000058, 119.01986346500007 28.711028634000058, 119.02042485800007 28.711092925000059, 119.02239310100003 28.711318327000072, 119.02841466700011 28.712007914000026, 119.02973744600001 28.71215939800004, 119.0408204470001 28.719036414000072, 119.04129572200009 28.72110986000007, 119.04141909400005 28.721648087000062, 119.04193715200006 28.723908179000034, 119.0422076000001 28.725088041000049, 119.04816210000001 28.730558102000032, 119.0490451280001 28.731369289000042, 119.0567061480001 28.734456915000067, 119.05800850500009 28.743408977000058, 119.05895236600009 28.747575694000034, 119.05925712400006 28.748921059000054, 119.05956278600001 28.750270418000071, 119.06184297800007 28.751874673000032, 119.06685319300004 28.75766857900004, 119.0686413410001 28.759413822000056, 119.07276277300002 28.763436364000029, 119.07303001600008 28.765718623000055, 119.07320133200005 28.767181654000069, 119.07394692800005 28.77354904200007, 119.07363972400003 28.774065242000063, 119.07036966700002 28.779559966000079, 119.07020463600008 28.779837271000076, 119.0695289790001 28.780972587000065, 119.06892372300001 28.781989606000025, 119.06699398900003 28.783105226000032, 119.06638080800008 28.783459719000064, 119.06207861600001 28.785946907000039, 119.06199081900002 28.785997665000025, 119.06210159200009 28.786204877000046, 119.06318685000008 28.788234945000056, 119.06275819300004 28.792202349000036, 119.06270740000002 28.792672457000037, 119.06245426900011 28.795015291000027, 119.06214203700006 28.797905133000029, 119.06137370700003 28.80501634500007, 119.06133727300005 28.805353555000067, 119.06129243700002 28.805768528000044, 119.06167126900004 28.80604074300004, 119.06272325900011 28.806796665000036, 119.06361135400005 28.807434818000047, 119.06560667100007 28.80886858100007, 119.06725654700006 28.810054122000054, 119.06750210400003 28.810117012000035, 119.06813834100001 28.81027995900007, 119.06864962600002 28.810410906000072, 119.0694016870001 28.81060351800005, 119.06967332300007 28.810673087000055, 119.07523776700009 28.812098207000076, 119.08446506600001 28.820948945000055, 119.09030857300002 28.823566996000068, 119.09501293200003 28.825674677000052, 119.09419487200012 28.833776062000027, 119.09423652700002 28.837415479000072, 119.09516329700011 28.838238875000059, 119.09615122300011 28.839116606000061, 119.09781953100003 28.840598827000065, 119.09866076200001 28.841346226000041, 119.09952954400001 28.844331985000053, 119.10037776400009 28.847247079000056, 119.10099406600011 28.848981599000069, 119.10335939900006 28.855638587000044, 119.10339294200003 28.855732991000025, 119.10152343200002 28.857091097000023, 119.09949477900011 28.858564813000044, 119.09955783800001 28.859946293000064, 119.10000471300009 28.869736341000078, 119.10004049300005 28.870520189000047, 119.10141281600011 28.871555091000062, 119.1020231440001 28.872015354000041, 119.10817849000011 28.876657249000061, 119.10850327800006 28.876902180000059, 119.1100251580001 28.878049866000026, 119.10912487900009 28.883803620000037, 119.10905244200001 28.884266566000065, 119.10870136000005 28.88580323900004, 119.10802828600004 28.888749262000033, 119.10756114700007 28.890793914000028, 119.10751861800009 28.890980063000029, 119.10794919200009 28.892793983000047, 119.10865780200004 28.895779209000068, 119.10888813500003 28.896749551000028, 119.10903886000006 28.897384523000028, 119.1091377680001 28.897801206000054, 119.11025970000003 28.902527668000062, 119.10800558800008 28.903578865000043, 119.1056658120001 28.904670012000054, 119.10456817000011 28.905181894000066, 119.10207054000011 28.90634665500005, 119.10208223900008 28.906452358000024, 119.10236796000004 28.909033936000071, 119.10257545600007 28.910908727000049, 119.10439281800006 28.918181571000048, 119.10442684600002 28.918317744000035, 119.10934863700004 28.923209524000072, 119.10879899800011 28.930914045000065, 119.1074595660001 28.939168814000027, 119.10738797300007 28.939242382000032, 119.10496825200005 28.941728861000058, 119.10318714300001 28.943559110000024, 119.10296610900002 28.943719791000035, 119.09980268100003 28.946019455000055, 119.09837208800002 28.947059429000035, 119.09547818100009 28.949163164000026, 119.09519368700001 28.949113591000071, 119.09293382200008 28.948719812000036, 119.09252027600007 28.948647752000056, 119.09245434200011 28.948636263000026, 119.09211456500009 28.94857705700008, 119.09009050300006 28.948224366000034, 119.08998547100009 28.948299727000062, 119.08922874100006 28.94884268800007, 119.08875297300006 28.949184058000071, 119.08799119000003 28.949730645000045, 119.08512738800005 28.951785452000024, 119.08495197200011 28.951951794000024, 119.08447846600006 28.95240080700006, 119.08192663900002 28.954820635000033, 119.08073739300005 28.95594836500004, 119.08049772400011 28.956827032000035, 119.07838016500011 28.96459038100005, 119.07584966700006 28.963593514000024, 119.07529341400004 28.96337438300003, 119.0726427940001 28.964215367000065, 119.06971843100007 28.965143204000071, 119.06815436400007 28.965639449000037, 119.06725314500011 28.965925386000038, 119.06377648600005 28.969463655000027, 119.06259032100002 28.972112711000079, 119.06218654100007 28.973014469000077, 119.06173206700009 28.974029443000063, 119.0606898530001 28.976357012000051, 119.05988357300009 28.978157673000055, 119.05984515700004 28.978475293000031, 119.05972472500002 28.979471012000033, 119.0596146470001 28.980381127000044, 119.05946932800009 28.981582618000061, 119.05945112400002 28.981733125000062, 119.05936550000001 28.982441053000059, 119.05930549100003 28.982937201000027, 119.06584119400009 28.978789368000037, 119.0702291770001 28.981844270000067, 119.0685570710001 28.984936279000067, 119.06742324600009 28.987032915000043, 119.07025593300011 28.988399242000071, 119.07047195400003 28.988503438000066, 119.07309878000001 28.991362990000027, 119.07350892700003 28.991809474000036, 119.07485896100002 28.993279115000064, 119.07497359700005 28.993403908000062, 119.07510284900002 28.993392269000026, 119.0763154120001 28.993283081000072, 119.07742085400002 28.993183538000039, 119.07900220600004 28.993041141000049, 119.08389587400006 28.992600477000053, 119.08861389500009 28.986580195000045, 119.08884115100011 28.986290212000029, 119.09082646200011 28.992467772000055, 119.09048472800009 28.992967996000061, 119.08846550100009 28.995923702000027, 119.08835980800006 28.996078412000031, 119.08765293900001 28.997113113000069, 119.08724202100007 28.997714608000024, 119.08779475300003 28.999172965000071, 119.08793971700004 28.999555446000045, 119.08798912100008 28.999685796000051, 119.08835164100003 29.000642288000051, 119.08842667200008 29.000840252000046, 119.09096096900009 29.007526875000053, 119.0866516750001 29.010893238000051, 119.08533631500006 29.011920780000025, 119.0849049520001 29.011912211000038, 119.08278406900001 29.011870080000051, 119.08269643300002 29.011868339000046, 119.0817597460001 29.01184973200003, 119.0768485430001 29.011752170000079, 119.07638841700009 29.011743030000048, 119.07587969000008 29.012225417000025, 119.0689276600001 29.018817497000043, 119.06733988800011 29.020323060000067, 119.06767779600011 29.025183157000072, 119.06707965900011 29.026340878000042, 119.0667466750001 29.026985382000078, 119.0662823990001 29.027884010000037, 119.06613340600006 29.028172392000045, 119.06597283800011 29.028483180000023, 119.06251959200006 29.035167093000041, 119.05711459200006 29.036655005000057, 119.05715955300002 29.03918728900004, 119.05718148500011 29.04042253700004, 119.05722199500008 29.042704137000044, 119.05367806200002 29.046270455000069, 119.0530687160001 29.046883650000041, 119.05283607700005 29.047117759000059, 119.05245025500005 29.046595093000064, 119.04839490300003 29.041101386000037, 119.04779975500003 29.040295149000031, 119.04621600600001 29.039046335000023, 119.04394920100003 29.037258919000067, 119.04213175600012 29.035825831000068, 119.04186942600006 29.03727608500003, 119.04100903400001 29.042032649000078, 119.04083776400012 29.042979489000061, 119.04078428200012 29.04327515600005, 119.0402868330001 29.04322974400003, 119.03849304100004 29.043065990000059, 119.03492330300003 29.042740111000057, 119.0347100030001 29.042720639000038, 119.03462530800005 29.042836195000064, 119.03012344000001 29.048978498000054, 119.03014570000005 29.049755064000067, 119.03019193900002 29.051368083000057, 119.03032744000006 29.056095025000047, 119.03070989000003 29.055747878000034, 119.03735731500001 29.049714068000071, 119.03547624600003 29.054702848000034, 119.03476505300011 29.056589005000035, 119.04029252900011 29.058031836000055, 119.04095470800007 29.058057557000041, 119.04859381500012 29.058354290000068, 119.04873342100007 29.058359713000073, 119.0495147580001 29.058390063000047, 119.04961039600005 29.058853891000069, 119.05027417000008 29.062073037000062, 119.05031153500011 29.062254246000066, 119.04726732200004 29.063562391000062, 119.04657587400004 29.063859517000026, 119.04280355700007 29.065480540000067, 119.04004591700004 29.06907020500006, 119.04668490500001 29.069387083000038, 119.04589322200002 29.074548465000078, 119.04580442000008 29.07512741100004, 119.04820591700002 29.076410622000026, 119.04996440900004 29.077350250000052, 119.05133738600011 29.069556256000055, 119.0517140180001 29.070062085000075, 119.05586512000002 29.075637157000074, 119.05438811200008 29.078493225000045, 119.05388948000007 29.079457425000044, 119.05369934800001 29.079825079000045, 119.05325463700001 29.080685010000025, 119.05223807000004 29.082650732000047, 119.05337297400001 29.083315748000075, 119.05628624700012 29.085022828000035, 119.05627871600007 29.086444885000049, 119.05627710200008 29.086749530000077, 119.05627501900005 29.087142854000035, 119.05625989800001 29.089998115000071, 119.0562592550001 29.090119682000079, 119.05625856800009 29.090249400000062, 119.05637632800006 29.090253352000047, 119.06120518200009 29.090415381000071, 119.06184377700004 29.090436808000049, 119.0634794230001 29.090491692000057, 119.06225543000005 29.089124168000069, 119.06201843000008 29.088859376000073, 119.06194756100001 29.088780198000052, 119.06078293700011 29.087479005000034, 119.05998616200009 29.086588797000047, 119.05978081600006 29.084641973000032, 119.05933809200008 29.080444635000049, 119.05907185800004 29.077920552000023, 119.06283383000005 29.080759917000023, 119.06501359000004 29.082405100000074, 119.07127604600009 29.086752177000051, 119.07146839900008 29.086885699000049, 119.07168670100009 29.086912634000043, 119.07211340600008 29.08696528400003, 119.07322865500009 29.08710289000004, 119.07656442400003 29.087514476000024, 119.07771171800005 29.087656037000045, 119.08539241900007 29.088603727000077, 119.07990474400003 29.092229743000075, 119.08056697900008 29.092591728000059, 119.08120742000006 29.092941802000041, 119.08461985500003 29.094807080000066, 119.08579778600006 29.095927660000029, 119.08869929700006 29.098687905000077, 119.08907595100004 29.099046221000037, 119.0897108910001 29.099650248000046, 119.09026919300004 29.100181366000072, 119.09080659300002 29.100692602000038, 119.08940028200004 29.103368952000039, 119.08707305900009 29.107797887000061, 119.08661922400006 29.107540085000039, 119.08559114100001 29.106956079000042, 119.0830770340001 29.105527935000055, 119.07932250400006 29.109877909000033, 119.07760146500004 29.112735328000042, 119.07251058600002 29.121187648000046, 119.07244242900003 29.121300809000047, 119.07232850300011 29.121489960000076, 119.07096616400008 29.123751834000075, 119.06812527900001 29.128468517000044, 119.06800725100004 29.128664478000076, 119.06787684800008 29.12918447800007, 119.06775181800003 29.129683058000069, 119.06548620800004 29.138717550000024, 119.06838963000007 29.139804972000036, 119.07047821000003 29.140587209000046, 119.07143074700002 29.14094396400003, 119.07248595400006 29.141339172000073, 119.07376829600003 29.143563171000039, 119.07387193800002 29.143742922000058, 119.07509618300003 29.145866163000051, 119.07514230300001 29.145946150000043, 119.0765654600001 29.148414369000079, 119.07679070400002 29.14880501600004, 119.07686981800009 29.148942225000042, 119.07663563100004 29.149305196000057, 119.07203308100009 29.156438791000028, 119.07185343300011 29.156717230000027, 119.0713748500001 29.157458996000059, 119.07130278800003 29.157570687000032, 119.07077478600002 29.15838904900005, 119.06386832100009 29.157784788000072, 119.06172212400008 29.157597013000043, 119.06011095200006 29.157456048000029, 119.05972841200003 29.15742257900007, 119.05623262900008 29.161997611000061, 119.05505252500006 29.163542046000032, 119.05175274200008 29.166825610000046, 119.05049998600009 29.168072209000059, 119.05004662200008 29.16852334400005, 119.04438081600006 29.174161302000073, 119.04328227700012 29.17525444100005, 119.0437431580001 29.175498013000038, 119.04461180900012 29.175957089000065, 119.04498784200007 29.17615581900003, 119.04891261700004 29.178230032000045, 119.04914188400005 29.17835119700004, 119.05031408000002 29.178970694000043, 119.05100872800006 29.182014959000071, 119.05186981100007 29.185788624000054, 119.04714779800008 29.187343180000028, 119.04708215900007 29.190014954000048, 119.04725399600011 29.190116517000035, 119.05154081400008 29.192650195000056, 119.04841371400005 29.197951906000071, 119.04790108900011 29.198520605000056, 119.04748282700007 29.198984620000033, 119.04289524400008 29.20407401600005, 119.04282118700007 29.204184901000076, 119.0419945220001 29.20542264200003, 119.04111915200008 29.206733306000046, 119.03915664400006 29.209671713000034, 119.03845952500001 29.210715489000052, 119.03787174100012 29.223328729000059, 119.02409497500003 29.222224579000056, 119.02021180300005 29.217104075000066, 119.01975045400002 29.217001593000077, 119.01940461600009 29.216924771000038, 119.00800359100003 29.214392213000053, 119.00724528900002 29.214223768000068, 118.99953051200009 29.212151582000047, 118.99845025000002 29.211861424000062, 118.99767858100006 29.21165415400003, 118.99003676500001 29.218748399000049, 118.98774527300009 29.21984737300005, 118.98672929300005 29.220334625000078, 118.9851855070001 29.221075007000024, 118.98363239300011 29.221819863000064, 118.98279697200007 29.224822746000029, 118.98233279900001 29.226491194000062, 118.98173540700009 29.228638490000037, 118.98105730900011 29.231075884000063, 118.98032035100005 29.234775932000048, 118.97989729300002 29.236899984000047, 118.97986067900001 29.239270900000065, 118.97979828100006 29.24331144100006, 118.98283425300008 29.248352326000031, 118.97659769500001 29.261004078000042, 118.97529530300005 29.261150027000042, 118.97298783000008 29.261408606000032, 118.97229350500004 29.261926630000062, 118.97209573800001 29.26207418100006, 118.9715477960001 29.26248299100007, 118.96889245800003 29.26446409700003, 118.96619826900007 29.266474186000039, 118.9646670950001 29.267017494000072, 118.96287427900006 29.267653639000059, 118.95686015600006 29.269787634000068, 118.95371769100007 29.276113945000077, 118.95219094400011 29.279187547000049, 118.95167609300006 29.280224026000042, 118.95115422300012 29.281274640000049, 118.95050960800006 29.282572358000039, 118.94817539200005 29.283452921000048, 118.94670309800006 29.284008332000042, 118.94590036700004 29.284311155000069, 118.94562420300008 29.284415336000052, 118.9468480920001 29.285535515000049, 118.94708698900001 29.28575416700005, 118.94755180200002 29.286179592000053, 118.94766604000006 29.286284151000075, 118.94947139200008 29.287936521000063, 118.94958658600001 29.288041952000071, 118.95010282500004 29.288514446000079, 118.95042970400004 29.288813625000046, 118.95140902500009 29.289709961000028, 118.95802899600005 29.298612540000079, 118.95524385200008 29.299479354000027, 118.95108133500003 29.300774846000024, 118.94886866600007 29.30146349000006, 118.94850326700009 29.301577212000041, 118.94680917400001 29.302104461000056, 118.93809765800006 29.310255038000037, 118.93699582700003 29.310186625000028, 118.93348528200011 29.309968653000055, 118.92438924100009 29.312116452000055, 118.91949734900004 29.315851727000052, 118.91284567800005 29.320979536000038, 118.91066127700003 29.322663503000058, 118.90897033600004 29.32396705900004, 118.90502697600004 29.327574565000077, 118.89717415500002 29.334758565000072, 118.89324243700003 29.333873691000065, 118.89042708200009 29.33324006600003, 118.88630507400001 29.327480379000065, 118.87929713200003 29.326725036000028, 118.87205420100008 29.329052202000071, 118.86988459600002 29.328024731000028, 118.86393901400004 29.325209049000023, 118.86272764400007 29.32385381000006, 118.85239700900001 29.312296252000067, 118.85133580400009 29.310316611000076, 118.84846488000005 29.304961004000063, 118.84722088500007 29.303998290000038, 118.84382876600012 29.30137316500003, 118.83433469900001 29.297295707000046, 118.82518623400006 29.291547097000034, 118.8236037260001 29.290552699000045, 118.81823198200004 29.281483326000057, 118.81620112900009 29.282431476000056, 118.81619867100005 29.282432625000069, 118.81422563100011 29.283353785000031, 118.81202798600009 29.284379806000061, 118.80414504700002 29.279828681000026, 118.79013587700001 29.271335756000042, 118.78295553200007 29.269739662000063, 118.78003499900001 29.263582416000077, 118.77930613500007 29.262045780000051, 118.77788596200003 29.260854782000024, 118.77602266400004 29.259292165000033, 118.76953698500006 29.253853082000035, 118.76891874300009 29.253794119000077, 118.76530412000011 29.253449383000032, 118.76123077600005 29.253060898000058, 118.75863621100007 29.247876106000035, 118.75742365400004 29.245453017000045, 118.76007368400008 29.239185448000057, 118.76158754900007 29.235605014000043, 118.76168994700004 29.228841173000035, 118.76173949300005 29.225568445000079, 118.7559572350001 29.221315376000064, 118.75340459600011 29.219152355000062, 118.75064289300008 29.216812181000023, 118.75169542700007 29.213403326000048, 118.75203215500005 29.212312759000042, 118.75208284000007 29.205834348000053, 118.75593360300002 29.199679235000076, 118.76021240300008 29.19283994400007, 118.76625574200011 29.192580185000054, 118.77178065700002 29.187892222000073, 118.77831014300011 29.186538678000034, 118.77979720600001 29.186230413000033, 118.7829822110001 29.185570171000052, 118.78369722500008 29.185421950000034, 118.78470616300001 29.185212800000045, 118.79123206700001 29.187549922000073, 118.79322783600003 29.188264666000066, 118.7946232920001 29.187367183000049, 118.79899133000004 29.184557893000033, 118.79905147800002 29.183833746000062, 118.79927303600005 29.18116629900004, 118.79980080900009 29.180357861000061, 118.80048820100001 29.17930491900006, 118.80095450300007 29.178590642000074, 118.80185950400005 29.177204368000048, 118.80267351800001 29.179258463000053, 118.80328623200012 29.180804593000062, 118.80594320400007 29.180912599000067, 118.80819560700002 29.181004159000054, 118.81255872600002 29.182129151000026, 118.81468493900002 29.180878712000037, 118.81633803600005 29.179906514000038, 118.81883624600005 29.180666313000074, 118.82271273900005 29.181845301000067, 118.82326683700001 29.182013823000034, 118.82752474500001 29.181646809000028, 118.82621970300011 29.178306279000026, 118.8258746140001 29.177589789000024, 118.82221304200004 29.16998744600005, 118.8266039770001 29.165095735000079, 118.82483355400007 29.16103933900007, 118.82392605700011 29.158960079000053, 118.8233693410001 29.14664573400006, 118.82336316100009 29.146509018000074, 118.82490076400006 29.143645191000076, 118.8252627170001 29.142971043000045, 118.8256297690001 29.142287400000043, 118.82736776100012 29.142408315000068, 118.83137052900008 29.142686795000031, 118.83836477600005 29.147877767000068, 118.83996679100005 29.149066747000063, 118.83950219000008 29.143991104000065, 118.83940688000007 29.142949883000028, 118.83933604400011 29.142176017000054, 118.83463572500011 29.131857614000069, 118.83937591600011 29.125855681000075, 118.84028893600009 29.124699634000024, 118.84056206900004 29.124353800000051, 118.84119917100008 29.123547114000075, 118.84283000100004 29.121482191000041, 118.84602036500007 29.117679850000059, 118.8472087670001 29.116263489000062, 118.84773734400005 29.110940021000033, 118.84784194700001 29.109886536000033, 118.84807586900001 29.107530644000065, 118.84813082200003 29.106977194000024, 118.84833111800003 29.105858600000033, 118.8484968250001 29.104933177000078, 118.84900046600001 29.102120504000027, 118.84988632900001 29.097173235000071, 118.8516111350001 29.096168237000029, 118.85364860600009 29.094981057000041, 118.85436080000011 29.094566081000039, 118.85459340800003 29.094430546000069, 118.85574761300006 29.09255446800006, 118.85646725800007 29.091384738000045, 118.85749750500008 29.089710144000037, 118.85762491700007 29.089095842000063, 118.85851739200007 29.084792893000042, 118.86245173500004 29.083186457000068, 118.86306518000004 29.081854003000046, 118.86378317500009 29.080294456000047, 118.86478036700009 29.082477691000065, 118.86506996200001 29.083111728000063, 118.86762078900006 29.08097667800007, 118.86881703800009 29.079975415000035, 118.86940440400008 29.079483788000061, 118.87056252500008 29.078514437000024, 118.87202741800002 29.077288317000068, 118.87014214900012 29.079758428000048, 118.86951808000003 29.080576094000037, 118.86942751300001 29.080694756000071, 118.86837364600001 29.08207555000007, 118.86994309600004 29.080927200000076, 118.8722598060001 29.079232088000026, 118.87419554100006 29.078729232000057, 118.87534557000004 29.078430484000023, 118.87585818200012 29.077901583000028, 118.87718078000012 29.076536961000045, 118.87773062000008 29.075969651000037, 118.87723031200005 29.075449331000073, 118.8764964720001 29.074686138000061, 118.87670500400009 29.073614624000072, 118.8769354750001 29.072430374000078, 118.87733220400003 29.072152291000066, 118.87784355100007 29.071793868000043, 118.8794292770001 29.070682371000032, 118.8798893930001 29.070359857000028, 118.87957582400009 29.068186765000064, 118.88270421400011 29.06828517100007, 118.88337598300006 29.068306302000053, 118.88381715700007 29.06789290100005, 118.88538835600002 29.066420615000027, 118.88570157600009 29.06612711300005, 118.88402938200011 29.064470302000075, 118.8834850500001 29.06393097800003, 118.88226598000006 29.062723122000079, 118.88219532100004 29.062653113000067, 118.88538237000012 29.060166694000031, 118.88533294300009 29.059849869000061, 118.88505909700007 29.058094544000028, 118.88338749900004 29.056990880000058, 118.88150140000005 29.055745595000076, 118.88073394600008 29.054119312000068, 118.88051043400003 29.053645676000031, 118.88026052700002 29.053116107000051, 118.88333044400008 29.048538854000071, 118.88343944000007 29.048376340000061, 118.88339810800005 29.048010525000052, 118.88321302500003 29.046372403000078, 118.88309841500006 29.045358020000037, 118.88193002500009 29.044867747000069, 118.88064569500011 29.044328824000047, 118.88050369200005 29.043584550000048, 118.88009989000011 29.04146810900005, 118.87984677300005 29.039794579000045, 118.88030150900011 29.038984609000067, 118.88101920400004 29.037706259000061, 118.88121763200002 29.037352822000059, 118.88135424200004 29.037109495000038, 118.88105882900004 29.036280882000028, 118.88065512900005 29.035148534000029, 118.88049914200008 29.034711001000062, 118.88243494200003 29.034489638000025, 118.88273467200008 29.034455363000063, 118.88362319600003 29.034125692000032, 118.88465969300012 29.033741119000069, 118.88587997700006 29.03255686600005, 118.88643472600006 29.03201849900006, 118.88640745400005 29.031406471000025, 118.88639668000008 29.031164664000073, 118.88637888200003 29.030765245000055, 118.88634296200007 29.029959137000048, 118.88743372100009 29.03124613600005, 118.88827044700008 29.032233398000074, 118.88855155600004 29.032565566000073, 118.88904344700006 29.033146802000033, 118.8920147340001 29.031825117000039, 118.89421918400001 29.031017739000049, 118.89427914100008 29.031020025000032, 118.89511772700007 29.031052011000043, 118.89573748800001 29.031075650000048, 118.89634161000004 29.030122886000072, 118.89794987900007 29.027586480000025, 118.8947333210001 29.026509745000055, 118.89366495400009 29.026901930000065, 118.89321566500007 29.026625187000036, 118.89315655200005 29.02658877500005, 118.89116056100011 29.025359328000036, 118.89051047600003 29.025211456000079, 118.88975634500002 29.025039918000061, 118.88583703800009 29.024148413000034, 118.88365524500011 29.023652132000052, 118.88276956100003 29.023450670000045, 118.87769735100005 29.020793156000025, 118.87759617100005 29.018499053000028, 118.87758669100003 29.018284106000067, 118.87498119300005 29.015798913000026, 118.87427848300001 29.015359699000044, 118.87335715600011 29.014783843000032, 118.87415307300012 29.012240167000073, 118.87347438900008 29.010046213000066, 118.87332030700009 29.009548120000034, 118.8740727280001 29.009585772000037, 118.87573779600007 29.00966909300007, 118.87679194900011 29.007484838000039, 118.87532992800004 29.005042240000023, 118.87500688900002 29.004913381000051, 118.87440410500005 29.004672931000073, 118.87166068600004 29.003578590000075, 118.8710298310001 29.002335238000057, 118.87089367200008 29.002066882000065, 118.87360671200008 29.001606577000075, 118.8756989420001 29.000518272000079, 118.87588590700011 28.998339814000076, 118.87612512800001 28.996816239000054, 118.87943270300002 28.995287181000037, 118.88195313600011 28.991941906000079, 118.88136568400012 28.990003714000068, 118.8789655170001 28.989032773000076, 118.87935205100007 28.98566293600004, 118.88051501400003 28.98198489400005, 118.8786778110001 28.980975466000075, 118.87867746800009 28.980975278000074, 118.87914064000006 28.980151344000035, 118.87960308000004 28.979397173000052, 118.87980701900005 28.979097370000034, 118.88000986700001 28.978836987000079, 118.88001470800009 28.978830769000069, 118.88001570300003 28.978829175000044, 118.88001649400007 28.978828586000077, 118.88235741300002 28.977085017000036, 118.88304664900011 28.976611489000049, 118.88365198200006 28.976349447000075, 118.8842531680001 28.976111318000051, 118.88492745200006 28.975943909000023, 118.88572615500004 28.975774041000079, 118.88639591300011 28.975666467000053, 118.88700682000001 28.975609745000042, 118.88740464000011 28.975682473000063, 118.8909297240001 28.976326915000072, 118.89487641100004 28.978432587000043, 118.89845325900001 28.98200730800005, 118.90013445700004 28.984122141000057, 118.90116750000004 28.985421639000037, 118.90451241300002 28.987402035000059, 118.90655025500007 28.988138216000038, 118.9070124110001 28.988305172000025, 118.90989769400005 28.989347495000061, 118.91381027900002 28.989183211000068, 118.91608882300011 28.988038859000028, 118.91895310300004 28.986600331000034, 118.9214901360001 28.985062003000053, 118.92026096100005 28.982302759000049, 118.92016190000004 28.981056694000074, 118.91987610700005 28.977461769000058, 118.91786738000008 28.974571654000044, 118.91663486200002 28.973419605000061, 118.91657723600008 28.973365743000045, 118.91593541600002 28.972765826000057, 118.9153970640001 28.972518137000066, 118.91347308400009 28.971632936000049, 118.91275805700002 28.970082557000069, 118.90802770100004 28.966647831000046, 118.90784186400003 28.966512894000061, 118.90744603400003 28.966225480000048, 118.89890360300001 28.960868203000075, 118.89872311500005 28.96075501200005, 118.89553300200009 28.958754374000023, 118.89449738700011 28.95810490100007, 118.88954297800001 28.954997806000051, 118.8886300690001 28.95442528600006, 118.88817113400012 28.954137471000024, 118.88816914800009 28.95413663100004, 118.8963119340001 28.952802070000075, 118.89649267200002 28.952773917000059, 118.90204695600005 28.95190875000003, 118.91423126100005 28.950348470000051, 118.91662096800007 28.950042453000037, 118.9186565760001 28.950149152000051, 118.92142564700009 28.951580428000057, 118.93546784700004 28.961585970000044, 118.93681254100011 28.962544109000078, 118.94313604200011 28.96721831900004, 118.95054975000005 28.971152914000072, 118.9767390400001 28.977687425000056, 118.97648811200008 28.978463572000067, 118.97405571800005 28.985987238000064, 118.97687579000001 28.987052076000055, 118.97841923200008 28.987819628000068, 118.98098833400002 28.990968593000048, 118.98673299400002 28.992861515000072, 118.98714257600011 28.994902188000026, 118.99088931900008 28.994648210000037, 118.99263996800005 28.994073700000058, 118.99565164800003 28.992244729000049, 119.00155137900003 28.987691514000062, 119.01083607800001 28.987109169000064, 119.01914187200009 28.985560471000042, 119.02075232200002 28.984892539000043, 119.02739295900005 28.981701410000028, 119.02849820800009 28.979836869000053, 119.03019340700007 28.97877139600007, 119.03125893600009 28.976356517000056, 119.03348848500002 28.971031961000051, 119.03457355400008 28.968483367000033, 119.03531324300002 28.966745997000032, 119.03917935600009 28.957734113000072, 119.04201556500004 28.951196972000048, 119.04305500000009 28.94863618200003, 119.04343898500008 28.948008730000026, 119.04359113600003 28.947302991000072, 119.04391527600001 28.944016752000039, 119.04463265000004 28.940294299000072, 119.04604651400007 28.938912132000041, 119.04645245100005 28.938515296000048, 119.04674180900008 28.938042986000028, 119.04749338800002 28.936571750000041, 119.04824503600003 28.935153204000073, 119.04848005200006 28.934625046000065, 119.04851844600012 28.934410992000039, 119.04849503200001 28.932255669000028, 119.04848281300008 28.931130962000054, 119.04849886400007 28.930850627000041, 119.04850653700009 28.929700707000052, 119.04846185000008 28.929201267000053, 119.04856106700004 28.926977122000039, 119.04875691400002 28.922533181000063, 119.04873365500009 28.922525557000029, 119.04771305100007 28.922191015000067, 119.04633555300006 28.920084664000058, 119.04613872200002 28.919855751000057, 119.04315338300012 28.918275610000023, 119.04241171900003 28.917883046000043, 119.04022516600003 28.916755263000027, 119.03695906600001 28.915858118000074, 119.03660412400006 28.912315727000077, 119.03603844700001 28.906670157000065, 119.03523771400012 28.90038620100006, 119.03076269900009 28.901107380000042, 119.02377511000009 28.89664450500004)))";


        public PropertyController(
            IPropertyService propertyService,
            IAccountUserService accountUserService,
        IGovernmentService governmentService,
            IAccountUserActivityService accountUserActivityService,
             IWebHelper webHelper,
             IPropertyNewCreateService propertyNewCreateService,
             IPropertyLendService propertyLendService,
             IPropertyRentService propertyRentService,
             IPropertyAllotService propertyAllotService, IPropertyOffService propertyOffService,
              IPropertyEditService propertyEditService, ICopyPropertyService copyPropertyService,
              IPictureService pictureService, IFileService fileService,
        IWorkContext workContext)
        {
            _propertyService = propertyService;
            _accountUserService = accountUserService;
            _accountUserActivityService = accountUserActivityService;
            _governmentService = governmentService;
            _propertyNewCreateService = propertyNewCreateService;
            _propertyLendService = propertyLendService;
            _propertyRentService = propertyRentService;
            _propertyAllotService = propertyAllotService;
            _propertyOffService = propertyOffService;
            _webHelper = webHelper;
            _workContext = workContext;
            _propertyEditService = propertyEditService;
            _copyPropertyService = copyPropertyService;
            _pictureService = pictureService;
            _fileService = fileService;
        }

        #region utility     

        /// <summary>
        /// 模型检查
        /// </summary>
        /// <param name="propertyCreateModel"></param>
        /// <returns></returns>
        [NonAction]

        protected virtual string PropertyCreateModelValid(PropertyCreateModel propertyCreateModel)
        {

            if (propertyCreateModel.PropertyTypeId == 0)
            {
                if (propertyCreateModel.ConstructArea <
                    (propertyCreateModel.CurrentUse_Idle + propertyCreateModel.CurrentUse_Lend +
                    propertyCreateModel.CurrentUse_Rent + propertyCreateModel.CurrentUse_Self))
                {
                    return "建筑面积应大于自用、出租、出借、闲置面积之和";
                }
            }

            if (propertyCreateModel.PropertyTypeId == 1)
            {
                if (propertyCreateModel.LandArea <
                (propertyCreateModel.CurrentUse_Idle + propertyCreateModel.CurrentUse_Lend +
                propertyCreateModel.CurrentUse_Rent + propertyCreateModel.CurrentUse_Self))
                {
                    return "土地面积应大于自用、出租、出借、闲置面积之和";
                }
            }

            if (string.IsNullOrEmpty(propertyCreateModel.Logo) && string.IsNullOrEmpty(propertyCreateModel.LogoUrl))
                return "请上传资产封面照片";


            return "";
        }

        /// <summary>
        /// 资产模型通用性处理
        /// </summary>
        /// <param name="property"></param>
        /// <param name="propertyModel"></param>
        [NonAction]

        protected virtual void PrepareProperty(Property property, PropertyCreateModel propertyCreateModel)
        {
            #region 日期处理
            if (!string.IsNullOrEmpty(propertyCreateModel.GetedDate))
            {
                try
                {
                    property.GetedDate = Convert.ToDateTime(propertyCreateModel.GetedDate);
                }
                catch
                {
                }
            }
            #endregion

            //产权单位处理
            if (propertyCreateModel.GovernmentId == 0) property.Government = _workContext.CurrentAccountUser.Government;
            else
            {
                var g = _governmentService.GetGovernmentUnitById(propertyCreateModel.GovernmentId);
                if (g == null) throw new Exception("产权单位无效");
                property.Government = g;
            }

            if (!string.IsNullOrEmpty(propertyCreateModel.Location)) property.Location = DbGeography.FromText(propertyCreateModel.Location);
            else throw new Exception("空间位置不能为空");
            if (!string.IsNullOrEmpty(propertyCreateModel.Extent)) property.Extent = DbGeography.FromText(propertyCreateModel.Extent);

            var DBLocaltion = DbGeography.FromText(propertyCreateModel.Location);
            var xq = DbGeography.FromText(xqregion);
            var kc = DbGeography.FromText(kcegion);
            var qj = DbGeography.FromText(qjregion);
            var lcq = DbGeography.FromText(lcqregion);
            var jjq = DbGeography.FromText(jjqregion);

            if (xq.Intersects(DBLocaltion))
            {
                property.Region = Region.West;
            }
            else if (kc.Intersects(DBLocaltion))
            {
                property.Region = Region.KC;
            }

            else if (qj.Intersects(DBLocaltion))
            {
                property.Region = Region.QJ;
            }
            else if (jjq.Intersects(DBLocaltion))
            {
                property.Region = Region.Clusters;
            }
            else if (lcq.Intersects(DBLocaltion))
            {
                property.Region = Region.OldCity;
            }

            property.HasConstructID = !string.IsNullOrEmpty(property.EstateId) || !string.IsNullOrEmpty(property.ConstructId);  //是否拥有房产证
            property.HasLandID = !string.IsNullOrEmpty(property.EstateId) || !string.IsNullOrEmpty(property.LandId);  //是否土地证
        }

        /// <summary>
        /// 高级搜索参数赋值
        /// </summary>
        /// <param name="model"></param>
        /// <param name="request"></param>
        [NonAction]
        protected virtual PropertyAdvanceConditionRequest PrepareAdvanceCondition(PropertyAdvanceConditionModel propertyAdvanceConditionModel)
        {
            var advanceCondition = new PropertyAdvanceConditionRequest();

            advanceCondition.SerachParentGovernement = propertyAdvanceConditionModel.Government.Manage;
            if (propertyAdvanceConditionModel.Government.SelectedId > 0)
                advanceCondition.GovernmentId = propertyAdvanceConditionModel.Government.SelectedId;

            if (propertyAdvanceConditionModel.Government.IsCompany) advanceCondition.GovernmentTypes.Add((int)GovernmentType.Company);
            if (propertyAdvanceConditionModel.Government.IsGovernment) advanceCondition.GovernmentTypes.Add((int)GovernmentType.Government);
            if (propertyAdvanceConditionModel.Government.IsInstitution) advanceCondition.GovernmentTypes.Add((int)GovernmentType.Institution);
            if (advanceCondition.Region.Count == 3) advanceCondition.GovernmentTypes = new List<int>();

            advanceCondition.PropertyType = new List<int>();
            if (propertyAdvanceConditionModel.PropertyType.Construct) advanceCondition.PropertyType.Add((int)PropertyType.House);
            if (propertyAdvanceConditionModel.PropertyType.Land) advanceCondition.PropertyType.Add((int)PropertyType.Land);
            if (propertyAdvanceConditionModel.PropertyType.ConstructOnLand) advanceCondition.PropertyType.Add((int)PropertyType.LandUnderHouse);
            if (advanceCondition.PropertyType.Count == 3) advanceCondition.PropertyType = new List<int>();

            advanceCondition.Region = new List<int>();
            if (propertyAdvanceConditionModel.Region.Old) advanceCondition.Region.Add((int)Region.OldCity);
            if (propertyAdvanceConditionModel.Region.West) advanceCondition.Region.Add((int)Region.West);
            if (propertyAdvanceConditionModel.Region.Jjq) advanceCondition.Region.Add((int)Region.Clusters);
            if (propertyAdvanceConditionModel.Region.Kc) advanceCondition.Region.Add((int)Region.KC);
            if (propertyAdvanceConditionModel.Region.Qj) advanceCondition.Region.Add((int)Region.QJ);
            if (propertyAdvanceConditionModel.Region.Other) advanceCondition.Region.Add((int)Region.Others);
            if (advanceCondition.Region.Count == 6) advanceCondition.Region = new List<int>();

            advanceCondition.Certificate_Both = propertyAdvanceConditionModel.Certificate.Both;
            advanceCondition.Certificate_Construct = propertyAdvanceConditionModel.Certificate.Construct;
            advanceCondition.Certificate_Land = propertyAdvanceConditionModel.Certificate.Land;
            advanceCondition.Certificate_None = propertyAdvanceConditionModel.Certificate.None;

            advanceCondition.Current_Self = propertyAdvanceConditionModel.Current.Self;
            advanceCondition.Current_Idle = propertyAdvanceConditionModel.Current.Idle;
            advanceCondition.Current_Lend = propertyAdvanceConditionModel.Current.Lend;
            advanceCondition.Current_Rent = propertyAdvanceConditionModel.Current.Rent;

            advanceCondition.NextStep = new List<int>();
            switch (propertyAdvanceConditionModel.NextStep.MapType)
            {
                case 1:
                    if (propertyAdvanceConditionModel.NextStep.Ct) advanceCondition.NextStep.Add((int)NextStepType.InjectionCT);
                    if (propertyAdvanceConditionModel.NextStep.Jt) advanceCondition.NextStep.Add((int)NextStepType.InjectionJT);
                    if (propertyAdvanceConditionModel.NextStep.Jk) advanceCondition.NextStep.Add((int)NextStepType.InjectionJK);
                    if (advanceCondition.NextStep.Count == 0) advanceCondition.NextStep.Add(-1);
                    break;
                case 2:
                    advanceCondition.NextStep.Add((int)NextStepType.Auction);
                    break;
                case 3:
                    advanceCondition.NextStep.Add((int)NextStepType.Storeup);
                    break;
            }
            //if (propertyAdvanceConditionModel.NextStep.Self) advanceCondition.NextStep.Add((int)NextStepType.Self);
            //if (propertyAdvanceConditionModel.NextStep.StoreUp) advanceCondition.NextStep.Add((int)NextStepType.Storeup);

            //if (propertyAdvanceConditionModel.NextStep.Greenland) advanceCondition.NextStep.Add((int)NextStepType.Greenland);
            //if (propertyAdvanceConditionModel.NextStep.Auction) advanceCondition.NextStep.Add((int)NextStepType.Auction);
            //if (propertyAdvanceConditionModel.NextStep.Adjust) advanceCondition.NextStep.Add((int)NextStepType.Adjust);
            //if (propertyAdvanceConditionModel.NextStep.House) advanceCondition.NextStep.Add((int)NextStepType.House);
            //if (advanceCondition.NextStep.Count == 8) advanceCondition.NextStep = new List<int>();

            advanceCondition.ConstructArea = new List<List<double>>();
            //foreach (var range in propertyAdvanceConditionModel.ConstructArea.Ranges)
            //{
            //    advanceCondition.ConstructArea.Add(new List<double>() { range.Min, range.Max });
            //}

            advanceCondition.LandArea = new List<List<double>>();
            //foreach (var range in propertyAdvanceConditionModel.LandArea.Ranges)
            //{
            //    advanceCondition.LandArea.Add(new List<double>() { range.Min, range.Max });
            //}

            advanceCondition.Price = new List<List<double>>();
            //foreach (var range in propertyAdvanceConditionModel.Price.Ranges)
            //{
            //    advanceCondition.Price.Add(new List<double>() { range.Min, range.Max });
            //}

            advanceCondition.LifeTime = new List<double>();
            //advanceCondition.LifeTime.Add(propertyAdvanceConditionModel.LifeTime.Min);
            //advanceCondition.LifeTime.Add(propertyAdvanceConditionModel.LifeTime.Max);

            advanceCondition.GetedDate = new List<double>();
            //if (propertyAdvanceConditionModel.GetedDate.Min != 0 && propertyAdvanceConditionModel.GetedDate.Max != 0)
            //{
            //    advanceCondition.GetedDate.Add(propertyAdvanceConditionModel.GetedDate.Min);
            //    advanceCondition.GetedDate.Add(propertyAdvanceConditionModel.GetedDate.Max);
            //}

            //if (!string.IsNullOrEmpty(propertyAdvanceConditionModel.Extent.Geo))
            //{
            //    try
            //    {
            //        advanceCondition.Extent = DbGeography.FromText(propertyAdvanceConditionModel.Extent.Geo);
            //    }
            //    catch
            //    {
            //        throw new QZCHYException("传入的范围参数不是一个正确的WKT格式的数据");
            //    }
            //}
            return advanceCondition;

        }

        /// <summary>
        /// 区间参数配置
        /// </summary>
        /// <param name="rangeStr"></param>
        /// <returns></returns>
        [NonAction]
        protected virtual RangeList PrepareRanges(string rangeStr)
        {
            var rangeList = new RangeList() { Ranges = new List<Range>() };
            if (!string.IsNullOrEmpty(rangeStr))
            {
                var rangeArr = rangeStr.Split(';');
                foreach (var range in rangeArr)
                {
                    var minAndMax = range.Split('_');
                    if (minAndMax.Length == 2)
                    {
                        var r = new Range
                        {
                            Min = Convert.ToDouble(minAndMax[0]),
                            Max = Convert.ToDouble(minAndMax[1])
                        };
                        rangeList.Ranges.Add(r);
                    }
                }
            }
            return rangeList;
        }

        [NonAction]
        protected virtual Range PrepareRange(string rangeStr)
        {
            var minAndMax = rangeStr.Split('_');
            if (minAndMax.Length == 2)
            {
                var r = new Range
                {
                    Min = Convert.ToDouble(minAndMax[0]),
                    Max = Convert.ToDouble(minAndMax[1])
                };
                return r;
            }
            return new Range { Min = 0, Max = 0 };
        }

        /// <summary>
        /// 资产是否属于当前用户的部门
        /// </summary>
        /// <param name="property"></param>
        /// <returns></returns>
        [NonAction]
        protected virtual bool PropertyBelongCurrentUser(Property property, bool exceptGovernmentHasUsers = false)
        {
            var currentUser = _workContext.CurrentAccountUser;
            var ownerGovernment = property.Government;
            if (ownerGovernment.Id == currentUser.Government.Id) return true;  //本单位
            else
            {
                var childrenGovernmentIds = _governmentService.GetGovernmentIdsByParentId(currentUser.Government.Id, exceptGovernmentHasUsers);
                return childrenGovernmentIds.Contains(ownerGovernment.Id);
            }
        }

        /// <summary>
        /// 处置申请是否可以审批
        /// </summary>
        /// <param name="state"></param>
        /// <param name="suggestionId"></param>
        /// <returns></returns>
        [NonAction]
        protected virtual bool PropertyCanApprove(PropertyApproveState state, int suggestionId)
        {
            var currentUser = _workContext.CurrentAccountUser;
            var g = _governmentService.GetGovernmentUnitById(suggestionId);
            if (g == null) return false;

            //部门审核阶段
            if (state == PropertyApproveState.DepartmentApprove)
            {
                //必须是主管单位才能审核
                var childrenGovernmentIds = _governmentService.GetGovernmentIdsByParentId(currentUser.Government.Id);
                if (!childrenGovernmentIds.Contains(currentUser.Government.Id)) childrenGovernmentIds.Add(currentUser.Government.Id);
                return childrenGovernmentIds.Contains(suggestionId) && currentUser.IsParentGovernmentorAuditor();
                //return currentUser.Government.ParentGovernmentId == 0 && currentUser.Government.Id == g.ParentGovernmentId;
            }
            else if (state == PropertyApproveState.AdminApprove)
            {
                if (g.GovernmentType == GovernmentType.Company) return currentUser.IsStateOwnerAuditor();
                else return currentUser.IsGovAuditor();
            }

            return false;
        }

        /// <summary>
        /// 是否可以编辑
        /// </summary>
        /// <param name="state"></param>
        /// <param name="suggestionId"></param>
        /// <returns></returns>
        [NonAction]
        protected virtual bool PropertyApproveCanEditDeleteAndSubmit(PropertyApproveState state, int suggestionId)
        {
            var currentUser = _workContext.CurrentAccountUser;

            if (state != PropertyApproveState.Start) return false;

            //必须是申请的人才有权限
            return suggestionId == currentUser.Government.Id;
        }

        /// <summary>
        /// 资产是否可以查看
        /// </summary>
        /// <param name="property"></param>
        /// <returns></returns>
        [NonAction]
        protected virtual bool PropertyCanView(Property property)
        {
            return PropertyBelongCurrentUser(property, false);
        }


        /// <summary>
        /// 资产是否可以编辑
        /// </summary>
        /// <param name="property"></param>
        /// <returns></returns>
        [NonAction]
        protected virtual bool PropertyCanEditDelete(Property property)
        {
            var currentUser = _workContext.CurrentAccountUser;
            if (currentUser.IsAdmin() || currentUser.IsGovAuditor() || currentUser.IsStateOwnerAuditor() || currentUser.IsDataReviewer()) return false;  //超管等角色不能进行资产处置

            if (PropertyBelongCurrentUser(property, true))
            {
                return !property.Published && !property.Off;
            }

            return false;
        }

        /// <summary>
        /// 资产是否可以变更
        /// </summary>
        /// <param name="property"></param>
        /// <returns></returns>
        [NonAction]
        protected virtual bool PropertyCanChange(Property property)
        {
            var currentUser = _workContext.CurrentAccountUser;
            if (currentUser.IsAdmin() || currentUser.IsGovAuditor() || currentUser.IsStateOwnerAuditor() || currentUser.IsDataReviewer()) return false;  //超管等角色不能进行资产处置

            if (PropertyBelongCurrentUser(property, true))
            {
                var edits = _propertyEditService.GetPropertyEditByPropertyId(property.Id);

                if (edits.Count > 0)
                {
                    var startEdits = edits.Where(e => e.State == PropertyApproveState.Start);
                    var finishEdits = edits.Where(e => e.State == PropertyApproveState.Finish);

                    if (edits.Count == finishEdits.Count() + startEdits.Count())
                    {
                        return (startEdits.Count() == 0 || startEdits.Count() == 1) && property.Published;
                    }
                }
                else
                {
                    return property.Published && !property.Locked;
                }
            }

            return false;
        }

        [NonAction]
        protected virtual CopyProperty CopyPropertyChange(CopyProperty copy, PropertyCreateModel propertyCreateModel, Property property, Picture logoPicture)
        {
            copy.GetedDate = Convert.ToDateTime(propertyCreateModel.GetedDate);
            copy.PropertyID = property.PropertyID;
            copy.Government_Id = property.Government.Id;

            var DBLocaltion = DbGeography.FromText(propertyCreateModel.Location);
            var xq = DbGeography.FromText(xqregion);
            var kc = DbGeography.FromText(kcegion);
            var qj = DbGeography.FromText(qjregion);
            var lcq = DbGeography.FromText(lcqregion);
            var jjq = DbGeography.FromText(jjqregion);

            if (xq.Intersects(DBLocaltion))
            {
                copy.Region = Region.West;
            }
            else if (kc.Intersects(DBLocaltion))
            {
                copy.Region = Region.KC;
            }

            else if (qj.Intersects(DBLocaltion))
            {
                copy.Region = Region.QJ;
            }
            else if (jjq.Intersects(DBLocaltion))
            {
                copy.Region = Region.Clusters;
            }
            else if (lcq.Intersects(DBLocaltion))
            {
                copy.Region = Region.OldCity;
            }

            //  copy.Region = propertyCreateModel.re
            copy.Property_Id = property.Id;

            copy.PrictureIds = string.Join("_", propertyCreateModel.Pictures.Select(p => p.PictureId).ToArray());
            copy.FileIds = string.Join("_", propertyCreateModel.Files.Select(p => p.FileId).ToArray());
            if (logoPicture != null) copy.LogoPicture_Id = logoPicture.Id;
            return copy;
        }

        [NonAction]
        protected virtual void PreparePropertyPictures(PropertyCreateModel propertyCreateModel)
        {
            propertyCreateModel.Pictures = propertyCreateModel.Pictures.Where(p => !p.IsLogo).ToList();

            foreach (var propertyPictureModel in propertyCreateModel.Pictures)
            {
                propertyPictureModel.Href = _pictureService.GetPictureUrl(propertyPictureModel.PictureId);
            }

            propertyCreateModel.Pictures = propertyCreateModel.Pictures.OrderBy(pp => pp.DisplayOrder).ToList();
        }

        [NonAction]
        protected virtual void PreparePropertyPictures(PropertyModel propertyModel)
        {
            propertyModel.Pictures = propertyModel.Pictures.Where(p => !p.IsLogo).ToList();

            foreach (var propertyPictureModel in propertyModel.Pictures)
            {
                propertyPictureModel.Href = _pictureService.GetPictureUrl(propertyPictureModel.PictureId);
            }

            propertyModel.Pictures = propertyModel.Pictures.OrderBy(pp => pp.DisplayOrder).ToList();
        }

        [NonAction]
        protected virtual void PreparePropertyFiles(PropertyModel propertyModel)
        {
            foreach (var propertyFileModel in propertyModel.Files)
            {
                propertyFileModel.Src = _fileService.GetFileUrl(propertyFileModel.FileId);
                propertyFileModel.Uploaded = true;
                propertyFileModel.Percentage = 100;
            }
        }

        [NonAction]
        protected virtual void PreparePropertyFiles(PropertyCreateModel propertyCreateModel)
        {
            foreach (var propertyFileModel in propertyCreateModel.Files)
            {
                propertyFileModel.Src = _fileService.GetFileUrl(propertyFileModel.FileId);
                propertyFileModel.Uploaded = true;
                propertyFileModel.Percentage = 100;
            }
        }

        [NonAction]
        protected virtual void SavePropertyPictures(Property property, IEnumerable<PropertyPictureModel> propertyPictures)
        {
            var existingPropertyPictures = property.Pictures.ToList();
            var propertyPicturesToRemove = new List<PropertyPicture>();

            //获取要删除的图片
            foreach (var existingPropertyPicture in existingPropertyPictures)
            {
                if (existingPropertyPicture.IsLogo) continue;  //不要删logo

                if (propertyPictures.Where(pp => pp.Id == existingPropertyPicture.Id).Count() == 0)
                {
                    propertyPicturesToRemove.Add(existingPropertyPicture);
                }
            }

            foreach (var newPropertyPictureModel in propertyPictures)
            {
                var propertyPicture = newPropertyPictureModel.ToEntity();

                if (newPropertyPictureModel.Id == 0) property.Pictures.Add(propertyPicture);
            }

            //删除不存在的图片
            foreach (var propertyPicture in propertyPicturesToRemove)
            {
                _propertyService.DeletePropertyPicture(propertyPicture);
                //property.Pictures.Remove(propertyPicture);
            }
        }

        #region 图片处理
        [NonAction]
        protected virtual void SavePropertyFiles(Property property, IEnumerable<PropertyFileModel> propertyFiles)
        {
            var existingPropertyFiles = property.Files.ToList();
            var propertyFilesToRemove = new List<PropertyFile>();

            //获取要删除的文件
            foreach (var existingPropertyFile in existingPropertyFiles)
            {
                if (propertyFiles.Where(pp => pp.Id == existingPropertyFile.Id).Count() == 0)
                {
                    propertyFilesToRemove.Add(existingPropertyFile);
                }
            }

            foreach (var newPropertyFileModel in propertyFiles)
            {
                var propertyFile = newPropertyFileModel.ToEntity();

                if (newPropertyFileModel.Id == 0) property.Files.Add(propertyFile);
            }

            //删除不存在的图片
            foreach (var propertyFile in propertyFilesToRemove)
            {
                _propertyService.DeletePropertyFile(propertyFile);
            }
        }

        [NonAction]
        protected virtual void SavePropertyLendPictures(PropertyLend propertyLend, IEnumerable<PropertyLendPictureModel> propertyLendPictures)
        {
            var existingPropertyLendPictures = propertyLend.LendPictures.ToList();
            var propertyPicturesToRemove = new List<PropertyLendPicture>();

            //获取要删除的图片
            foreach (var existingPropertyLendPicture in existingPropertyLendPictures)
            {
                if (propertyLendPictures.Where(pp => pp.Id == existingPropertyLendPicture.Id).Count() == 0)
                {
                    propertyPicturesToRemove.Add(existingPropertyLendPicture);
                }
            }

            foreach (var newPropertyLendPictureModel in propertyLendPictures)
            {
                var propertyPicture = newPropertyLendPictureModel.ToEntity();

                if (newPropertyLendPictureModel.Id == 0) propertyLend.LendPictures.Add(propertyPicture);
            }

            //删除不存在的图片
            foreach (var propertyLendPicture in propertyPicturesToRemove)
            {
                _propertyLendService.DeletePropertyLendPicture(propertyLendPicture);
            }
        }

        [NonAction]
        protected virtual void SavePropertyLendFiles(PropertyLend property, IEnumerable<PropertyLendFileModel> propertyLendFiles)
        {
            var existingPropertyLendFiles = property.LendFiles.ToList();
            var propertyLendFilesToRemove = new List<PropertyLendFile>();

            //获取要删除的文件
            foreach (var existingPropertyLendFile in existingPropertyLendFiles)
            {
                if (propertyLendFiles.Where(pp => pp.Id == existingPropertyLendFile.Id).Count() == 0)
                {
                    propertyLendFilesToRemove.Add(existingPropertyLendFile);
                }
            }

            foreach (var newPropertyFileModel in propertyLendFiles)
            {
                var propertyFile = newPropertyFileModel.ToEntity();

                if (newPropertyFileModel.Id == 0) property.LendFiles.Add(propertyFile);
            }

            //删除不存在的图片
            foreach (var propertyLendFile in propertyLendFilesToRemove)
            {
                _propertyLendService.DeletePropertyLendFile(propertyLendFile);
            }
        }

        [NonAction]
        protected virtual void SavePropertyRentPictures(PropertyRent propertyRent, IEnumerable<PropertyRentPictureModel> propertyRentPictures)
        {
            var existingPropertyRentPictures = propertyRent.RentPictures.ToList();
            var propertyPicturesToRemove = new List<PropertyRentPicture>();

            //获取要删除的图片
            foreach (var existingPropertyRentPicture in existingPropertyRentPictures)
            {
                if (propertyRentPictures.Where(pp => pp.Id == existingPropertyRentPicture.Id).Count() == 0)
                {
                    propertyPicturesToRemove.Add(existingPropertyRentPicture);
                }
            }

            foreach (var newPropertyRentPictureModel in propertyRentPictures)
            {
                var propertyPicture = newPropertyRentPictureModel.ToEntity();

                if (newPropertyRentPictureModel.Id == 0) propertyRent.RentPictures.Add(propertyPicture);
            }

            //删除不存在的图片
            foreach (var propertyRentPicture in propertyPicturesToRemove)
            {
                _propertyRentService.DeletePropertyRentPicture(propertyRentPicture);
            }
        }

        [NonAction]
        protected virtual void SavePropertyRentFiles(PropertyRent property, IEnumerable<PropertyRentFileModel> propertyRentFiles)
        {
            var existingPropertyRentFiles = property.RentFiles.ToList();
            var propertyRentFilesToRemove = new List<PropertyRentFile>();

            //获取要删除的文件
            foreach (var existingPropertyRentFile in existingPropertyRentFiles)
            {
                if (propertyRentFiles.Where(pp => pp.Id == existingPropertyRentFile.Id).Count() == 0)
                {
                    propertyRentFilesToRemove.Add(existingPropertyRentFile);
                }
            }

            foreach (var newPropertyFileModel in propertyRentFiles)
            {
                var propertyFile = newPropertyFileModel.ToEntity();

                if (newPropertyFileModel.Id == 0) property.RentFiles.Add(propertyFile);
            }

            //删除不存在的图片
            foreach (var propertyRentFile in propertyRentFilesToRemove)
            {
                _propertyRentService.DeletePropertyRentFile(propertyRentFile);
            }
        }

        [NonAction]
        protected virtual void SavePropertyAllotPictures(PropertyAllot propertyAllot, IEnumerable<PropertyAllotPictureModel> propertyAllotPictures)
        {
            var existingPropertyAllotPictures = propertyAllot.AllotPictures.ToList();
            var propertyPicturesToRemove = new List<PropertyAllotPicture>();

            //获取要删除的图片
            foreach (var existingPropertyAllotPicture in existingPropertyAllotPictures)
            {
                if (propertyAllotPictures.Where(pp => pp.Id == existingPropertyAllotPicture.Id).Count() == 0)
                {
                    propertyPicturesToRemove.Add(existingPropertyAllotPicture);
                }
            }

            foreach (var newPropertyAllotPictureModel in propertyAllotPictures)
            {
                var propertyPicture = newPropertyAllotPictureModel.ToEntity();

                if (newPropertyAllotPictureModel.Id == 0) propertyAllot.AllotPictures.Add(propertyPicture);
            }

            //删除不存在的图片
            foreach (var propertyAllotPicture in propertyPicturesToRemove)
            {
                _propertyAllotService.DeletePropertyAllotPicture(propertyAllotPicture);
            }
        }

        [NonAction]
        protected virtual void SavePropertyAllotFiles(PropertyAllot property, IEnumerable<PropertyAllotFileModel> propertyAllotFiles)
        {
            var existingPropertyAllotFiles = property.AllotFiles.ToList();
            var propertyAllotFilesToRemove = new List<PropertyAllotFile>();

            //获取要删除的文件
            foreach (var existingPropertyAllotFile in existingPropertyAllotFiles)
            {
                if (propertyAllotFiles.Where(pp => pp.Id == existingPropertyAllotFile.Id).Count() == 0)
                {
                    propertyAllotFilesToRemove.Add(existingPropertyAllotFile);
                }
            }

            foreach (var newPropertyFileModel in propertyAllotFiles)
            {
                var propertyFile = newPropertyFileModel.ToEntity();

                if (newPropertyFileModel.Id == 0) property.AllotFiles.Add(propertyFile);
            }

            //删除不存在的图片
            foreach (var propertyAllotFile in propertyAllotFilesToRemove)
            {
                _propertyAllotService.DeletePropertyAllotFile(propertyAllotFile);
            }
        }

        [NonAction]
        protected virtual void SavePropertyOffPictures(PropertyOff propertyOff, IEnumerable<PropertyOffPictureModel> propertyOffPictures)
        {
            var existingPropertyOffPictures = propertyOff.OffPictures.ToList();
            var propertyPicturesToRemove = new List<PropertyOffPicture>();

            //获取要删除的图片
            foreach (var existingPropertyOffPicture in existingPropertyOffPictures)
            {
                if (propertyOffPictures.Where(pp => pp.Id == existingPropertyOffPicture.Id).Count() == 0)
                {
                    propertyPicturesToRemove.Add(existingPropertyOffPicture);
                }
            }

            foreach (var newPropertyOffPictureModel in propertyOffPictures)
            {
                var propertyPicture = newPropertyOffPictureModel.ToEntity();

                if (newPropertyOffPictureModel.Id == 0) propertyOff.OffPictures.Add(propertyPicture);
            }

            //删除不存在的图片
            foreach (var propertyOffPicture in propertyPicturesToRemove)
            {
                _propertyOffService.DeletePropertyOffPicture(propertyOffPicture);
            }
        }

        [NonAction]
        protected virtual void SavePropertyOffFiles(PropertyOff property, IEnumerable<PropertyOffFileModel> propertyOffFiles)
        {
            var existingPropertyOffFiles = property.OffFiles.ToList();
            var propertyOffFilesToRemove = new List<PropertyOffFile>();

            //获取要删除的文件
            foreach (var existingPropertyOffFile in existingPropertyOffFiles)
            {
                if (propertyOffFiles.Where(pp => pp.Id == existingPropertyOffFile.Id).Count() == 0)
                {
                    propertyOffFilesToRemove.Add(existingPropertyOffFile);
                }
            }

            foreach (var newPropertyFileModel in propertyOffFiles)
            {
                var propertyFile = newPropertyFileModel.ToEntity();

                if (newPropertyFileModel.Id == 0) property.OffFiles.Add(propertyFile);
            }

            //删除不存在的图片
            foreach (var propertyOffFile in propertyOffFilesToRemove)
            {
                _propertyOffService.DeletePropertyOffFile(propertyOffFile);
            }
        }
        #endregion

        [NonAction]
        protected virtual void PreparePropertyLendPicturesAndFiles(PropertyLendModel propertyLendModel)
        {
            propertyLendModel.LendPictures = propertyLendModel.LendPictures.ToList();

            foreach (var propertyPictureModel in propertyLendModel.LendPictures)
            {
                propertyPictureModel.Href = _pictureService.GetPictureUrl(propertyPictureModel.PictureId);
            }

            propertyLendModel.LendPictures = propertyLendModel.LendPictures.OrderBy(pp => pp.DisplayOrder).ToList();

            foreach (var propertyLendFileModel in propertyLendModel.LendFiles)
            {
                propertyLendFileModel.Src = _fileService.GetFileUrl(propertyLendFileModel.FileId);
                propertyLendFileModel.Uploaded = true;
                propertyLendFileModel.Percentage = 100;
            }
        }

        [NonAction]
        protected virtual void PreparePropertyRentPicturesAndFiles(PropertyRentModel propertyRentModel)
        {
            propertyRentModel.RentPictures = propertyRentModel.RentPictures.ToList();

            foreach (var propertyPictureModel in propertyRentModel.RentPictures)
            {
                propertyPictureModel.Href = _pictureService.GetPictureUrl(propertyPictureModel.PictureId);
            }

            propertyRentModel.RentPictures = propertyRentModel.RentPictures.OrderBy(pp => pp.DisplayOrder).ToList();

            foreach (var propertyRentFileModel in propertyRentModel.RentFiles)
            {
                propertyRentFileModel.Src = _fileService.GetFileUrl(propertyRentFileModel.FileId);
                propertyRentFileModel.Uploaded = true;
                propertyRentFileModel.Percentage = 100;
            }
        }

        [NonAction]
        protected virtual void PreparePropertyAllotPicturesAndFiles(PropertyAllotModel propertyAllotModel)
        {
            propertyAllotModel.AllotPictures = propertyAllotModel.AllotPictures.ToList();

            foreach (var propertyPictureModel in propertyAllotModel.AllotPictures)
            {
                propertyPictureModel.Href = _pictureService.GetPictureUrl(propertyPictureModel.PictureId);
            }

            propertyAllotModel.AllotPictures = propertyAllotModel.AllotPictures.OrderBy(pp => pp.DisplayOrder).ToList();

            foreach (var propertyAllotFileModel in propertyAllotModel.AllotFiles)
            {
                propertyAllotFileModel.Src = _fileService.GetFileUrl(propertyAllotFileModel.FileId);
                propertyAllotFileModel.Uploaded = true;
                propertyAllotFileModel.Percentage = 100;
            }
        }

        [NonAction]
        protected virtual void PreparePropertyOffPicturesAndFiles(PropertyOffModel propertyOffModel)
        {
            propertyOffModel.OffPictures = propertyOffModel.OffPictures.ToList();

            foreach (var propertyPictureModel in propertyOffModel.OffPictures)
            {
                propertyPictureModel.Href = _pictureService.GetPictureUrl(propertyPictureModel.PictureId);
            }

            propertyOffModel.OffPictures = propertyOffModel.OffPictures.OrderBy(pp => pp.DisplayOrder).ToList();

            foreach (var propertyOffFileModel in propertyOffModel.OffFiles)
            {
                propertyOffFileModel.Src = _fileService.GetFileUrl(propertyOffFileModel.FileId);
                propertyOffFileModel.Uploaded = true;
                propertyOffFileModel.Percentage = 100;
            }
        }

        [NonAction]
        protected virtual PropertyPicture GetLogoPicture(Property property)
        {

            //获取logo图片
            var logoPicture = property.Pictures.Where(sp => sp.IsLogo).SingleOrDefault();

            return logoPicture;
        }

        [NonAction]
        protected virtual string GetLogoUrl(Property property)
        {
            string logoUrl = string.Empty;
            //获取logo图片
            var logoPicture = GetLogoPicture(property);
            if (logoPicture != null)
            {
                logoUrl = _pictureService.GetPictureUrl(logoPicture.PictureId);
            }

            return logoUrl;
        }

        /// <summary>
        /// 资产锁定状态切换
        /// </summary>
        /// <param name="locked"></param>
        /// <param name="property"></param>
        protected virtual void SwitchPropertyLockState(bool locked, Property property)
        {
            if (property.Locked != locked)
            {
                property.Locked = locked; //资产被锁定，无法进行其他操作
                _propertyService.UpdateProperty(property);

                //activity log
                _accountUserActivityService.InsertActivity("LockPropertySwitch", "{1} 名为 {0} 的资产", property.Name, locked ? "锁定" : "解锁");
            }
        }

        #endregion

        #region 资产API
        [HttpGet]
        [Route("Unique/{name}")]
        public IHttpActionResult UniqueCheck(string name)
        {
            var result = !_propertyService.NameUniqueCheck(name);

            return Ok(result);
        }

        [HttpGet]
        [Route("{propertyId:int}")]
        public IHttpActionResult Get(int propertyId)
        {
            var currentUser = _workContext.CurrentAccountUser;

            var property = _propertyService.GetPropertyById(propertyId);
            if (property == null || property.Deleted)
                return NotFound();

            if (!(currentUser.IsAdmin()|| currentUser.IsDataReviewer() || PropertyCanView(property))) 
                return NotFound();
            //var index = 1;
            //foreach (var rent in property.Rents) {
            //    if (rent != null)
            //    {
            //        var priceList = rent.PriceString.Split(';');
            //        rent.PriceString = "";
            //        foreach (var price in priceList)
            //        {
            //            if (!string.IsNullOrEmpty(price)) {
            //                rent.PriceString += string.Format("第{0}年租金{1}元;", index, price);
            //                index++;
            //            }                       
            //        }
            //    }
            //}

            var model = property.ToModel();
            model.LogoUrl = GetLogoUrl(property);
            model.NewCreate = _propertyNewCreateService.GetPropertyNewCreateByPropertyId(model.Id).ToModel();

            model.CanEditDelete = PropertyCanEditDelete(property);
            model.CanChange = PropertyCanChange(property);
            var propertyOff= _propertyOffService.GetPropertyOffById(model.Id).ToModel();
            if (propertyOff != null) model.PropertyOff = propertyOff;

            //获取图片
            PreparePropertyPictures(model);
            //获取文件
            PreparePropertyFiles(model);
            //activity log
            _accountUserActivityService.InsertActivity("GetpropertyInfo", "获取 名为 {0} 的资产信息", property.Name);

            return Ok(model);
        }

        /// <summary>
        /// 获取要更新的资产
        /// </summary>
        /// <param name="propertyId"></param>
        /// <returns></returns>
        [HttpGet]
        [Route("Update/{propertyId:int}")]
        public IHttpActionResult GetUpdatedProperty(int propertyId)
        {
            var currentUser = _workContext.CurrentAccountUser;

            var property = _propertyService.GetPropertyById(propertyId);
            if (property == null || property.Deleted)
                return NotFound();

            if (!PropertyCanEditDelete(property) && !PropertyCanChange(property)) return NotFound();// "资产无法编辑或变更！");

            var propertyCreatModel = new PropertyCreateModel();

            var edit = property.Edits.Where(e => e.State == PropertyApproveState.Start && !e.Deleted).FirstOrDefault();
            if (edit != null) {
                var copyproperty = _copyPropertyService.GetCopyPropertyById(edit.CopyProperty_Id);
                propertyCreatModel = copyproperty.ToCreateModel();

                propertyCreatModel.Owner_self = propertyCreatModel.GovernmentId == currentUser.Government.Id;
                propertyCreatModel.Owner_children = propertyCreatModel.Owner_self;

                #region 新数据库对象
                #region 获取图片
                propertyCreatModel.Pictures = new List<PropertyPictureModel>();
                foreach (var pid in copyproperty.PrictureIds.Split('_'))
                {
                    if (string.IsNullOrWhiteSpace(pid)) continue;
                    var picture = _pictureService.GetPictureById(Convert.ToInt32(pid));
                    if (picture == null) continue;

                    var propertyPictureModel = new PropertyPictureModel
                    {
                        PictureId = picture.Id,
                        PropertyId = copyproperty.Id,
                        Href = _pictureService.GetPictureUrl(picture.Id),
                        Title = picture.TitleAttribute
                    };

                    propertyCreatModel.Pictures.Add(propertyPictureModel);
                }
                #endregion

                #region 文件更新
                propertyCreatModel.Files = new List<PropertyFileModel>();
                foreach (var fid in copyproperty.FileIds.Split('_'))
                {
                    if (string.IsNullOrWhiteSpace(fid)) continue;
                    var file = _fileService.GetFileById(Convert.ToInt32(fid));
                    if (file == null) continue;

                    var propertyFileModel = new PropertyFileModel
                    {
                        FileId = file.Id,
                        PropertyId = copyproperty.Id,
                        Src = _fileService.GetFileUrl(file),
                        Title = file.Name,
                        Percentage = 100,
                        Uploaded = true
                    };

                    propertyCreatModel.Files.Add(propertyFileModel);
                }

                #endregion
                var logoUrl= _pictureService.GetPictureUrl(copyproperty.LogoPicture_Id);
                propertyCreatModel.LogoUrl = string.IsNullOrEmpty(logoUrl) ? null : logoUrl;
                propertyCreatModel.Logo = null;
                propertyCreatModel.LogoPictureId = copyproperty.LogoPicture_Id;
                #endregion
            }   
            else 
            {
                //if (!currentUser.IsAdmin() && !(property.Government.Id == currentUser.Government.Id || property.Government.ParentGovernmentId == currentUser.Government.Id)
                //    return NotFound();

                propertyCreatModel = property.ToCreateModel();
                propertyCreatModel.Owner_self = propertyCreatModel.GovernmentId == currentUser.Government.Id;
                propertyCreatModel.Owner_children = propertyCreatModel.Owner_self;
                propertyCreatModel.LogoUrl = string.IsNullOrEmpty(GetLogoUrl(property)) ? null : GetLogoUrl(property);
                var propertyLogoPicture = GetLogoPicture(property);
                propertyCreatModel.LogoPictureId = propertyLogoPicture == null ? 0 : propertyLogoPicture.PictureId;
                propertyCreatModel.Logo = null;
                //获取图片
                PreparePropertyPictures(propertyCreatModel);

                //获取文件
                PreparePropertyFiles(propertyCreatModel);

                //activity log
                _accountUserActivityService.InsertActivity("GetpropertyInfo", "获取 名为 {0} 的资产信息", property.Name);
            }

            return Ok(propertyCreatModel);
        }

        [HttpGet]
        [Route("")]
        public IHttpActionResult GetAll(string query = "", string sort = "", int pageSize = Int32.MaxValue, int pageIndex = 0, bool showHidden = false, long time = 0,
            bool manage = false, bool isGovernment = false, bool isInstitution = false, bool isCompany = false, int selectedId = 0,
            bool construct = false, bool land = false, bool constructOnLand = false,//资产类型
            bool old = false, bool west = false, bool jjq = false, bool kc = false, bool qj = false, bool other = false, //区域
            bool certi_both = false, bool certi_land = false, bool certi_construct = false, bool certi_none = false, //证书情况
            bool current_self = false, bool current_rent = false, bool current_lend = false, bool currnet_idle = false, //使用现状
            bool auction = false, bool ct = false, bool jt = false, bool jk = false, bool self = false, bool storeUp = false, bool adjust = false, bool greenland = false, bool house = false//下步使用
                                                                                                                                                                                             //   string constructAreaRange = "", string landAreaRange = "", string priceRange = "", string getDateRange=""  //范围参数
            )
        {
            var currentUser = _workContext.CurrentAccountUser;

            showHidden = currentUser.IsRegistered() && !(currentUser.IsAdmin() || currentUser.IsGovAuditor() || currentUser.IsStateOwnerAuditor() || currentUser.IsDataReviewer());   //只是注册单位可以获取未发布的

            //初始化排序条件
            var sortConditions = PropertySortCondition.Instance(sort);

            //特殊字段排序调整
            if (sort.ToLower().StartsWith("governmentname")) sortConditions[0].PropertyName = "Government";

            //高级搜索参数设置
            PropertyAdvanceConditionModel advance = new PropertyAdvanceConditionModel
            {
                Government = new GovernmentFilterModel { Manage = manage, IsCompany = isCompany, IsGovernment = isGovernment, IsInstitution = isInstitution, SelectedId = selectedId },
                PropertyType = new PropertyTypeModel { Construct = construct, Land = land, ConstructOnLand = constructOnLand },
                Region = new RegionModel { West = west, Jjq = jjq, Kc = kc, Old = old, Other = other, Qj = qj },
                Certificate = new Certificate { Both = certi_both, Construct = certi_construct, Land = certi_land, None = certi_land },
                Current = new CurrentModel { Idle = currnet_idle, Lend = current_lend, Rent = current_rent, Self = current_self },
                NextStep = new NextStepModel { Adjust = adjust, Auction = auction, Ct = ct, Jt = jt, Jk = jk, Greenland = greenland, House = house, Self = self, StoreUp = storeUp }
            };

            //advance.ConstructArea = PrepareRanges(constructAreaRange);
            //advance.LandArea = PrepareRanges(landAreaRange);
            //advance.Price = PrepareRanges(priceRange);
            //advance.GetedDate = PrepareRange(getDateRange);

            //高级搜索参数设置
            PropertyAdvanceConditionRequest request = PrepareAdvanceCondition(advance);

            var governmentIds =_governmentService.GetGovernmentIdsByCurrentUser();  //获取当前账户的可查询的资产
           
            var properties = _propertyService.GetAllProperties(governmentIds, query, pageIndex, pageSize,
               showHidden, request, sortConditions);

            var response = new ListResponse<PropertyListModel>
            {
                Time = time,
                Paging = new Paging
                {
                    PageIndex = pageIndex,
                    PageSize = pageSize,
                    Total = properties.TotalCount,
                    FilterCount = string.IsNullOrEmpty(query) ? properties.TotalCount : properties.Count,
                },
                Data = properties.Select(s =>
                {
                    var propertyModel = s.ToListModel();
                    if (s.Off)
                        propertyModel.Name = propertyModel.Name + "（已核销）";
                    else if (!s.Published)
                        propertyModel.Name = propertyModel.Name + "（未发布）";


                    propertyModel.CanEditDelete = PropertyCanEditDelete(s);
                    propertyModel.CanChange = PropertyCanChange(s);

                    return propertyModel;
                })
            };

            //activity log
            _accountUserActivityService.InsertActivity("GetpropertyList", "获取资产列表信息");

            return Ok(response);
        }


        [HttpPost]
        [Route("")]
        public IHttpActionResult GetAll(PropertyAdvanceConditionModel advance)
        {
            var currentUser = _workContext.CurrentAccountUser;

      var      showHidden = currentUser.IsRegistered() && !(currentUser.IsAdmin() || currentUser.IsGovAuditor() || currentUser.IsStateOwnerAuditor() || currentUser.IsDataReviewer());   //只是注册单位可以获取未发布的

            //初始化排序条件
            var sortConditions = PropertySortCondition.Instance(advance.Sort);

            //特殊字段排序调整
            if (advance.Sort.ToLower().StartsWith("governmentname")) sortConditions[0].PropertyName = "Government";

            //高级搜索参数设置
            PropertyAdvanceConditionRequest request = PrepareAdvanceCondition(advance);

            var governmentIds = _governmentService.GetGovernmentIdsByCurrentUser();  //获取当前账户的可查询的资产

            var properties = _propertyService.GetAllProperties(governmentIds,advance.Query, advance.PageIndex, advance.PageSize,
                showHidden, request, sortConditions);

            var response = new ListResponse<PropertyModel>
            {
                Time = advance.Time,
                Paging = new Paging
                {
                    PageIndex = advance.PageIndex,
                    PageSize = advance.PageSize,
                    Total = properties.TotalCount,
                    FilterCount = string.IsNullOrEmpty(advance.Query) ? properties.TotalCount : properties.Count,
                },
                Data = properties.Select(s =>
                {
                    var propertyModel = s.ToModel();
                    if (!propertyModel.Published) propertyModel.Name += "（未发布）";
                    else if (!s.Off) propertyModel.Name += "（已核销）";
                    return propertyModel;
                })
            };

            //activity log
            _accountUserActivityService.InsertActivity("GetpropertyList", "获取资产列表信息");

            return Ok(response);
        }

        /// <summary>
        /// 地图中的搜索
        /// </summary>
        /// <param name="query"></param>
        /// <param name="sort"></param>
        /// <param name="pageSize"></param>
        /// <param name="pageIndex"></param>
        /// <param name="showHidden"></param>
        /// <returns></returns>
        [HttpPost]
        [Route("geo")]
        public IHttpActionResult GetAllInMap(PropertyAdvanceConditionModel advance)
        {
            var currentUser = _workContext.CurrentAccountUser;

            var showHidden = currentUser.IsRegistered() && currentUser.AccountUserRoles.Count == 1;  //只是注册单位可以获取未发布的

            //初始化排序条件
            var sortConditions = PropertySortCondition.Instance(advance.Sort);

            //特殊字段排序调整
            if (advance.Sort.ToLower().StartsWith("governmentname")) sortConditions[0].PropertyName = "Government";

            //高级搜索参数设置
            PropertyAdvanceConditionRequest request = PrepareAdvanceCondition(advance);
            var governmentIds = _governmentService.GetGovernmentIdsByCurrentUser();  //获取当前账户的可查询的资产
            var properties = _propertyService.GetAllProperties(governmentIds, advance.Query, 0, int.MaxValue, showHidden, request, sortConditions);

            var response = new ListResponse<GeoPropertyModel>
            {
                Time = advance.Time,
                Paging = new Paging
                {
                    PageIndex = 0,
                    PageSize = int.MaxValue,
                    Total = properties.TotalCount,
                    FilterCount = string.IsNullOrEmpty(advance.Query) ? properties.TotalCount : properties.Count,
                },
                Data = properties.Select(s =>
                {
                    var geoPropertyModel = s.ToGeoModel();
                    if (!s.Published) geoPropertyModel.Name += "（未发布）";
                    else if (!s.Off) geoPropertyModel.Name += "（已核销）";
                    return geoPropertyModel;
                })
            };

            //activity log
            _accountUserActivityService.InsertActivity("GetpropertyList", "获取资产列表信息");

            return Ok(response);
        }

        /// <summary>
        /// 获取地图大数据
        /// </summary>
        /// <returns></returns>
        [HttpGet]
        [Route("geo/bigdata")]
        public IHttpActionResult GetMapBigData()
        {
            var currentUser = _workContext.CurrentAccountUser;
            var showHidden = currentUser.IsRegistered() && currentUser.AccountUserRoles.Count == 1;
            var governmentIds = _governmentService.GetGovernmentIdsByCurrentUser();
            var properties = _propertyService.GetAllProperties(governmentIds, showHidden);

            var mapProperties = properties.ToList().Select(p => { return p.ToGeoModel(); });

            //activity log
            _accountUserActivityService.InsertActivity("GetGeopropertyList", "地图获取资产列表信息");

            return Ok(mapProperties);
        }

        /// <summary>
        /// 搜索联想提示
        /// </summary>
        /// <param name="query"></param>
        /// <param name="pageSize"></param>
        /// <param name="showHidden"></param>
        /// <returns></returns>
        [HttpGet]
        [Route("geo/suggestion")]
        public IHttpActionResult Suggestion(string query = "",long time=0, int pageSize = 10, bool showHidden = false)
        {
            var currentUser = _workContext.CurrentAccountUser;

            var governmentIds = _governmentService.GetGovernmentIdsByCurrentUser();

            var properties = _propertyService.GetAllProperties(governmentIds, query, 0, pageSize, false);

            var response = new ListResponse<GeoPropertyModel>
            {
                Time = time,
                Paging = new Paging
                {
                    PageIndex = 0,
                    PageSize = int.MaxValue,
                    Total = properties.TotalCount,
                    FilterCount = properties.TotalCount,
                },
                Data = properties.Select(s =>
                {
                    return s.ToGeoModel();
                })
            };

            //activity log
            _accountUserActivityService.InsertActivity("PropertySuggestion", "资产信息关键字联想");

            return Ok(response);
        }

        /// <summary>
        /// 新增资产
        /// </summary>
        /// <param name="propertyModel"></param>
        /// <returns></returns>
        [HttpPost]
        [Route("Create")]
        public IHttpActionResult Create(PropertyCreateModel propertyCreateModel)
        {
            var checkMessage = PropertyCreateModelValid(propertyCreateModel);

            if (!string.IsNullOrEmpty(checkMessage)) return BadRequest(checkMessage);
           
            var property = propertyCreateModel.ToEntity();

         

            PrepareProperty(property, propertyCreateModel);
          
            _propertyService.InsertProperty(property);

            //activity log
            _accountUserActivityService.InsertActivity("AddNewproperty", "增加 名为 {0} 的资产", property.Name);

            #region 封面照片处理
            //保存图片
            var base64 = HttpUtility.HtmlDecode(propertyCreateModel.Logo.Trim());
            var picture = _pictureService.InsertPicture(base64);

            //关联
            var logoPicture = new PropertyPicture
            {
                IsLogo = true,
                Picture = picture,
                Property = property,
                DisplayOrder = 0
            };

            _propertyService.InsertPropertyPicture(logoPicture);
            //activity log
            _accountUserActivityService.InsertActivity("AddPropertyLogo", "增加 资产名为 {0} 的封面照片", property.Name);
            #endregion

            #region 附件处理

            //图片更新
            SavePropertyPictures(property, propertyCreateModel.Pictures);

            //文件更新
            SavePropertyFiles(property, propertyCreateModel.Files);

            #endregion

            //添加一个资产插入申请
            var propertyNewRecord = new PropertyNewCreate()
            {
                Property = property,
                Title = property.Name,
                State = propertyCreateModel.Submit ? PropertyApproveState.DepartmentApprove : PropertyApproveState.Start,
                ProcessDate = DateTime.Now,
                SuggestGovernmentId = _workContext.CurrentAccountUser.Government.Id
            };

            //如果当前用户是主管部门，则跳过主管部门审核环节
            if (propertyCreateModel.Submit && _workContext.CurrentAccountUser.Government.ParentGovernmentId == 0)
            {
                propertyNewRecord.State = PropertyApproveState.AdminApprove;
                propertyNewRecord.DSuggestion = "同意";
                propertyNewRecord.DApproveDate = DateTime.Now;
            }

            _propertyNewCreateService.InsertPropertyNewCreate(propertyNewRecord);

            //activity log
            _accountUserActivityService.InsertActivity("AddNewproperty", "增加 名为 {0} 的资产创建申请", property.Name);

            SwitchPropertyLockState(true, property);

            return Ok(property.ToModel());
        }

        public void PrepareCreateProperty(PropertyCreateModel property)
        {


        }


        /// <summary>
        /// 更新资产
        /// </summary>
        /// <param name="propertyModel"></param>
        /// <returns></returns>
        [HttpPut]
        [Route("{propertyId:int}")]
        public IHttpActionResult UpdateProperty(int propertyId, PropertyCreateModel propertyCreateModel)
        {
            var property = _propertyService.GetPropertyById(propertyId);

            if ((propertyCreateModel.CurrentUse_Lend + propertyCreateModel.CurrentUse_Rent + propertyCreateModel.CurrentUse_Self + propertyCreateModel.CurrentUse_Idle > propertyCreateModel.ConstructArea)) return BadRequest("建筑面积应大于自用、出租、出借、闲置之和！");

            if (property == null || property.Deleted) return NotFound();

            var checkMessage = PropertyCreateModelValid(propertyCreateModel);

            if (!string.IsNullOrEmpty(checkMessage)) return BadRequest(checkMessage);

            Picture logoPicture = null;
            if (!string.IsNullOrEmpty(propertyCreateModel.Logo))  //上传的logo 不为空则表明新增了一个logo图片
            {
                var base64 = HttpUtility.HtmlDecode(propertyCreateModel.Logo.Trim());
                logoPicture = _pictureService.InsertPicture(base64);
            }

            if (property.Published)
            {                
                if(PropertyCanChange(property))
                {
                    var startEditsCount = _propertyEditService.GetPropertyEditByPropertyId(propertyId).Count(e => e.State == PropertyApproveState.Start);
                    if (startEditsCount == 0)
                    {
                        if (property.Locked) return BadRequest("资产已被锁定，无法进行其他操作");

                        #region 新增的变更

                        //添加到资产复制表
                        CopyProperty copy = propertyCreateModel.ToCopyEntity();

                        //copyproperty赋值处理
                        copy = CopyPropertyChange(copy, propertyCreateModel, property, logoPicture);
                        copy.Government_Id = propertyCreateModel.GovernmentId;
                        _copyPropertyService.InsertCopyProperty(copy);
                        //activity log
                        _accountUserActivityService.InsertActivity("AddCopyProperty", "增加 名为 {0} 的资产的副本信息", property.Name);

                        //添加一个资产编辑申请
                        var propertyEdit = new PropertyEdit()
                        {
                            Property = property,
                            Title = property.Name,
                            State = propertyCreateModel.Submit ? PropertyApproveState.DepartmentApprove : PropertyApproveState.Start,
                            ProcessDate = DateTime.Now,
                            SuggestGovernmentId = _workContext.CurrentAccountUser.Government.Id
                        };

                        propertyEdit.CopyProperty_Id = copy.Id;
                        //如果当前用户是主管部门，则跳过主管部门审核环节
                        if (propertyCreateModel.Submit && _workContext.CurrentAccountUser.Government.ParentGovernmentId == 0)
                        {
                            propertyEdit.State = PropertyApproveState.AdminApprove;
                            propertyEdit.DSuggestion = "同意";
                            propertyEdit.DApproveDate = DateTime.Now;
                        }

                        _propertyEditService.InsertPropertyEdit(propertyEdit);

                        SwitchPropertyLockState(true, property);

                        return Ok(copy);  //返回copy对象
                        #endregion
                    }
                    else if (startEditsCount == 1)
                    {
                        #region 已有变更编辑
                        var edit = _propertyEditService.GetPropertyEditByPropertyId(propertyId).Where(e => e.State == PropertyApproveState.Start).SingleOrDefault();
                        if (edit.State == PropertyApproveState.Start)
                        {
                            var copy = _copyPropertyService.GetCopyPropertyById(edit.CopyProperty_Id);

                            copy = propertyCreateModel.ToEntity(copy);

                            copy = CopyPropertyChange(copy, propertyCreateModel, property, logoPicture);
                            copy.Government_Id = propertyCreateModel.GovernmentId;
                            _copyPropertyService.UpdateCopyProperty(copy);

                            if (propertyCreateModel.Submit) edit.State = PropertyApproveState.DepartmentApprove;

                            //如果当前用户是主管部门，则跳过主管部门审核环节
                            if (propertyCreateModel.Submit && _workContext.CurrentAccountUser.Government.ParentGovernmentId == 0)
                            {
                                edit.State = PropertyApproveState.AdminApprove;
                                edit.DSuggestion = "同意";
                                edit.DApproveDate = DateTime.Now;
                            }

                            _propertyEditService.UpdatePropertyEdit(edit);

                            SwitchPropertyLockState(true, property);
                            return Ok(copy);
                        }
                        #endregion
                    }
                }

                return BadRequest("该资产已经在进行编辑申请中，请将其执行完成后再申请！");
            }
            else {
                #region 数据编辑

                if (!PropertyCanEditDelete(property)) return BadRequest("无法编辑资产");

                var imgs = property.Pictures;
                property = propertyCreateModel.ToEntity(property);
                PrepareProperty(property, propertyCreateModel);

                #region 封面照片处理
                var logoPropertyPicture = property.Pictures.Where(p => p.IsLogo).SingleOrDefault();
                if (logoPropertyPicture == null)
                {
                    //关联
                    logoPropertyPicture = new PropertyPicture
                    {
                        IsLogo = true,
                        Picture = logoPicture,
                        Property = property,
                        DisplayOrder = 0
                    };

                    _propertyService.InsertPropertyPicture(logoPropertyPicture);
                }
                else
                {
                    if (logoPicture != null && logoPicture.Id != logoPropertyPicture.PictureId)
                    {
                        logoPropertyPicture.Picture = logoPicture;
                        _propertyService.UpdatePropertyPicture(logoPropertyPicture);
                    }
                }

                #endregion

                //图片更新
                SavePropertyPictures(property, propertyCreateModel.Pictures);

                //文件更新
                SavePropertyFiles(property, propertyCreateModel.Files);

                //保存资产
                _propertyService.UpdateProperty(property);

                //activity log
                _accountUserActivityService.InsertActivity("Updateproperty", "更新 名为 {0} 的资产的基本信息", property.Name);

                //获取相应的资产插入申请
                var propertyNewRecord = _propertyNewCreateService.GetPropertyNewCreateByPropertyId(property.Id);

                if (propertyCreateModel.Submit)
                {
                    propertyNewRecord.State = PropertyApproveState.DepartmentApprove;

                    //如果当前用户是主管部门，则跳过主管部门审核环节
                    if (_workContext.CurrentAccountUser.Government.ParentGovernmentId == 0)
                    {
                        propertyNewRecord.State = PropertyApproveState.AdminApprove;
                        propertyNewRecord.DSuggestion = "同意";
                        propertyNewRecord.DApproveDate = DateTime.Now;
                    }

                    _propertyNewCreateService.UpdatePropertyNewCreate(propertyNewRecord);

                    //activity log
                    _accountUserActivityService.InsertActivity("AddNewproperty", "增加 名为 {0} 的资产创建申请", property.Name);

                    SwitchPropertyLockState(true, property);
                }          

                return Ok(property.ToModel());
                #endregion
            }     
        }

        [HttpDelete]
        [Route("{propertyId:int}")]
        public IHttpActionResult DeleteProperty(int propertyId)
        {

            var property = _propertyService.GetPropertyById(propertyId);
            if (property == null || property.Deleted) return NotFound();

            _propertyService.DeleteProperty(property);

            //activity log
            _accountUserActivityService.InsertActivity("Deleteproperty", "删除 名为 {0} 的资产", property.Name);

            var newCreate = property.PropertyNewCreate;
            if(newCreate==null) newCreate = _propertyNewCreateService.GetPropertyNewCreateByPropertyId(property.Id);
            _propertyNewCreateService.DeletePropertyNewCreate(newCreate);            

            //通知
            //SuccessNotification(_localizationService.GetResource("Admin.Catalog.Categories.Deleted"));

            return Ok();
        }

        /// <summary>
        /// 批量删除
        /// </summary>
        /// <param name="propertyIdString"></param>
        /// <returns></returns>
        [HttpDelete]
        [Route("{propertyIdString}")]
        public IHttpActionResult Deleteproperty(string propertyIdString)
        {
            var idStringArr = propertyIdString.Split('_');
            foreach (var idStr in idStringArr)
            {
                int id = 0;
                if (!int.TryParse(idStr, out id)) continue;

                var property = _propertyService.GetPropertyById(id);
                if (property == null) continue;

                _propertyService.DeleteProperty(property);

                var newCreate = property.PropertyNewCreate;
                _propertyNewCreateService.DeletePropertyNewCreate(newCreate);
            }

            //活动日志
            _accountUserActivityService.InsertActivity("Deletepropertys", "批量删除 Id为 {0} 的资产", propertyIdString);
           
            //通知
            //SuccessNotification(_localizationService.GetResource("Admin.Catalog.Categories.Deleted"));

            return Ok();
        }


        [HttpGet]
        [Route("Governments/{governmentId}")]
        public IHttpActionResult GetPropertiesByGovernment(int governmentId, bool loadChildren = true)
        {
            var governmentIdList = new List<int>();

            if(loadChildren)
            {
                var childrenGovernments = _governmentService.GetGovernmentIdsByParentId(governmentId);
                governmentIdList.AddRange(childrenGovernments);
            }

            governmentIdList.Add(governmentId);

            var properties = _propertyService.GetPropertiesByGovernmentId(governmentIdList).ToList().Select(p =>
            {
                return new SimplePropertyModel
                {
                    Id = p.Id,
                    Name = p.Name,
                    GovernmentName = p.Government.Name
                };
            });

            return Ok(properties);
        }
        #endregion

        #region 资产处置

        [AllowAnonymous]
        [HttpGet]
        [Route("PropertyProcess")]
        public IHttpActionResult GetPropertyProcess() {

            var currentAccount = _workContext.CurrentAccountUser;
            var governmentIds = _governmentService.GetGovernmentIdsByCurrentUser(true);
           
            var properties = _propertyService.GetProcessProperties(governmentIds).Select(sp => {
                return new
                {
                    Id = sp.Id,
                    Name = sp.Name,
                    Region = sp.Region.ToDescription(),
                    Address = sp.Address,
                    G = sp.Government.Name,
                    constructArea = sp.ConstructArea,
                    landArea = sp.LandArea,
                    propertyType = sp.PropertyNature,
                    price = sp.Price,
                    lifeTime = sp.LifeTime
                };

                //return simplePropertyModel;
            });

            return Ok(properties);
        }
   

        [HttpGet]
        [Route("Process/Records")]
        public IHttpActionResult GetAllApproveRecords(string approveType = "newCreate",string checkState = "", 
            string query = "", string sort = "", int pageSize = Int32.MaxValue, int pageIndex = 0, long time = 0)
        {
            var currentUser = _workContext.CurrentAccountUser;          
            var government = currentUser.Government;

            IList<int> targetGovIds = new List<int>();

            if (currentUser.IsGovAuditor())
            {
                targetGovIds = _governmentService.GetAllGovernmentUnitsByType(
                    new GovernmentType[2] { GovernmentType.Government, GovernmentType.Institution }).Select(g => g.Id).ToList();
            }
            else if (currentUser.IsStateOwnerAuditor())
            {
                targetGovIds = _governmentService.GetAllGovernmentUnitsByType(
                    new GovernmentType[1] { GovernmentType.Company }).Select(g => g.Id).ToList();
            }
            else
            {
                targetGovIds = _governmentService.GetGovernmentIdsByParentId(government.Id, false);
                if (!targetGovIds.Contains(currentUser.Government.Id)) targetGovIds.Add(currentUser.Government.Id);
            }

            //初始化排序条件
            var sortConditions = PropertySortCondition.Instance(sort);

            switch (approveType)
            {
                case "newCreate":
                    {
                        #region 获取新增审批记录
                        var allRecords = _propertyNewCreateService.GetAllNewCreateRecords(targetGovIds, checkState, query, pageIndex,
                    pageSize, sortConditions);
                        var response = new ListResponse<PropertyNewCreateApproveListModel>
                        {
                            Time = time,
                            Paging = new Paging
                            {
                                PageIndex = pageIndex,
                                PageSize = pageSize,
                                Total = allRecords.TotalCount,
                                FilterCount = string.IsNullOrEmpty(query) ? allRecords.TotalCount : allRecords.Count,
                            },
                            Data = allRecords.Select(pcr =>
                            {
                                var pcrl = pcr.ToListModel();
                                pcrl.ApproveType = approveType;
                                pcrl.CanApprove = PropertyCanApprove(pcr.State, pcr.SuggestGovernmentId);

                                pcrl.CanEditAndDelete = PropertyApproveCanEditDeleteAndSubmit(pcr.State, pcr.SuggestGovernmentId);

                                return pcrl;
                            })
                        };
                      
                        if (currentUser.IsGovAuditor())
                        {
                         
                        }

                        //activity log
                        _accountUserActivityService.InsertActivity("GetAllNewCreateRecords", "获取相关资产新增审批列表信息");

                        return Ok(response);
                        #endregion
                    }
                case "edit":
                    {
                        #region 获取变跟审批记录
                        var allRecords = _propertyEditService.GetAllEditRecords(targetGovIds, checkState, query, pageIndex,
                    pageSize, sortConditions);
                        var response = new ListResponse<PropertyEditApproveListModel>
                        {
                            Time = time,
                            Paging = new Paging
                            {
                                PageIndex = pageIndex,
                                PageSize = pageSize,
                                Total = allRecords.TotalCount,
                                FilterCount = string.IsNullOrEmpty(query) ? allRecords.TotalCount : allRecords.Count,
                            },
                            Data = allRecords.Select(pcr =>
                            {
                                var pcrl = pcr.ToListModel();
                                pcrl.Property_Id = pcr.Property.Id;
                                pcrl.ApproveType = approveType;
                                pcrl.CanApprove = PropertyCanApprove(pcr.State, pcr.SuggestGovernmentId);

                                pcrl.CanEditAndDelete = PropertyApproveCanEditDeleteAndSubmit(pcr.State, pcr.SuggestGovernmentId);

                                return pcrl;
                            })
                        };

                        //activity log
                        _accountUserActivityService.InsertActivity("GetAllNewCreateRecords", "获取相关资产新增审批列表信息");

                        return Ok(response);
                        #endregion
                    }
                case "lend":
                    {
                        #region 获取出借审批记录
                        var allRecords = _propertyLendService.GetAllLendRecords(targetGovIds, checkState, query, pageIndex,
                    pageSize, sortConditions);
                        var response = new ListResponse<PropertyLendApproveListModel>
                        {
                            Time = time,
                            Paging = new Paging
                            {
                                PageIndex = pageIndex,
                                PageSize = pageSize,
                                Total = allRecords.TotalCount,
                                FilterCount = string.IsNullOrEmpty(query) ? allRecords.TotalCount : allRecords.Count,
                            },
                            Data = allRecords.Select(pcr =>
                            {
                                var pcrl = pcr.ToListModel();
                                pcrl.Property_Id = pcr.Property.Id;
                                pcrl.ApproveType = approveType;
                                
                                pcrl.CanApprove = PropertyCanApprove(pcr.State, pcr.SuggestGovernmentId);

                                pcrl.CanEditAndDelete = PropertyApproveCanEditDeleteAndSubmit(pcr.State, pcr.SuggestGovernmentId);

                                return pcrl;
                            })
                        };

                        //activity log
                        _accountUserActivityService.InsertActivity("GetAllLendRecords", "获取相关资产出借审批列表信息");

                        return Ok(response);
                        #endregion
                    }
                case "rent":
                    {
                        #region 获取出租审批记录
                        var allRecords = _propertyRentService.GetAllRentRecords(targetGovIds, checkState, query, pageIndex,
                    pageSize, sortConditions);
                        var response = new ListResponse<PropertyRentApproveListModel>
                        {
                            Time = time,
                            Paging = new Paging
                            {
                                PageIndex = pageIndex,
                                PageSize = pageSize,
                                Total = allRecords.TotalCount,
                                FilterCount = string.IsNullOrEmpty(query) ? allRecords.TotalCount : allRecords.Count,
                            },
                            Data = allRecords.Select(pcr =>
                            {
                                var pcrl = pcr.ToListModel();

                                pcrl.RentTime = pcr.RentTime.ToString("yyyy/MM/dd") +" - "+pcr.BackTime.ToString("yyyy/MM/dd");
                                pcrl.PriceString = "";
                                var priceList = pcr.PriceString.Split(';');
                                var index = 1;
                                foreach(var price in priceList)
                                {
                                    if (index > 2) {
                                        pcrl.PriceString += "...";
                                        break;
                                    }
                                    pcrl.PriceString += string.Format("第{0}年租金{1}元;", index, price);
                                    index++;
                                }

                                pcrl.Property_Id = pcr.Property.Id;
                                pcrl.ApproveType = approveType;
                                pcrl.CanApprove = PropertyCanApprove(pcr.State, pcr.SuggestGovernmentId);

                                pcrl.CanEditAndDelete = PropertyApproveCanEditDeleteAndSubmit(pcr.State, pcr.SuggestGovernmentId);

                                return pcrl;
                            })
                        };

                        //activity log
                        _accountUserActivityService.InsertActivity("GetAllRentRecords", "获取相关资产出租审批列表信息");

                        return Ok(response);
                        #endregion
                    }
                case "allot":
                    {
                        #region 获取划拨审批记录
                        var allRecords = _propertyAllotService.GetAllAllotRecords(targetGovIds, checkState, query, pageIndex,
                    pageSize, sortConditions);
                        var response = new ListResponse<PropertyAllotApproveListModel>
                        {
                            Time = time,
                            Paging = new Paging
                            {
                                PageIndex = pageIndex,
                                PageSize = pageSize,
                                Total = allRecords.TotalCount,
                                FilterCount = string.IsNullOrEmpty(query) ? allRecords.TotalCount : allRecords.Count,
                            },
                            Data = allRecords.Select(pcr =>
                            {
                                var pcrl = pcr.ToListModel();
                                pcrl.Property_Id = pcr.Property.Id;

                                pcrl.ApproveType = approveType;
                                pcrl.CanApprove = PropertyCanApprove(pcr.State, pcr.SuggestGovernmentId);

                                pcrl.CanEditAndDelete = PropertyApproveCanEditDeleteAndSubmit(pcr.State, pcr.SuggestGovernmentId);

                                return pcrl;
                            })
                        };

                        //activity log
                        _accountUserActivityService.InsertActivity("GetAllAllotRecords", "获取相关资产划拨审批列表信息");

                        return Ok(response);
                        #endregion
                    }
                case "off":
                    {
                        #region 获取核销审批记录
                        var allRecords = _propertyOffService.GetAllOffRecords(targetGovIds, checkState, query, pageIndex,
                     pageSize, sortConditions);
                        var response = new ListResponse<PropertyOffApproveListModel>
                        {
                            Time = time,
                            Paging = new Paging
                            {
                                PageIndex = pageIndex,
                                PageSize = pageSize,
                                Total = allRecords.TotalCount,
                                FilterCount = string.IsNullOrEmpty(query) ? allRecords.TotalCount : allRecords.Count,
                            },
                            Data = allRecords.Select(pcr =>
                            {
                                var pcrl = pcr.ToListModel();
                                pcrl.Property_Id = pcr.Property.Id;

                                pcrl.ApproveType = approveType;
                                pcrl.CanApprove = PropertyCanApprove(pcr.State, pcr.SuggestGovernmentId);

                                pcrl.CanEditAndDelete = PropertyApproveCanEditDeleteAndSubmit(pcr.State, pcr.SuggestGovernmentId);

                                return pcrl;
                            })
                        };

                        //activity log
                        _accountUserActivityService.InsertActivity("GetAllOffRecords", "获取相关资产核销审批列表信息");

                        return Ok(response);
                        #endregion
                    }
                default:
                    return BadRequest("没有找到相应的处置类型");
            }
        }

        [HttpPost]
        [Route("Lend")]   //Url 的动词名称意义直观 修改则为UpdateLend，审批为ApproveLend
        public IHttpActionResult CreateLendRecord(PropertyLendModel propertyLendModel)
        {
            var currentUser = _workContext.CurrentAccountUser;
            var suggestGovernmentId = currentUser.Government.Id;
            if (propertyLendModel.Ids == "") return BadRequest("请选择需要处置的资产");
            var lendIds = propertyLendModel.Ids.Split(';');
            foreach (var id in lendIds) {
                if (id != "") {
                    var property = _propertyService.GetPropertyById(Convert.ToInt32(id));
                    if (property == null) continue;  //防止错误的PropertyId传入
                    if (property.Locked || property.Deleted || !property.Published)
                        return BadRequest("无法对该资产进行操作或该资产已经不存在");

                    if (!PropertyBelongCurrentUser(property, true)) return BadRequest("没有操作权限");

                    PropertyLend propertyLendRecord = new PropertyLend();
                    propertyLendRecord.Name = propertyLendModel.Name;
                    propertyLendRecord.Title = property.Name;
                    propertyLendRecord.LendArea = propertyLendModel.LendArea;
                    propertyLendRecord.LendTime = Convert.ToDateTime(propertyLendModel.LendTime);
                    propertyLendRecord.BackTime = DateTime.MaxValue;// Convert.ToDateTime(propertyLendModel.BackTime);
                    propertyLendRecord.Property = property;
                    propertyLendRecord.State = propertyLendModel.Submit ? PropertyApproveState.DepartmentApprove : PropertyApproveState.Start;
                 
                    propertyLendRecord.ProcessDate = DateTime.Now;
                    propertyLendRecord.SuggestGovernmentId = suggestGovernmentId;
               
                    //如果当前用户是主管部门，则跳过主管部门审核环节
                    if (propertyLendModel.Submit && _workContext.CurrentAccountUser.IsParentGovernmentorAuditor())
                    {
                        propertyLendRecord.State = PropertyApproveState.AdminApprove;
                        propertyLendRecord.DSuggestion = "同意";
                        propertyLendRecord.DApproveDate = DateTime.Now;
                    }

                    _propertyLendService.InsertPropertyLend(propertyLendRecord);
                    //activity log
                    _accountUserActivityService.InsertActivity("AddNewpropertyLendRecord", "增加 名为 {0} 的资产出借申请", property.Name);

                    #region 附件处理

                    //图片更新
                    SavePropertyLendPictures(propertyLendRecord, propertyLendModel.LendPictures);

                    //文件更新
                    SavePropertyLendFiles(propertyLendRecord, propertyLendModel.LendFiles);

                    _propertyLendService.UpdatePropertyLend(propertyLendRecord);

                    #endregion

                    SwitchPropertyLockState(propertyLendModel.Submit, property);
                }             
            }

            return Ok();
        }

        [HttpPost]
        [Route("Rent")]
        public IHttpActionResult CreateRentRecord(PropertyRentModel propertyRentModel)
        {
            if (propertyRentModel.Ids == "") return BadRequest("请选择需要处置的资产");
            var RentIds = propertyRentModel.Ids.Split(';');
            var currentUser = _workContext.CurrentAccountUser;
            foreach (var id in RentIds)
            {
                if (id != "")
                {
                    var property = _propertyService.GetPropertyById(Convert.ToInt32(id));
                    if (property == null) continue;  //防止错误的PropertyId传入
                    if (property.Locked || property.Deleted || !property.Published)
                        return BadRequest("无法对该资产进行操作或该资产已经不存在");

                    if (!PropertyBelongCurrentUser(property, true)) return BadRequest("没有操作权限");

                    PropertyRent rent = new PropertyRent();
                    rent.Name = propertyRentModel.Name;
                    rent.Title = property.Name;
                    rent.RentArea = propertyRentModel.RentArea;
                    rent.RentMonth = propertyRentModel.RentMonth;
                    if (propertyRentModel.PriceString.EndsWith(";")) rent.PriceString = propertyRentModel.PriceString.TrimEnd(';');
                    rent.RentPrice = propertyRentModel.RentPrice;
                    rent.RentTime = Convert.ToDateTime(propertyRentModel.RentTime);
                    rent.BackTime = Convert.ToDateTime(propertyRentModel.BackTime);
                    rent.Property = property;
                    rent.State = propertyRentModel.Submit ? PropertyApproveState.DepartmentApprove : PropertyApproveState.Start;
                    rent.ProcessDate = DateTime.Now;
                    rent.SuggestGovernmentId = currentUser.Government.Id;

                    //如果当前用户是主管部门，则跳过主管部门审核环节
                    if (propertyRentModel.Submit && _workContext.CurrentAccountUser.IsParentGovernmentorAuditor())
                    {
                        rent.State = PropertyApproveState.AdminApprove;
                        rent.DSuggestion = "同意";
                        rent.DApproveDate = DateTime.Now;
                    }

                    _propertyRentService.InsertPropertyRent(rent);
                    _accountUserActivityService.InsertActivity("AddNewpropertyLendRecord", "增加 名为 {0} 的资产出借申请", property.Name);

                    #region 附件处理

                    //图片更新
                    SavePropertyRentPictures(rent, propertyRentModel.RentPictures);

                    //文件更新
                    SavePropertyRentFiles(rent, propertyRentModel.RentFiles);
                    _propertyRentService.UpdatePropertyRent(rent);
                    #endregion

                    SwitchPropertyLockState(true, property);

                }

            }

            return Ok();
        }

        [HttpPost]
        [Route("Allot")]
        public IHttpActionResult CreateAllotRecord(PropertyAllotModel propertyAllotModel)
        {
            if (propertyAllotModel.Ids == "") return BadRequest("请选择需要处置的资产");
            var AllotIds = propertyAllotModel.Ids.Split(';');
            var currentUser = _workContext.CurrentAccountUser;
            var prePropertyOwner = currentUser.Government.Name;
            foreach (var id in AllotIds)
            {
                if (id != "")
                {
                    var property = _propertyService.GetPropertyById(Convert.ToInt32(id));
                 
                    if (property == null) continue;  //防止错误的PropertyId传入
                    if (property.Locked || property.Deleted || !property.Published)
                        return BadRequest("无法对该资产进行操作或该资产已经不存在");

                    if (!PropertyBelongCurrentUser(property, true)) return BadRequest("没有操作权限");

                    var nowGovernmentOwner = _governmentService.GetGovernmentUnitByName(propertyAllotModel.NowPropertyOwner).Name;
                    if (nowGovernmentOwner == null) return BadRequest("目标产权单位无效");

                    PropertyAllot allot = new PropertyAllot();
                    allot.PrePropertyOwner = prePropertyOwner;
                    allot.NowPropertyOwner = propertyAllotModel.NowPropertyOwner;
                    allot.NowGovernmentId = _governmentService.GetGovernmentUnitByName(propertyAllotModel.NowPropertyOwner).Id;
                    allot.Title = property.Name;
                    allot.AllotTime =Convert.ToDateTime( propertyAllotModel.AllotTime);
                    allot.Property = property;
                    allot.State = propertyAllotModel.Submit ? PropertyApproveState.DepartmentApprove : PropertyApproveState.Start;
                    allot.ProcessDate = DateTime.Now;
                    allot.SuggestGovernmentId = currentUser.Government.Id;

                    //如果当前用户是主管部门，则跳过主管部门审核环节
                    if (propertyAllotModel.Submit && _workContext.CurrentAccountUser.IsParentGovernmentorAuditor())
                    {
                        allot.State = PropertyApproveState.AdminApprove;
                        allot.DSuggestion = "同意";
                        allot.DApproveDate = DateTime.Now;
                    }

                    _propertyAllotService.InsertPropertyAllot(allot);
                    _accountUserActivityService.InsertActivity("AddNewpropertyLendRecord", "增加 名为 {0} 的资产出借申请", property.Name);


                    SavePropertyAllotPictures(allot, propertyAllotModel.AllotPictures);
                    SavePropertyAllotFiles(allot, propertyAllotModel.AllotFiles);

                    _propertyAllotService.UpdatePropertyAllot(allot);

                    SwitchPropertyLockState(true, property);
                }
            }

            return Ok();
        }

        [HttpPost]
        [Route("Off")]
        public IHttpActionResult CreateOffRecord(PropertyOffModel propertyOffModel)
        {
            if (propertyOffModel.Ids == "") return BadRequest("请选择需要处置的资产");
            var OffIds = propertyOffModel.Ids.Split(';');
            var currentUser = _workContext.CurrentAccountUser;
            var sid = currentUser.Government.Id;
            foreach (var id in OffIds)
            {
                if (id != "")
                {
                    var property = _propertyService.GetPropertyById(Convert.ToInt32(id));

                    if (property == null) continue;  //防止错误的PropertyId传入
                    if (property.Locked || property.Deleted || !property.Published)
                        return BadRequest("无法对该资产进行操作或该资产已经不存在");

                    if (!PropertyBelongCurrentUser(property, true)) return BadRequest("没有操作权限");

                    PropertyOff off = new PropertyOff();
                    off.Reason = propertyOffModel.Reason;
                    off.OffTime = Convert.ToDateTime(propertyOffModel.OffTime);
                    off.Price = propertyOffModel.Price;
                    off.Title = property.Name;
                    off.Property = property;
                    
                    off.SuggestGovernmentId = sid;
                    off.State = propertyOffModel.Submit ? PropertyApproveState.DepartmentApprove : PropertyApproveState.Start;
                    off.ProcessDate = DateTime.Now;
                    switch (propertyOffModel.OffType) {
                        case "0":
                            off.OffType = OffType.Auction;
                            break;
                        case "1":
                            off.OffType = OffType.Remove;
                            break;
                        case "2":
                            off.OffType = OffType.Storeup;
                            break;
                    }



                    //如果当前用户是主管部门，则跳过主管部门审核环节
                    if (propertyOffModel.Submit && _workContext.CurrentAccountUser.IsParentGovernmentorAuditor())
                    {
                        off.State = PropertyApproveState.AdminApprove;
                        off.DSuggestion = "同意";
                        off.DApproveDate = DateTime.Now;
                    }

                    _propertyOffService.InsertPropertyOff(off);
                    _accountUserActivityService.InsertActivity("AddNewpropertyLendRecord", "增加 名为 {0} 的资产出借申请", property.Name);

                    #region 附件处理

                    //图片更新
                    SavePropertyOffPictures(off, propertyOffModel.OffPictures);

                    //文件更新
                    SavePropertyOffFiles(off, propertyOffModel.OffFiles);

                    _propertyOffService.UpdatePropertyOff(off);
                    #endregion

                    SwitchPropertyLockState(true, property);
                }
            }

            return Ok();
        }

        [HttpPut]
        [Route("UpdateLend/{id}")]   
        public IHttpActionResult UpdateLendRecord(int id,PropertyLendModel propertyLendModel)
        {
            var currentUser = _workContext.CurrentAccountUser;
            var lend = _propertyLendService.GetPropertyLendById(id);
            
            if (!PropertyApproveCanEditDeleteAndSubmit(lend.State, lend.SuggestGovernmentId)) return BadRequest("该项目已无法编辑");

            lend = propertyLendModel.ToEntity(lend);

            #region 附件处理

            //图片更新
            SavePropertyLendPictures(lend, propertyLendModel.LendPictures);

            //文件更新
            SavePropertyLendFiles(lend, propertyLendModel.LendFiles);

            #endregion


            if (propertyLendModel.Submit)
            {
                lend.State = PropertyApproveState.DepartmentApprove;

                //如果当前用户是主管部门，则跳过主管部门审核环节
                if (currentUser.IsParentGovernmentorAuditor())
                {
                    lend.State = PropertyApproveState.AdminApprove;
                    lend.DSuggestion = "同意";
                    lend.DApproveDate = DateTime.Now;
                }
            }

                _propertyLendService.UpdatePropertyLend(lend);

            SwitchPropertyLockState(true , lend.Property);  //锁定资产

            return Ok();
        }

        [HttpPut]
        [Route("UpdateRent/{id}")]
        public IHttpActionResult UpdateRentRecord(int id,PropertyRentModel propertyRentModel)
        {

            var currentUser = _workContext.CurrentAccountUser;
            var rent = _propertyRentService.GetPropertyRentById(id);
            if (!PropertyApproveCanEditDeleteAndSubmit(rent.State, rent.SuggestGovernmentId)) return BadRequest("该项目已无法编辑");

              rent = propertyRentModel.ToEntity(rent);
         

            #region 附件处理

            //图片更新
            SavePropertyRentPictures(rent, propertyRentModel.RentPictures);

            //文件更新
            SavePropertyRentFiles(rent, propertyRentModel.RentFiles);

            #endregion

            if (propertyRentModel.Submit)
            {
                rent.State = PropertyApproveState.DepartmentApprove;

                //如果当前用户是主管部门，则跳过主管部门审核环节
                if (currentUser.IsParentGovernmentorAuditor())
                {
                    rent.State = PropertyApproveState.AdminApprove;
                    rent.DSuggestion = "同意";
                    rent.DApproveDate = DateTime.Now;
                }
            }
            else {
                rent.State = PropertyApproveState.Start;
            }

        _propertyRentService.UpdatePropertyRent(rent);

            SwitchPropertyLockState(true, rent.Property);

            return Ok();
        }

        [HttpPut]
        [Route("UpdateAllot/{id}")]
        public IHttpActionResult UpdateAllotRecord(int id,PropertyAllotModel propertyAllotModel)
        {
            var currentUser = _workContext.CurrentAccountUser;
            var allot = _propertyAllotService.GetPropertyAllotById(id);
            if (!PropertyApproveCanEditDeleteAndSubmit(allot.State, allot.SuggestGovernmentId)) return BadRequest("该项目已无法编辑");
            allot = propertyAllotModel.ToEntity(allot);
            allot.NowGovernmentId = _governmentService.GetGovernmentUnitByName(propertyAllotModel.NowPropertyOwner).Id;
            SavePropertyAllotPictures(allot, propertyAllotModel.AllotPictures);
            SavePropertyAllotFiles(allot, propertyAllotModel.AllotFiles);

            if (propertyAllotModel.Submit)
            {
                allot.State = PropertyApproveState.DepartmentApprove;

                //如果当前用户是主管部门，则跳过主管部门审核环节
                if (currentUser.IsParentGovernmentorAuditor())
                {
                    allot.State = PropertyApproveState.AdminApprove;
                    allot.DSuggestion = "同意";
                    allot.DApproveDate = DateTime.Now;
                }
            }

            else {
                allot.State = PropertyApproveState.Start;
            }

            _propertyAllotService.UpdatePropertyAllot(allot);

            SwitchPropertyLockState(true, allot.Property);

            return Ok();
        }

        [HttpPut]
        [Route("UpdateOff/{id}")]
        public IHttpActionResult UpdateOffRecord(int id,PropertyOffModel propertyOffModel)
        {
            var currentUser = _workContext.CurrentAccountUser;
            var off = _propertyOffService.GetPropertyOffById(id);

            if (!PropertyApproveCanEditDeleteAndSubmit(off.State, off.SuggestGovernmentId)) return BadRequest("该项目已无法编辑");
            off = propertyOffModel.ToEntity(off);
            switch (propertyOffModel.OffType)
            {
                case "0":
                    off.OffType = OffType.Auction;
                    break;
                case "1":
                    off.OffType = OffType.Remove;
                    break;
                case "2":
                    off.OffType = OffType.Storeup;
                    break;
            }

            #region 附件处理

            //图片更新
            SavePropertyOffPictures(off, propertyOffModel.OffPictures);

            //文件更新
            SavePropertyOffFiles(off, propertyOffModel.OffFiles);

            #endregion

            if (propertyOffModel.Submit)
            {
                off.State = PropertyApproveState.DepartmentApprove;

                //如果当前用户是主管部门，则跳过主管部门审核环节
                if (currentUser.IsParentGovernmentorAuditor())
                {
                    off.State = PropertyApproveState.AdminApprove;
                    off.DSuggestion = "同意";
                    off.DApproveDate = DateTime.Now;
                }
            }

            _propertyOffService.UpdatePropertyOff(off);

            SwitchPropertyLockState(true, off.Property);
            return Ok();
        }

        [HttpGet]
        [Route("NewCreate/{id}")]
        public IHttpActionResult GetNewCreate(int id)
        {
            var currentUser = _workContext.CurrentAccountUser;
            var government = currentUser.Government;

            var newCreate = _propertyNewCreateService.GetPropertyNewCreateById(id);
            if (newCreate == null || newCreate.Deleted) return BadRequest("无法找到资源");

            var property = _propertyService.GetPropertyById(newCreate.Property_Id);

            //if (!PropertyBelongCurrentUser(property, false)) return BadRequest("没有操作权限");

            var response = new PropertyNewCreateApproveModel
            {
                Property = newCreate.Property.ToModel(),
                PropertyNewCreate = newCreate.ToModel(),
                CanApprove = PropertyCanApprove(newCreate.State,newCreate.SuggestGovernmentId),
                CanEditAndDelete = PropertyApproveCanEditDeleteAndSubmit(newCreate.State, newCreate.SuggestGovernmentId),
                LinkMan = newCreate.Property.Government.Person,
                LinkTel = newCreate.Property.Government.Tel
            };

            #region 原数据库对象
            response.Property.LogoUrl = GetLogoUrl(newCreate.Property);
            //获取图片
            PreparePropertyPictures(response.Property);
            //获取文件
            PreparePropertyFiles(response.Property);
            #endregion            
 
            return Ok(response);
        }

        [HttpGet]
        [Route("Edit/{id}")]
        public IHttpActionResult GetEdit(int id)
        {
            var currentUser = _workContext.CurrentAccountUser;
            var government = currentUser.Government;

            var edit = _propertyEditService.GetPropertyEditById(id);
            if (edit == null || edit.Deleted) return BadRequest("无法找到资源");

            var property = _propertyService.GetPropertyById(edit.Property.Id);
            //if (!PropertyBelongCurrentUser(property, false)) return BadRequest("没有操作权限");

            var copyProperty = _copyPropertyService.GetCopyPropertyById(edit.CopyProperty_Id);
            var govermentName = _governmentService.GetGovernmentUnitById(copyProperty.Government_Id).Name;

            var response = new PropertyEditApproveModel
            {
                CopyProperty = copyProperty.ToModel(),               
                PropertyEdit = edit.ToModel(),
                CanApprove = PropertyCanApprove(edit.State, edit.SuggestGovernmentId),
                CanEditAndDelete = PropertyApproveCanEditDeleteAndSubmit(edit.State, edit.SuggestGovernmentId),
                LinkMan = edit.Property.Government.Person,
                LinkTel = edit.Property.Government.Tel
            };
            response.CopyProperty.GovernmentName = govermentName;            

            #region 新数据库对象
            #region 获取图片
            response.CopyProperty.Pictures = new List<PropertyPictureModel>();
            foreach (var pid in copyProperty.PrictureIds.Split('_'))
            {
                if (string.IsNullOrWhiteSpace(pid)) continue;
                var picture = _pictureService.GetPictureById(Convert.ToInt32(pid));
                if (picture == null) continue;

                var propertyPictureModel = new PropertyPictureModel
                {
                    PictureId = picture.Id,
                    PropertyId = copyProperty.Id,
                    Href = _pictureService.GetPictureUrl(picture.Id),
                    Title = picture.TitleAttribute
                };

                response.CopyProperty.Pictures.Add(propertyPictureModel);
            }
            #endregion

            #region 文件更新
            response.CopyProperty.Files = new List<PropertyFileModel>();
            foreach (var fid in copyProperty.FileIds.Split('_'))
            {
                if (string.IsNullOrWhiteSpace(fid)) continue;
                var file = _fileService.GetFileById(Convert.ToInt32(fid));
                if (file == null) continue;

                var propertyFileModel = new PropertyFileModel
                {
                    FileId = file.Id,
                    PropertyId = copyProperty.Id,
                    Src = _fileService.GetFileUrl(file),
                    Title = file.Name
                };

                response.CopyProperty.Files.Add(propertyFileModel);
            }

            #endregion
            var logoUrl = _pictureService.GetPictureUrl(copyProperty.LogoPicture_Id);
            response.CopyProperty.LogoUrl = string.IsNullOrEmpty(logoUrl) ? null : logoUrl;
            #endregion

            if(edit.State== PropertyApproveState.Finish && edit.OriginCopyProperty_Id!=0)
            {
                var originCopyProperty = _copyPropertyService.GetCopyPropertyById(edit.OriginCopyProperty_Id);
                var originGovermentName = _governmentService.GetGovernmentUnitById(originCopyProperty.Government_Id).Name;

                response.Property = originCopyProperty.ToModel();
                response.Property.GovernmentName = originGovermentName;

                #region 备份的原数据库对象
                #region 获取图片
                response.Property.Pictures = new List<PropertyPictureModel>();
                foreach (var pid in originCopyProperty.PrictureIds.Split('_'))
                {
                    if (string.IsNullOrWhiteSpace(pid)) continue;
                    var picture = _pictureService.GetPictureById(Convert.ToInt32(pid));
                    if (picture == null) continue;

                    var propertyPictureModel = new PropertyPictureModel
                    {
                        PictureId = picture.Id,
                        PropertyId = originCopyProperty.Id,
                        Href = _pictureService.GetPictureUrl(picture.Id),
                        Title = picture.TitleAttribute
                    };

                    response.Property.Pictures.Add(propertyPictureModel);
                }
                #endregion

                #region 文件更新
                response.Property.Files = new List<PropertyFileModel>();
                foreach (var fid in originCopyProperty.FileIds.Split('_'))
                {
                    if (string.IsNullOrWhiteSpace(fid)) continue;
                    var file = _fileService.GetFileById(Convert.ToInt32(fid));
                    if (file == null) continue;

                    var propertyFileModel = new PropertyFileModel
                    {
                        FileId = file.Id,
                        PropertyId = originCopyProperty.Id,
                        Src = _fileService.GetFileUrl(file),
                        Title = file.Name
                    };

                    response.Property.Files.Add(propertyFileModel);
                }

                #endregion
                var originLogoUrl = _pictureService.GetPictureUrl(originCopyProperty.LogoPicture_Id);
                response.Property.LogoUrl = string.IsNullOrEmpty(originLogoUrl) ? null : originLogoUrl;
                #endregion
            }
            else
            {
                response.Property = edit.Property.ToModel();

                #region 原数据库对象
                response.Property.LogoUrl = GetLogoUrl(edit.Property);
                //获取图片
                PreparePropertyPictures(response.Property);
                //获取文件
                PreparePropertyFiles(response.Property);
                #endregion
            }

            return Ok(response);
        }

        [HttpGet]
        [Route("Lend/{id}")]
        public IHttpActionResult GetLendDetail(int id) {

            var currentUser = _workContext.CurrentAccountUser;
            var government = currentUser.Government;

            var lend = _propertyLendService.GetPropertyLendById(id);
            if (lend == null || lend.Deleted) return BadRequest("无法找到资源");

            //if (!PropertyBelongCurrentUser(lend.Property, false)) return BadRequest("没有操作权限");

            var response = new PropertyLendApproveModel
            {
                Property = lend.Property.ToBasicModel(),
                PropertyLend = lend.ToModel(),
                CanApprove = PropertyCanApprove(lend.State,lend.SuggestGovernmentId),
                CanEditAndDelete = PropertyApproveCanEditDeleteAndSubmit(lend.State, lend.SuggestGovernmentId),
                LinkMan = lend.Property.Government.Person,
                LinkTel = lend.Property.Government.Tel
            };

            PreparePropertyLendPicturesAndFiles(response.PropertyLend);

            return Ok(response);
        }

        [HttpGet]
        [Route("Rent/{id}")]
        public IHttpActionResult GetRentDetail(int id)
        {
            var currentUser = _workContext.CurrentAccountUser;
            var government = currentUser.Government;

            var rent = _propertyRentService.GetPropertyRentById(id);
            if (rent == null || rent.Deleted) return BadRequest("无法找到资源");

            //if (!PropertyBelongCurrentUser(rent.Property, false)) return BadRequest("没有操作权限");

            var response = new PropertyRentApproveModel
            {
                Property = rent.Property.ToBasicModel(),
                PropertyRent = rent.ToModel(),
                CanApprove = PropertyCanApprove(rent.State,rent.SuggestGovernmentId),
                CanEditAndDelete = PropertyApproveCanEditDeleteAndSubmit(rent.State, rent.SuggestGovernmentId),
                LinkMan = rent.Property.Government.Person,
                LinkTel = rent.Property.Government.Tel
            };
            if (response.PropertyRent.PriceString.EndsWith(";")) response.PropertyRent.PriceString = response.PropertyRent.PriceString.TrimEnd(';');            

            PreparePropertyRentPicturesAndFiles(response.PropertyRent);

            return Ok(response);
        }

        [HttpGet]
        [Route("Allot/{id}")]
        public IHttpActionResult GetAllotDetail(int id)
        {
            var currentUser = _workContext.CurrentAccountUser;
            var government = currentUser.Government;

            var allot = _propertyAllotService.GetPropertyAllotById(id);
            if (allot == null || allot.Deleted) return BadRequest("无法找到资源");

            //if (!PropertyBelongCurrentUser(allot.Property, false)) return BadRequest("没有操作权限");

            var response = new PropertyAllotApproveModel
            {
                Property = allot.Property.ToBasicModel(),
                PropertyAllot = allot.ToModel(),
                CanApprove = PropertyCanApprove(allot.State,allot.SuggestGovernmentId),
                CanEditAndDelete = PropertyApproveCanEditDeleteAndSubmit(allot.State, allot.SuggestGovernmentId),
                LinkMan = allot.Property.Government.Person,
                LinkTel = allot.Property.Government.Tel
            };
            PreparePropertyAllotPicturesAndFiles(response.PropertyAllot);
            return Ok(response);
        }

        [HttpGet]
        [Route("Off/{id}")]
        public IHttpActionResult GetOffDetail(int id)
        {
            var currentUser = _workContext.CurrentAccountUser;
            var government = currentUser.Government;

            var off = _propertyOffService.GetPropertyOffById(id);
            if (off == null || off.Deleted) return BadRequest("无法找到资源");
            //if (!PropertyBelongCurrentUser(off.Property, false)) return BadRequest("没有操作权限");

            var response = new PropertyOffApproveModel
            {
                Property = off.Property.ToBasicModel(),
                PropertyOff = off.ToModel(),
                CanApprove = PropertyCanApprove(off.State,off.SuggestGovernmentId),
                CanEditAndDelete = PropertyApproveCanEditDeleteAndSubmit(off.State, off.SuggestGovernmentId),
                LinkMan = off.Property.Government.Person,
                LinkTel = off.Property.Government.Tel
            };
            PreparePropertyOffPicturesAndFiles(response.PropertyOff);
            return Ok(response);
        }

        /// <summary>
        /// 删除资产处置申请，除
        /// </summary>
        /// <param name="id"></param>
        /// <param name="approveType"></param>
        /// <returns></returns>
        [HttpDelete]
        [Route("Approve/{id}")]
        public IHttpActionResult DeleteApprove(int id, string approveType)
        {
            if (string.IsNullOrEmpty(approveType)) return BadRequest("找不到要处理的类型");

            switch (approveType)
            {
                case "edit":
                    #region 变更审批
                    {
                        var edit = _propertyEditService.GetPropertyEditById(id);
                        if (edit == null) return NotFound();
                        
                        if (!PropertyApproveCanEditDeleteAndSubmit(edit.State, edit.SuggestGovernmentId)) return BadRequest("无法删除");

                        _propertyEditService.DeletePropertyEdit(edit);

                        var copyProperty = _copyPropertyService.GetCopyPropertyByPropertyId(edit.Property.Id);
                        if (copyProperty != null)
                        {
                            copyProperty.Published = true;
                            _copyPropertyService.UpdateCopyProperty(copyProperty);
                        }

                        //活动日志
                        _accountUserActivityService.InsertActivity("deleteEditApprove", string.Format("删除id为 {0} 的资产变更的处置", id));

                        //解除锁定
                        edit.Property.Locked = false;
                        _propertyService.UpdateProperty(edit.Property);

                        break;
                    }
                    #endregion
                case "lend":
                    #region 出借审批
                    {
                        var lend = _propertyLendService.GetPropertyLendById(id);
                        if (lend == null) return NotFound();
                        if (!PropertyApproveCanEditDeleteAndSubmit(lend.State, lend.SuggestGovernmentId)) return BadRequest("无法删除");
                        _propertyLendService.DeletePropertyLend(lend);

                        //活动日志
                        _accountUserActivityService.InsertActivity("deleteLendApprove", string.Format("删除id为 {0} 的资产出借的处置", id));

                        //解除锁定
                        lend.Property.Locked = false;
                        _propertyService.UpdateProperty(lend.Property);

                        break;
                    }
                #endregion
                case "rent":
                    #region 出租审批
                    {
                        var rent = _propertyRentService.GetPropertyRentById(id);
                        if (rent == null) return NotFound();
                        if (!PropertyApproveCanEditDeleteAndSubmit(rent.State, rent.SuggestGovernmentId)) return BadRequest("无法删除");
                        _propertyRentService.DeletePropertyRent(rent);

                        //活动日志
                        _accountUserActivityService.InsertActivity("deleteLendApprove", string.Format("删除id为 {0} 的资产出租的处置", id));
                        //解除锁定
                        rent.Property.Locked = false;
                        _propertyService.UpdateProperty(rent.Property);
                        break;
                    }
                #endregion
                case "allot":
                    #region 划拨审批
                    {
                        var allot = _propertyAllotService.GetPropertyAllotById(id);
                        if (allot == null) return NotFound();
                        if (!PropertyApproveCanEditDeleteAndSubmit(allot.State, allot.SuggestGovernmentId)) return BadRequest("无法删除");
                        _propertyAllotService.DeletePropertyAllot(allot);

                        //活动日志
                        _accountUserActivityService.InsertActivity("deleteLendApprove", string.Format("删除id为 {0} 的资产划拨的处置", id));
                        //解除锁定
                        allot.Property.Locked = false;
                        _propertyService.UpdateProperty(allot.Property);
                        break;
                    }
                #endregion
                case "off":
                    #region 核销审批
                    {
                        var off = _propertyOffService.GetPropertyOffById(id);
                        var property = off.Property;

                        if (off == null) return NotFound();
                        if (!PropertyApproveCanEditDeleteAndSubmit(off.State, off.SuggestGovernmentId)) return BadRequest("无法删除");
                        _propertyOffService.DeletePropertyOff(off);

                        //活动日志
                        _accountUserActivityService.InsertActivity("deleteLendApprove", string.Format("删除id为 {0} 的资产核销的处置", id));
                        //解除锁定
                        property.Locked = false;
                        _propertyService.UpdateProperty(property);
                        break;
                    }
                    #endregion
            }

            return Ok();
        }

        /// <summary>
        /// 提交审批申请
        /// </summary>
        /// <param name="id"></param>
        /// <param name="approveApplyModel"></param>
        /// <returns></returns>
        [HttpPost]
        [Route("SubmitApprove/{id}")]
        public IHttpActionResult SumbitApprove(int id,string approveType="")
        {
          
            var currentUser = _workContext.CurrentAccountUser;

            switch (approveType)
            {
                case "newCreate":
                    #region 新增审批
                    {
                        var newCreate = _propertyNewCreateService.GetPropertyNewCreateById(id);
                        if (newCreate == null || newCreate.Deleted) return BadRequest("找不到资源");

                        if (PropertyApproveCanEditDeleteAndSubmit(newCreate.State, newCreate.SuggestGovernmentId))
                        {
                            newCreate.State = PropertyApproveState.DepartmentApprove;

                            if (currentUser.IsParentGovernmentorAuditor())  //当前用户既是主管部门又是报送部门   // if (currentUser.Government.ParentGovernmentId == 0)
                            {
                                newCreate.State = PropertyApproveState.AdminApprove;
                                newCreate.DApproveDate = DateTime.Now;
                                newCreate.DSuggestion = "同意";
                            }

                            _propertyNewCreateService.UpdatePropertyNewCreate(newCreate);

                            //活动日志
                            _accountUserActivityService.InsertActivity("submitNewCreateApprove", string.Format("提交id为 {0} 的新增资产的处置申请", id));

                            SwitchPropertyLockState(true, newCreate.Property);
                        }

                        break;
                    }
                #endregion
                case "edit":
                    #region 编辑审批
                    {
                        var edit = _propertyEditService.GetPropertyEditById(id);
                        if (edit == null || edit.Deleted) return BadRequest("找不到资源");

                        if (PropertyApproveCanEditDeleteAndSubmit(edit.State, edit.SuggestGovernmentId))
                        {
                            edit.State = PropertyApproveState.DepartmentApprove;

                            if (currentUser.IsParentGovernmentorAuditor())
                            {
                                edit.State = PropertyApproveState.AdminApprove;
                                edit.DApproveDate = DateTime.Now;
                                edit.DSuggestion = "同意";
                            }

                            _propertyEditService.UpdatePropertyEdit(edit);

                            //活动日志
                            _accountUserActivityService.InsertActivity("submitNewCreateApprove", string.Format("提交id为 {0} 的新增资产的处置申请", id));
                        }

                        break;
                    }
                #endregion
                case "lend":
                    #region 出借审批
                    {
                        var lend = _propertyLendService.GetPropertyLendById(id);
                        if (lend == null || lend.Deleted) return BadRequest("找不到资源");

                        if (PropertyApproveCanEditDeleteAndSubmit(lend.State, lend.SuggestGovernmentId))
                        {
                            lend.State = PropertyApproveState.DepartmentApprove;
                            if (currentUser.IsParentGovernmentorAuditor())
                            {
                                lend.State = PropertyApproveState.AdminApprove;
                                lend.DApproveDate = DateTime.Now;
                                lend.DSuggestion = "同意";
                            }

                            _propertyLendService.UpdatePropertyLend(lend);
                            //活动日志
                            _accountUserActivityService.InsertActivity("submitLendApprove", string.Format("提交id为 {0} 的资产出借的处置申请", id));
                        }

                        break;
                    }
                #endregion
                case "rent":
                    #region 出租审批
                    {
                        var rent = _propertyRentService.GetPropertyRentById(id);
                        if (rent == null || rent.Deleted) return BadRequest("找不到资源");

                        if (PropertyApproveCanEditDeleteAndSubmit(rent.State, rent.SuggestGovernmentId))
                        {
                            rent.State = PropertyApproveState.DepartmentApprove;
                            if (currentUser.IsParentGovernmentorAuditor())
                            {
                                rent.State = PropertyApproveState.AdminApprove;
                                rent.DApproveDate = DateTime.Now;
                                rent.DSuggestion = "同意";
                            }

                            _propertyRentService.UpdatePropertyRent(rent);

                            //活动日志
                            _accountUserActivityService.InsertActivity("submitRentApprove", string.Format("提交id为 {0} 的新增资产的处置申请", id));
                        }

                        break;
                    }
                #endregion
                case "allot":
                    #region 划拨审批
                    {
                        var allot = _propertyAllotService.GetPropertyAllotById(id);
                        if (allot == null || allot.Deleted) return BadRequest("找不到资源");

                        if (PropertyApproveCanEditDeleteAndSubmit(allot.State, allot.SuggestGovernmentId))
                        {
                            allot.State = PropertyApproveState.DepartmentApprove;
                            if (currentUser.IsParentGovernmentorAuditor())
                            {
                                allot.State = PropertyApproveState.AdminApprove;
                                allot.DApproveDate = DateTime.Now;
                                allot.DSuggestion = "同意";
                            }
                            _propertyAllotService.UpdatePropertyAllot(allot);

                            //活动日志
                            _accountUserActivityService.InsertActivity("submitAllotApprove", string.Format("提交id为 {0} 的资产划拨的处置申请", id));
                        }

                        break;
                    }
                #endregion
                case "off":
                    #region 核销审批
                    {
                        var off = _propertyOffService.GetPropertyOffById(id);
                        if (off == null || off.Deleted) return BadRequest("找不到资源");

                        if (PropertyApproveCanEditDeleteAndSubmit(off.State, off.SuggestGovernmentId))
                        {
                            off.State = PropertyApproveState.DepartmentApprove;
                            if (currentUser.IsParentGovernmentorAuditor())
                            {
                                off.State = PropertyApproveState.AdminApprove;
                                off.DApproveDate = DateTime.Now;
                                off.DSuggestion = "同意";
                            }
                            _propertyOffService.UpdatePropertyOff(off);

                            //活动日志
                            _accountUserActivityService.InsertActivity("submitOffApprove", string.Format("提交id为 {0} 的资产核销的处置申请", id));
                        }

                        break;
                    }
                    #endregion
            }
            return Ok();
        }

        /// <summary>
        /// 审批处置申请
        /// </summary>
        /// <param name="id"></param>
        /// <param name="approveApplyModel"></param>
        /// <returns></returns>
        [HttpPut]
        [Route("ApplyApprove/{id}")]
        public IHttpActionResult ApplyApprove(int id, ApproveApplyModel approveApplyModel)
        {
            bool agree = approveApplyModel.Agree;
            string suggestion = approveApplyModel.Suggestion;
            string approveType = approveApplyModel.ApproveType;

            if (agree && string.IsNullOrEmpty(suggestion))
                suggestion = "同意";

            switch (approveType)
            {
                case "newCreate":
                    #region 新增审批
                    {
                        var newCreate = _propertyNewCreateService.GetPropertyNewCreateById(id);
                        if (newCreate == null || newCreate.Deleted) return BadRequest("找不到资源");

                        if (newCreate.State == PropertyApproveState.DepartmentApprove)
                        {
                            newCreate.DApproveDate = DateTime.Now;
                            newCreate.DSuggestion = suggestion;
                        }
                        else if (newCreate.State == PropertyApproveState.AdminApprove)
                        {
                            newCreate.AApproveDate = DateTime.Now;
                            newCreate.ASuggestion = suggestion;
                        }

                        if (agree)
                        {

                            if (newCreate.State == PropertyApproveState.Start)
                            {
                                newCreate.State = PropertyApproveState.DepartmentApprove;
                            }
                            else if (newCreate.State == PropertyApproveState.DepartmentApprove) //主管部门审核阶段
                            {
                                newCreate.State = PropertyApproveState.AdminApprove;
                            }
                            else if (newCreate.State == PropertyApproveState.AdminApprove)
                            {
                                newCreate.State = PropertyApproveState.Finish;
                                newCreate.Property.Published = true;
                                SwitchPropertyLockState(false, newCreate.Property);

                                //    SwitchPropertyLockState(false, newCreate.Property);
                            }
                        }
                        else
                        {
                            newCreate.State = PropertyApproveState.Start;  //直接退回到申请单位                                      
                        }

                        _propertyNewCreateService.UpdatePropertyNewCreate(newCreate);

                        //活动日志
                        _accountUserActivityService.InsertActivity("applyNewCreateApprove", string.Format("执行id为 {0} 的新增资产的处置", id));

                        break;
                    }
                #endregion
                case "edit":
                    #region 编辑审批
                    {
                        var edit = _propertyEditService.GetPropertyEditById(id);
                        if (edit == null || edit.Deleted) return BadRequest("找不到资源");

                        if (edit.State == PropertyApproveState.DepartmentApprove)
                        {
                            edit.DApproveDate = DateTime.Now;
                            edit.DSuggestion = suggestion;
                        }
                        else if (edit.State == PropertyApproveState.AdminApprove)
                        {
                            edit.AApproveDate = DateTime.Now;
                            edit.ASuggestion = suggestion;
                        }

                        if (agree)
                        {

                            if (edit.State == PropertyApproveState.Start)
                            {
                                edit.State = PropertyApproveState.DepartmentApprove;
                            }
                            else if (edit.State == PropertyApproveState.DepartmentApprove) //主管部门审核阶段
                            {
                                edit.State = PropertyApproveState.AdminApprove;
                            }
                            else if (edit.State == PropertyApproveState.AdminApprove)
                            {
                                var property = _propertyService.GetPropertyById(edit.Property.Id);
                                var copyproperty = _copyPropertyService.GetCopyPropertyById(edit.CopyProperty_Id);

                                #region 资产原值存储
                                var originCopyProperty = new CopyProperty();
                                originCopyProperty.Name = property.Name;
                                originCopyProperty.PropertyType = property.PropertyType;
                                originCopyProperty.Region = property.Region;
                                originCopyProperty.Address = property.Address;
                                originCopyProperty.ConstructArea = property.ConstructArea;
                                originCopyProperty.LandArea = property.LandArea;
                                originCopyProperty.PropertyID = property.PropertyID;
                                originCopyProperty.HasConstructID = property.HasConstructID;
                                originCopyProperty.HasLandID = property.HasLandID;
                                originCopyProperty.PropertyNature = property.PropertyNature;
                                originCopyProperty.LandNature = property.LandNature;
                                originCopyProperty.Price = property.Price;
                                originCopyProperty.GetedDate = property.GetedDate;
                                originCopyProperty.LifeTime = property.LifeTime;
                                originCopyProperty.UsedPeople = property.UsedPeople;
                                originCopyProperty.CurrentUse_Self = property.CurrentUse_Self;
                                originCopyProperty.CurrentUse_Rent = property.CurrentUse_Rent;
                                originCopyProperty.CurrentUse_Lend = property.CurrentUse_Lend;
                                originCopyProperty.CurrentUse_Idle = property.CurrentUse_Idle;
                                originCopyProperty.NextStepUsage = property.NextStepUsage;
                                originCopyProperty.Location = property.Location == null ? "" : property.Location.AsText();
                                originCopyProperty.Extent = property.Extent == null ? "" : property.Extent.AsText();
                                originCopyProperty.Description = property.Description;
                                originCopyProperty.EstateId = property.EstateId;
                                originCopyProperty.ConstructId = property.ConstructId;
                                originCopyProperty.LandId = property.LandId;
                                originCopyProperty.Government_Id = property.Government.Id;

                                originCopyProperty.PrictureIds = string.Join("_", property.Pictures.Select(p => p.PictureId).ToArray());
                                originCopyProperty.FileIds = string.Join("_", property.Files.Select(p => p.FileId).ToArray());
                                var originPropertyLogoPicture = property.Pictures.Where(pp => pp.IsLogo).FirstOrDefault();
                                if (originPropertyLogoPicture != null) originCopyProperty.LogoPicture_Id = originPropertyLogoPicture.PictureId;

                                _copyPropertyService.InsertCopyProperty(originCopyProperty);
                                #endregion

                                #region 资产赋新值                           
                                property.Name = copyproperty.Name;
                                property.PropertyType = copyproperty.PropertyType;
                                property.Region = copyproperty.Region;
                                property.Address = copyproperty.Address;
                                property.ConstructArea = copyproperty.ConstructArea;
                                property.LandArea = copyproperty.LandArea;
                                property.PropertyID = copyproperty.PropertyID;
                                property.HasConstructID = copyproperty.HasConstructID;
                                property.HasLandID = copyproperty.HasLandID;
                                property.PropertyNature = copyproperty.PropertyNature;
                                property.LandNature = copyproperty.LandNature;
                                property.Price = copyproperty.Price;
                                property.GetedDate = copyproperty.GetedDate;
                                property.LifeTime = copyproperty.LifeTime;
                                property.UsedPeople = copyproperty.UsedPeople;
                                property.CurrentUse_Self = copyproperty.CurrentUse_Self;
                                property.CurrentUse_Rent = copyproperty.CurrentUse_Rent;
                                property.CurrentUse_Lend = copyproperty.CurrentUse_Lend;
                                property.CurrentUse_Idle = copyproperty.CurrentUse_Idle;
                                property.NextStepUsage = copyproperty.NextStepUsage;
                                if (!string.IsNullOrEmpty(copyproperty.Location))
                                    property.Location = DbGeography.FromText(copyproperty.Location);
                                else return BadRequest("空间位置未赋值");
                                if (!string.IsNullOrEmpty(copyproperty.Extent))
                                    property.Extent = DbGeography.FromText(copyproperty.Extent);
                                property.Description = copyproperty.Description;
                                property.EstateId = copyproperty.EstateId;
                                property.ConstructId = copyproperty.ConstructId;
                                property.LandId = copyproperty.LandId;
                                if (property.Government.Id != copyproperty.Government_Id)
                                    property.Government = _governmentService.GetGovernmentUnitById(copyproperty.Government_Id);

                                #region 图片更新
                                var propertyPictureModels = new List<PropertyPictureModel>();

                                foreach (var pid in copyproperty.PrictureIds.Split('_'))
                                {
                                    if (string.IsNullOrWhiteSpace(pid)) continue;
                                    var picture = _pictureService.GetPictureById(Convert.ToInt32(pid));

                                    if (picture == null) continue;

                                    var propertyPictureModel = new PropertyPictureModel
                                    {
                                        PictureId = picture.Id,
                                        PropertyId = copyproperty.Id
                                    };

                                    propertyPictureModels.Add(propertyPictureModel);
                                }
                                //图片更新
                                SavePropertyPictures(property, propertyPictureModels);
                                #endregion

                                #region logo更新
                                var logoPicture = _pictureService.GetPictureById(copyproperty.LogoPicture_Id);
                                if (logoPicture != null)
                                {
                                    var propertyLogoPicture = property.Pictures.Where(p => p.IsLogo).SingleOrDefault();

                                    if (propertyLogoPicture != null)
                                    {
                                        if (propertyLogoPicture.PictureId != copyproperty.LogoPicture_Id)
                                        {
                                            propertyLogoPicture.Picture = logoPicture;
                                            _propertyService.UpdatePropertyPicture(propertyLogoPicture);
                                        }
                                    }
                                    else
                                    {
                                        propertyLogoPicture = new PropertyPicture
                                        {
                                            Property = property,
                                            IsLogo = true,
                                            Picture = logoPicture
                                        };

                                        property.Pictures.Add(propertyLogoPicture);
                                    }
                                }
                                #endregion

                                #region 文件更新
                                var propertyFileModels = new List<PropertyFileModel>();
                                foreach (var fid in copyproperty.FileIds.Split('_'))
                                {
                                    if (string.IsNullOrWhiteSpace(fid)) continue;
                                    var file = _pictureService.GetPictureById(Convert.ToInt32(fid));
                                    if (file == null) continue;

                                    var propertyFileModel = new PropertyFileModel
                                    {
                                        FileId = file.Id,
                                        PropertyId = copyproperty.Id
                                    };

                                    propertyFileModels.Add(propertyFileModel);
                                }

                                SavePropertyFiles(property, propertyFileModels);
                                #endregion

                                #endregion

                                edit.State = PropertyApproveState.Finish;
                                edit.OriginCopyProperty_Id = originCopyProperty.Id;  //历史Property记录
                                property.Published = true;
                                copyproperty.Published = true;

                                SwitchPropertyLockState(false, property);
                                _propertyService.UpdateProperty(property);
                                _copyPropertyService.UpdateCopyProperty(copyproperty);
                            }
                        }
                        else
                        {
                            edit.State = PropertyApproveState.Start;  //直接退回到申请单位                                      
                        }

                        _propertyEditService.UpdatePropertyEdit(edit);

                        //活动日志
                        _accountUserActivityService.InsertActivity("applyNewCreateApprove", string.Format("执行id为 {0} 的新增资产的处置", id));

                        break;
                    }
                #endregion
                case "lend":
                    #region 出借审批
                    {
                        var lend = _propertyLendService.GetPropertyLendById(id);
                        if (lend == null || lend.Deleted) return BadRequest("找不到资源");

                        if (lend.State == PropertyApproveState.DepartmentApprove)
                        {
                            lend.DApproveDate = DateTime.Now;
                            lend.DSuggestion = suggestion;
                        }
                        else if (lend.State == PropertyApproveState.AdminApprove)
                        {
                            lend.AApproveDate = DateTime.Now;
                            lend.ASuggestion = suggestion;
                        }

                        if (agree)
                        {
                            if (lend.State == PropertyApproveState.Start)
                            {
                                lend.State = PropertyApproveState.DepartmentApprove;
                            }
                            else if (lend.State == PropertyApproveState.DepartmentApprove)                             //主管部门审核阶段
                            {
                                lend.State = PropertyApproveState.AdminApprove;
                            }
                            else if (lend.State == PropertyApproveState.AdminApprove)
                            {
                                lend.State = PropertyApproveState.Finish;
                                SwitchPropertyLockState(false, lend.Property);
                            }
                        }
                        else
                        {
                            lend.State = PropertyApproveState.Start;  //直接退回到申请单位                                      
                        }

                        _propertyLendService.UpdatePropertyLend(lend);

                        //活动日志
                        _accountUserActivityService.InsertActivity("applyNewCreateApprove", string.Format("执行id为 {0} 的资产出借的处置", id));

                        break;
                    }
                #endregion
                case "rent":
                    #region 出租审批
                    {
                        var rent = _propertyRentService.GetPropertyRentById(id);
                        if (rent == null || rent.Deleted) return BadRequest("找不到资源");

                        if (rent.State == PropertyApproveState.DepartmentApprove)
                        {
                            rent.DApproveDate = DateTime.Now;
                            rent.DSuggestion = suggestion;
                        }
                        else if (rent.State == PropertyApproveState.AdminApprove)
                        {
                            rent.AApproveDate = DateTime.Now;
                            rent.ASuggestion = suggestion;
                        }

                        if (agree)
                        {
                            //主管部门审核阶段
                            if (rent.State == PropertyApproveState.Start)
                            {
                                rent.State = PropertyApproveState.DepartmentApprove;
                            }
                            else if (rent.State == PropertyApproveState.DepartmentApprove)
                            {
                                rent.State = PropertyApproveState.AdminApprove;
                            }
                            else if (rent.State == PropertyApproveState.AdminApprove)
                            {
                                rent.State = PropertyApproveState.Finish;
                                SwitchPropertyLockState(false, rent.Property);
                            }
                        }
                        else
                        {
                            rent.State = PropertyApproveState.Start;  //直接退回到申请单位                                      
                        }

                        _propertyRentService.UpdatePropertyRent(rent);

                        //活动日志
                        _accountUserActivityService.InsertActivity("applyNewCreateApprove", string.Format("执行id为 {0} 的资产出租的处置", id));

                        break;
                    }
                #endregion
                case "allot":
                    #region 划拨审批
                    {
                        var allot = _propertyAllotService.GetPropertyAllotById(id);
                        if (allot == null || allot.Deleted) return BadRequest("找不到资源");

                        if (allot.State == PropertyApproveState.DepartmentApprove)
                        {
                            allot.DApproveDate = DateTime.Now;
                            allot.DSuggestion = suggestion;
                        }
                        else if (allot.State == PropertyApproveState.AdminApprove)
                        {
                            allot.AApproveDate = DateTime.Now;
                            allot.ASuggestion = suggestion;
                        }

                        if (agree)
                        {
                            //主管部门审核阶段
                            if (allot.State == PropertyApproveState.Start)
                            {
                                allot.State = PropertyApproveState.DepartmentApprove;
                            }
                            else if (allot.State == PropertyApproveState.DepartmentApprove)
                            {
                                allot.State = PropertyApproveState.AdminApprove;
                            }
                            else if (allot.State == PropertyApproveState.AdminApprove)
                            {
                                allot.State = PropertyApproveState.Finish;
                                var newGovernment = _governmentService.GetGovernmentUnitById(allot.NowGovernmentId);
                                if (newGovernment == null) return BadRequest("找不到新的权属单位");
                                allot.Property.Government = newGovernment;

                                SwitchPropertyLockState(false, allot.Property);
                                
                            }
                        }
                        else
                        {
                            allot.State = PropertyApproveState.Start;  //直接退回到申请单位                                      
                        }

                        _propertyAllotService.UpdatePropertyAllot(allot);

                        //活动日志
                        _accountUserActivityService.InsertActivity("applyNewCreateApprove", string.Format("执行id为 {0} 的资产的划拨处置", id));

                        break;
                    }
                #endregion
                case "off":
                    #region 划拨审批
                    {
                        var off = _propertyOffService.GetPropertyOffById(id);
                        if (off == null || off.Deleted) return BadRequest("找不到资源");

                        if (off.State == PropertyApproveState.Start)
                        {
                            off.State = PropertyApproveState.DepartmentApprove;
                        }
                        else if (off.State == PropertyApproveState.DepartmentApprove)
                        {
                            off.DApproveDate = DateTime.Now;
                            off.DSuggestion = suggestion;
                        }
                        else if (off.State == PropertyApproveState.AdminApprove)
                        {
                            off.AApproveDate = DateTime.Now;
                            off.ASuggestion = suggestion;
                        }

                        if (agree)
                        {
                            //主管部门审核阶段
                            if (off.State == PropertyApproveState.DepartmentApprove)
                            {
                                off.State = PropertyApproveState.AdminApprove;
                            }
                            else if (off.State == PropertyApproveState.AdminApprove)
                            {
                                off.State = PropertyApproveState.Finish;
                                off.Property.Off = true;
                                off.Property.Published = false;
                                SwitchPropertyLockState(false, off.Property);
                            }
                        }
                        else
                        {
                            off.State = PropertyApproveState.Start;  //直接退回到申请单位                                      
                        }

                        _propertyOffService.UpdatePropertyOff(off);

                        //活动日志
                        _accountUserActivityService.InsertActivity("applyNewCreateApprove", string.Format("执行id为 {0} 的资产核销处置", id));

                        break;
                    }
                    #endregion
            }
            return Ok();
        }

        [HttpGet]
        [Route("Approve/Statistics")]
        public IHttpActionResult ApproveStatistics()
        {
            var currentUser = _workContext.CurrentAccountUser;
            var government = currentUser.Government;
            var targetGovIds = new List<int>();
            if (currentUser.IsGovAuditor())
            {
                targetGovIds = _governmentService.GetAllGovernmentUnitsByType(
                    new GovernmentType[2] { GovernmentType.Government, GovernmentType.Institution }).Select(g => g.Id).ToList();
            }
            else if (currentUser.IsStateOwnerAuditor())
            {
                targetGovIds = _governmentService.GetAllGovernmentUnitsByType(
                    new GovernmentType[1] { GovernmentType.Company }).Select(g => g.Id).ToList();
            }
            else
            {
                targetGovIds = _governmentService.GetChildrenGovernmentIds(government.Id);
            }
            string sort = "processDate,desc;";
            var condition = PropertySortCondition.Instance(sort);
            var response = new ApproveStatisticsModel();
            response.NewCreate = _propertyNewCreateService.GetAllNewCreateRecords(targetGovIds, "unchecked", "", 0, int.MaxValue, condition).Count;
            response.Edit = _propertyEditService.GetAllEditRecords(targetGovIds, "unchecked", "", 0, int.MaxValue, condition).Count;
            response.Lend = _propertyLendService.GetAllLendRecords(targetGovIds, "unchecked", "", 0, int.MaxValue, condition).Count;
            response.Rent = _propertyRentService.GetAllRentRecords(targetGovIds, "unchecked", "", 0, int.MaxValue, condition).Count;
            response.Allot = _propertyAllotService.GetAllAllotRecords(targetGovIds, "unchecked", "", 0, int.MaxValue, condition).Count;
            response.Off = _propertyOffService.GetAllOffRecords(targetGovIds, "unchecked", "", 0, int.MaxValue, condition).Count;

            return Ok(response);
        }

        [HttpGet]
        [Route("ProcessFilter")]
        public IHttpActionResult GetAllProcess(string query = "", string sort = "",bool showHidden = false, long time = 0,
          bool manage = false, bool isGovernment = false, bool isInstitution = false, bool isCompany = false, int selectedId = 0,
          bool construct = false, bool land = false, bool constructOnLand = false,//资产类型
          bool old = false, bool west = false, bool jjq = false, bool kc = false, bool qj = false, bool other = false, //区域
          bool certi_both = false, bool certi_land = false, bool certi_construct = false, bool certi_none = false, //证书情况
          bool current_self = false, bool current_rent = false, bool current_lend = false, bool currnet_idle = false, //使用现状
          bool auction = false, bool ct = false, bool jt = false, bool jk = false, bool self = false, bool storeUp = false, bool adjust = false, bool greenland = false, bool house = false//下步使用
       //   string constructAreaRange = "", string landAreaRange = "", string priceRange = "", string getDateRange=""  //范围参数
          )
        {
            var currentUser = _workContext.CurrentAccountUser;
            

            //初始化排序条件
            var sortConditions = PropertySortCondition.Instance(sort);

            //特殊字段排序调整
            if (sort.ToLower().StartsWith("governmentname")) sortConditions[0].PropertyName = "Government";

            //高级搜索参数设置
            PropertyAdvanceConditionModel advance = new PropertyAdvanceConditionModel
            {
                Government = new GovernmentFilterModel { Manage = manage, IsCompany = isCompany, IsGovernment = isGovernment, IsInstitution = isInstitution, SelectedId = selectedId },
                PropertyType = new PropertyTypeModel { Construct = construct, Land = land, ConstructOnLand = constructOnLand },
                Region = new RegionModel { West = west, Jjq = jjq, Kc = kc, Old = old, Other = other, Qj = qj },
                Certificate = new Certificate { Both = certi_both, Construct = certi_construct, Land = certi_land, None = certi_land },
                Current = new CurrentModel { Idle = currnet_idle, Lend = current_lend, Rent = current_rent, Self = current_self },
                NextStep = new NextStepModel { Adjust = adjust, Auction = auction, Ct = ct, Jt = jt, Jk = jk, Greenland = greenland, House = house, Self = self, StoreUp = storeUp },
                Time = time
            };
  
            //高级搜索参数设置
            PropertyAdvanceConditionRequest request = PrepareAdvanceCondition(advance);

            var governmentIds = _governmentService.GetGovernmentIdsByCurrentUser(true);  //不包含已有账号的下级单位
            var properties = _propertyService.GetAllProcessProperties(governmentIds, query, 
                request, sortConditions).Select(sp=>
                {
                    
                    return new
                    {
                        Id = sp.Id,
                        Name = sp.Name,
                        Region = sp.Region.ToDescription(),
                        Address = sp.Address,
                        G = sp.Government.Name,
                        ConstructArea = sp.ConstructArea,
                        LandArea = sp.LandArea,
                        PropertyType = sp.PropertyType,
                        Price =sp.Price

                    };
                });

            //activity log
            _accountUserActivityService.InsertActivity("GetpropertyList", "获取资产列表信息");

            return Ok(properties);
        }

        #endregion

    }
}
